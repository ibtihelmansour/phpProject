if(!window.console) {
	window.console={
		log: $.noop
	};
}

/* FIX ECOMBSKA-7009  Y Landing Horoscopo*/
ItxLogonPageClass.prototype.isHoroscope = function() {
	return inditex._getURLParameter('horoscopo') == 'true';
};
ItxLogonPageClass.prototype.goToHoroscope = function() {
	var url = inditex.encodeUrl({
            action: "ItxMSpotPage",
            params : {
                storeId : inditex.iStoreId,
                langId : inditex.iLangId,
                catalogId : inditex.iCatalogId,
                mspotname : 'birthday'
            },
            isAjax: false
        })
	window.location.href = url;
};
ItxLogonPageClass.prototype._proceed = function() {
	if (this.isHoroscope()) {
		this.goToHoroscope();
	} else if(this.iScope.iCheckoutButtonAction) {
		this._proceedToPage(this.iScope.iCheckoutButtonAction);
	} else {
		if($("html").hasClass("ua-ios")) {
			inditex.gotoHome();
		} else {
			if(window.history.length<=2) {
				inditex.gotoHome();
			}else{
				window.history.go(-1);
			}
		}
	}
}
/* END FIX ECOBSKA-7009 */

/* FIX ECOMBSKA-9516 */
/* COMPONENT PRODUCT IMAGE LIST */
angular.module("itxApp").component("productImageList", {
	bindings: {
		click: "&?",
		imageSize: "@?",
		imageType: "@?",
		items: "<"
	},
	templateUrl: "tplProductImageList",
	controller: ["bskImageService", "bskImageConstants", productImageListCtrl]
});

function productImageListCtrl(imageService, imageConstants) {
	this.imageService = imageService;
	this.imageConstants = imageConstants;
}
productImageListCtrl.prototype.$onInit=function() {
	var location=this.imageConstants.locationsStr.indexOf(this.imageType)!=-1?this.imageType:this.imageConstants.locations.CHECKOUT;
	var size=this.imageConstants.sizesStr.indexOf(this.imageSize)!=-1?this.imageSize:this.imageConstants.sizes.SMALL;

	this.images = [];
	for (var i = 0, len = this.items.length; i < len; i++) {
		var item = this.items[i];
		if(!this.isGiftWrap(item)) {
			var img = {
				src: this.getItemImage(item, location, size),
				item: item
			};
			if(img) {
				this.images.push(img);
			}
		}
	}
};
productImageListCtrl.prototype.isGiftWrap = function(item) {
	return item.reference=="XGIFTSKU";
};
productImageListCtrl.prototype.getItemImage = function(item, location, size) {
	var image=item.image;

	var stylismId; 
	if(image && image.style && image.style.length) {
		stylismId=image.style[0];
	} else {
		stylismId = item.origin && item.origin.length ? item.origin[0].style : item.style;
	}

	var detailImage = this.imageService.getProductDetailImages(item, {id: item.colorId}, location, size, stylismId)[0];
	
	if(detailImage) {
		return detailImage.src;
	}
	return "";
};

/* DECORATE SHIPPING METHOD */
angular.module("itxApp").config(["$provide", function($provide) {
	$provide.decorator("shippingMethodDirective", ["$delegate", "checkoutShippingState", "shopCartService", function($delegate, shippingState, shopCartService) {
		var directive = $delegate[0];
		var ctrl = directive.controller[directive.controller.length-1];
		ctrl.prototype.init = function() {
			this.shippingState = shippingState;
			this.shopCartService = shopCartService;
		}
		return $delegate;
	}]);
}]);
shippingMethodCtrl.prototype.isDeferred = function() {
	return this.method.dbcode == "DeferredStandard";
};
shippingMethodCtrl.prototype.hasAlternateDescription = function() {
	return this.alternateDescription.indexOf("???") != 0;
};
shippingMethodCtrl.prototype.showAlternateDescription = function() {
	return this.hasAlternateDescription() && this.isDeferred() && this.sintType == 'store';
};
shippingMethodCtrl.prototype.hasDate = function() {
	return !this.isDeferred() && this.method.app.dateInfo && this.shippingMethods.cronosEnabled;
};
shippingMethodCtrl.prototype.showItemList = function() {
	return this.shippingState.step == 1 && !this.isDeferred() && this.method.app.kind == 'delivery' && this.sintType == 'both';
};
shippingMethodCtrl.prototype.$onInit = function() {
	this.items = {
		warehouse: [],
		store: []
	};
	this.alternateDescription = inditex.text("checkout.shipping.sint");
	this.storeDescription = inditex.text("checkout.products.sint");
	if(this.storeDescription.indexOf("???") == 0) {
		this.storeDescription = "";
	}
	
	var items = this.shopCartService.getShopCartItems();
	
	for (var i = 0, len = items.length; i < len; i++) {
		var item = items[i];

		if(item.stockOrigin != "STORE") {
			this.items.warehouse.push(item);
		} else {
			this.items.store.push(item);
		}
	}
	
	if(this.items.store.length && this.items.warehouse.length) {
		this.sintType = "both";
	} else if(this.items.store.length) {
		this.sintType = "store";
	} else {
		this.sintType = "warehouse";
	}
};

/* FIX SERVICE shippingMethods */
angular.module("itxApp").factory("shippingMethodsFactory", ["ItxExecuteCache", "$q", "$log", "bskConfigurationFactory", "checkoutShippingState", "shopCartService", "shippingMethodsConstants", function(executeCache, $q, $log, config, shippingState, shopCartService, constants) {
	var allShippingMethods=null;
	var showDisabled=bershka.config("ShowDisabledShippingMethods");
	var sameDayMethodId=bershka.getStoreConfiguration("sameDayMethodId");
	
	var loadedPostalCode, specificsPostalCode, specificsAddressId;
	
	var ranges;
	function getDefinedDeliveryDateRanges(method, defer) {
		ranges = ranges || executeCache.execute([{
			action: "order:shippingDate",
			params: {
				storeId: inditex.iStoreId,
				languageId: inditex.iLangId,
				orderId: inditex.iUserJSON.shopCart.id,
				type: 1
			}
		},{
			action: "order:shippingRange",
			params: {
				storeId: inditex.iStoreId,
				languageId: inditex.iLangId,
				orderId: inditex.iUserJSON.shopCart.id,
				type: 1
			}
		}]).then(function(results) {
			method.app.dates=results[0].value.shippingDates;
			method.app.times=results[1].value.shippingRanges;
		}, function() {
			ranges=null;
			return $q.resolve();
		});
		return ranges;
	}
	
	function getDateString(date) {
		var today = moment().endOf('day')
		var tomorrow = moment().add(1, 'day').endOf('day')

		if (date < today) {
			return 'today';
		}
		if (date < tomorrow) {
			return 'tomorrow';
		}
		
		return "<span class='no-wrap'>"+date.format("dddd D")+"</span>";
	}
	
	function getDateInfo(deliveryInfo) {
		var minDate, maxDate, minDateStr, maxDateStr;
		
		if(!deliveryInfo) {
			return '';
		}
		
		if(deliveryInfo.deliveryDate) {
			minDate = maxDate = moment(deliveryInfo.deliveryDate);
		} else if(deliveryInfo.minimumGlobalDeliveryDate && deliveryInfo.maximumGlobalDeliveryDate) {
			minDate = moment(deliveryInfo.minimumGlobalDeliveryDate);
			maxDate = moment(deliveryInfo.maximumGlobalDeliveryDate);
		} else {
			return "";
		}
		
		minDateStr = getDateString(minDate);
		maxDateStr = getDateString(maxDate);
		
		var method=minDate.isSame(maxDate, "day")?"simple":"multiple";
		
		switch(minDateStr) {
			case "today":
				return inditex.text("shippingMethods.date."+method+".today", maxDateStr);
				break;
			case "tomorrow":
				return inditex.text("shippingMethods.date."+method+".tomorrow", maxDateStr);
				break;
			default:
				return inditex.text("shippingMethods.date."+method, minDateStr, maxDateStr);
				break;
		}
	}

	function prepareMethodsAsyncData(methods) {
		var toWait=[];
		for(var i=0, len=methods.length; i<len; i++) {
			var kind;
			var method = methods[i];
			
			if(method.kind) {
				kind = method.kind.toLowerCase();
			} else if(method.shippingTypeName) {
				kind = method.shippingTypeName.toLowerCase();
			}
			
			if(kind=="defineddeliverydate" && (!method.app.dates || !method.app.times)) {
				toWait.push(getDefinedDeliveryDateRanges(method));
			}
		}
		
		return $q.all(toWait);
	}
	
	function doMethodSort(methods) {
		var ret;
		var added = [];
		var disabled=[];
		var enabled=[];
		
		for (var i = 0, len = methods.length; i < len; i++) {
			var method = methods[i];
			if(added.indexOf(method.dbcode)==-1) {
				added.push(method.dbcode);

				if(!method.app.enabled) {
					disabled.push(method);
				} else {
					enabled.push(method);
				}			
			}
		}
		
		factory.hasDisabledMethods=disabled.length;
		
		switch(bershka.config("DisabledShippingMethodsPosition")) {
			case "front": return disabled.concat(enabled); break;
			case "back": return enabled.concat(disabled); break;
			default: return methods; break;
		}
	}
	
	function doPrepareMethod(method, parent, cronosEnabled) {
		if(method.kind) {
			kind = method.kind.toLowerCase();
		} else if(method.shippingTypeName) {
			kind = method.shippingTypeName.toLowerCase();
			method.name = method.shippingTypeDescription;
			//method.description = method.shippingTypeDescription;
			method.description = "";
		}
		
		if(method.priceWithDiscounts===null && method.price) {
			method.priceWithDiscounts=method.price;
		}
		
		if(method.prices) {
			range = {
				maxPrice: method.prices.maxPrices,
				minPrice: method.prices.minPrices,
				maxOldPrice: null,
				minOldPrice: null
			};
		} else {
			range = null;
		}
		
		if(!method.dbcode) {
			method.dbcode = "group_"+method.shippingTypeId;
		} else if(method.dbcode.toLowerCase() == "mail") {
			method.kind="mail";
			kind="mail";
		}
		
		if(!method.id) {
			method.id = method.dbcode;
		}
					
		method.app={
			subkind: kind,
			kind: kind,
			directToBilling: (kind=="pickup" || kind=="mail" || kind=="droppoint" || kind=="dropbox"),
			cronosEnabled: cronosEnabled,
			sameDay: method.id == sameDayMethodId,
			enabled: method.isShipMethodEnabled!==false,
			dates: [],
			times: [],
			dateInfo: getDateInfo(method.deliveryInfo),
			range: range,
			parent: parent
		};
		
		if(kind=="dropbox") {
			method.app.kind="droppoint";
		}
		
		if(kind=="defineddeliverydate") {
			method.app.kind="delivery";
		}
		
		return method;
	}

	function prepareFiltered(method) {
		if(method.shippingMethodsFiltered) {
			for (var j = 0, len = method.shippingMethodsFiltered.length; j < len; j++) {
				factory.filtered.push(doPrepareMethod(method.shippingMethodsFiltered[j], method));
			}					
		}
		
		if(factory.filtered.length) {
			factory.hasHiddenMethods=true;
		}
	}
	
	function prepareMethods(methods, parent) {
		var prepared=[];
		
		factory.sameDayMethod=null;
		
		for(var i = 0, len = methods.length; i < len; i++) {
			var method = methods[i];
			var cronosEnabled = false;
			var theParent = parent;
			var kind, range;

			if(method.shippingMethods) {
				if(method.shippingMethods.length==1 && (!method.shippingMethodsFiltered || !method.shippingMethodsFiltered.length)) {
					prepareFiltered(method);
					method = method.shippingMethods[0];
					theParent = undefined;
					cronosEnabled = false;
				} else {
					prepareFiltered(method);
					if(!factory.cronosEnabled) {
						prepared = prepared.concat(prepareMethods(method.shippingMethods));
						continue;
					}
					method.shippingMethods = prepareMethods(method.shippingMethods, method);
					if(!method.shippingMethods.length) {
						continue;
					}
					cronosEnabled = true;
				}
			}

			if(cronosEnabled) {
				factory.hasCronosMethods = true;
			}
			
			doPrepareMethod(method, theParent, cronosEnabled);

			if(!method.app.enabled && !showDisabled) {
				continue;
			}
			
			if(method.app.sameDay) {
				factory.sameDayMethod=method;
			}
			
			if(kind=="mail") {
				if(shopCartService.hasVirtualItems()) {
					prepared = [method];
					break;
				} else {
					continue;
				}
			}

			prepared.push(method);
		}
		
		var ret = doMethodSort(prepared);
		
		if(!parent && factory.hasCronosMethods) {
			for (var i = 0, len = ret.length; i < len; i++) {
				var method = ret[i];
				if(constants.kind[method.app.kind] && constants.kind[method.app.kind].ico) {
					method.app.ico = constants.kind[method.app.kind].ico;
				}
			}
		}
		
		return ret;
	}

	function getShippingMethods(postalCode, addressId) {
		return executeCache.execute([{
			action: "order:shippingUnique",
			params: {
				storeId: inditex.iStoreId,
				languageId: inditex.iLangId,
				option: 1,
				zipCode: postalCode || undefined,
				exclusion: showDisabled ? "flag" : undefined,
				orderId: shopCartService.getShopCartId(),
				shippingTypes: factory.cronosEnabled && !addressId ? 1 : undefined,
				addressId: addressId
			}
		}]).then(function(results) {
			var value=results[0].value;
			var methods=value.shippingUnique || value.shippingMethods;
			var parent=null;
			var ret;
			ret = prepareMethods(methods);
			return prepareMethodsAsyncData(ret).then(function() {
				if(factory.cronosEnabled && addressId && shippingState.methods.selected) {
					for (var i = 0, len = ret.length; i < len; i++) {
						var shipping = ret[i];
						if(shipping.shippingTypeId == shippingState.methods.selected.shippingTypeId) {
							return shipping.shippingMethods || [];
						}
					}
					return [];
				} else {
					return ret;
				}
			});
		}, function() {
			return $q.resolve([]);
		});
	}
	
	function recurseFindMethod(methods, key, value) {
		for(var i=0, len=methods.length; i<len; i++) {
			var method=methods[i];
			if (method[key]===value) {
				return method;
			}
			
			if(method.shippingMethods) {
				var found = recurseFindMethod(method.shippingMethods, key, value);
				if(found) {
					return found;
				}
			}
		}
		return null;
	}

	function hasOnlyStore() {
		var items = shopCartService.getShopCartItems();
		for (var i = 0, len = items.length; i < len; i++) {
			if(items[i].stockOrigin != "STORE") {
				return false;
			}
		}
		return true;
	};

	function getSintFilterMethods(methods) {
		if(factory.sintFilters.length == 0 || !hasOnlyStore()) {
			return methods;
		}
		
		var sintFiltered = [];
		for (var i = 0, len = methods.length; i < len; i++) {
			var method = methods[i];
			if(factory.sintFilters.indexOf(method.code + "")!=-1) {
				sintFiltered.push(method);
			}
		}
		return sintFiltered;
	};
	
	var methodsCache = {};
	
	var factory = {
		methods: null,
		filtered: [],
		sintFilters: [],
		sintMessagesEnabled: false,
		specifics: null,
		postalCodeRestricted: inditex.iStoreJSON.details.postalCodeRestriction == "1",
		cronosEnabled: false,
		hasCronosMethods: false,
		hasDisabledMethods: false,
		hasHiddenMethods: false,
		sameDayMethod: null,
		find: function(key, value) {
			if(this.methods) {
				return recurseFindMethod(this.methods, key, value);
			}
		},
		get: function(postalCode, addressId, disableCache) {
			var self=this;
			return configurationWait.then(function() {
				if(addressId && shippingState.methods.selected && shippingState.methods.selected.app.cronosEnabled) {
					if(specificsAddressId == addressId && specificsPostalCode == postalCode && self.specifics && !disableCache) {
						return $q.resolve(self.specifics);
					}
					return getShippingMethods(postalCode, addressId).then(function(methods) {
						specificsPostalCode = postalCode;
						specificsAddressId = addressId;
						factory.specifics = methods;
						if(shippingState.methods.specific) {
							var oldSpecific=shippingState.methods.specific;
							factory.specific = null;
							for (var i = 0, len = factory.specifics.length; i < len; i++) {
								var specific = factory.specifics[i];
								if(specific.id==oldSpecific.id) {
									shippingState.methods.specific=specific;
									break;
								}
							}
						}
						return methods;
					});
				} else {
					var cc = inditex.iStoreJSON.countryCode.toUpperCase();
					if(loadedPostalCode == postalCode && methodsCache[cc] && !disableCache) {
						self.methods = methodsCache[cc];
						return $q.resolve(self.methods);
					}
					return getShippingMethods(postalCode).then(function(methods) {
						var sintFiltered = getSintFilterMethods(methods);
						loadedPostalCode = postalCode;
						methodsCache[cc] = sintFiltered;
						self.methods = sintFiltered;
						return sintFiltered;
					});
				}
			});
		}
	};

	var configurationWait=config.get(["ENABLE_DELIVERY_DATE_CRONOS", "enable_messageSINT_shipping", "show_shippingMethod"]).then(function(values) {
		factory.cronosEnabled = values[0] && values[0] != "0";
		factory.sintMessagesEnabled = values[1] == "1";
		if(factory.sintMessagesEnabled && values[2]) {
			factory.sintFilters = values[2].replace(" ","").split(",");
		} else {
			factory.sintFilters = [];
		}
	});
	
	$log.publish("shippingMethodsService", factory);
	return factory;
}]);

/* FIX CONFIRMATION ON MULTI ORDERS */
ItxOrderConfirmationPageClass.prototype._bindings.getEstimatedDeliveryDate = function(order) {
	var isDeferred = order.shipping && order.shipping.dbcode == "DeferredStandard";

	function hasItemsFromStore(items) {
		for(var i=0, len=items.length; i<len; i++) {
			if(items[i].stockOrigin == "STORE") {
				return true;
			}
		}
		return false;
	}
	
	if(!isDeferred && !hasItemsFromStore(order.items)) {
		var estimated = order.getEstimatedDeliveryDate();
		if(estimated && estimated.getDate && !isNaN(estimated.getDate())) {
			return moment(estimated).format("dddd D");
		}
	}
	
	return "";
}

/* FIX SERVICE FOR orderConfirmation */
angular.module('itxApp').service('itemStockOriginService', [itemStockOriginService]);

function itemStockOriginService () {
}

itemStockOriginService.prototype.getStockLocation = function(stockLocation) {
	var sourceCode = stockLocation && (stockLocation.stockSourceCode || stockLocation.extFFMCenterId);
	return sourceCode && (sourceCode + "");
};
itemStockOriginService.prototype.getStockLocationId = function(stockLocation) {
	var id = stockLocation && (stockLocation.stockLocationId || stockLocation.ffmId);
	return id && (id + "");
};

itemStockOriginService.prototype.isWarehouseStore = function(stockLocation) {
	var stores = inditex.xWarehouseStores;
	var sourceCode = this.getStockLocation(stockLocation);
	if(stores && stores.length && sourceCode) {
		return stores.indexOf(sourceCode) != -1; 
	}
	return false;
};

itemStockOriginService.prototype.isStore = function(stockLocation) {
	var sourceCode = this.getStockLocation(stockLocation);
	var id = this.getStockLocationId(stockLocation);
	if(sourceCode) {
		return sourceCode.indexOf("BK-PST-") == 0 || id == "2";
	}
	return false;
};

itemStockOriginService.prototype.get = function (item) {
	var stockLocations = item.stockLocations || [item];
	for(var i=0, len=stockLocations.length; i<len; i++) {
		var stockLocation = stockLocations[i];
		if(this.isWarehouseStore(stockLocation)) {
			return "WAREHOUSESTORE";
		}
		if(this.isStore(stockLocation)) {
			return "STORE";
		}
	}
	return "WAREHOUSE";
};

/* FIX SERVICE order */
angular.module("itxApp").factory("orderFactory", ["checkoutShippingState", "orderCardFactory", "userAddressesFactory", "addressHelperFactory", "walletCardsFactory", "shippingMethodsFactory", "paymentMethodsFactory", "bskConfigurationFactory", "shopCartService", "storesFactory", "droppointsFactory", "ItxExecuteCache", "bskExperienceFactory", "trackingService", "checkoutCacheFactory", "bskGDPRHelper", "$q", "$log", "$rootScope", "orderConstants", "bskCountries", "unifiedStockConstants", "WorldWideHelper", function(shippingState, orderCard, userAddresses, addressHelper, walletCards, shippingMethods, paymentMethods, config, shopCartService, storesFactory, droppointsFactory, executeCache, bskExperience, trackingService, cache, GDPRHelper, $q, $log, $rootScope, constants, bskCountries, unifiedStock, worldWideHelper) {
	var states=null;
	
	function isValidPaymentMethod(method) {
		if(method) {
			return method.app.visible && method.app.enabled;
		}
		return false;
	}
	
	function isValidShippingMethod(method) {
		if(method) {
			return method.app.enabled;
		}
		return false;
	}
	
	function checkMinOrderBill() {
		if(shippingState.addresses.billing.isCompany) {
			factory.forcedInvoice = true;
		} else {
			if(inditex.iStoreJSON.details.minOrderBill!==null) {
				factory.forcedInvoice=bershka.priceToUnits(factory.cart.totalOrder) > parseFloat(inditex.iStoreJSON.details.minOrderBill);
			} else {
				factory.forcedInvoice=false;
			}
		}
		
		factory.invoiceNif = (shippingState.addresses.billing.company && shippingState.addresses.billing.company.vatin) || shippingState.addresses.billing.vatin;
		factory.invoice=factory.forcedInvoice;
		
		for (var i = 0, len = factory.cart.items.length; i < len; i++) {
			var item = factory.cart.items[i];
			if(inditex.xIsGiftCard(item)) {
				factory.hasGiftCards=true;
				break;
			}
		}
	}

	function setBillingShippingAddress(recoveredBilling, shippingAddressId) {
		var billing=userAddresses.find("id", factory.cart.billingAddressId);
		if(!billing) {
			billing=recoveredBilling;
		}

		shippingState.addresses.billing=$.extend(true, {}, billing);
		shippingState.addresses.shipping=userAddresses.find("id", shippingAddressId) || userAddresses.getLastShipping();
		
		if(!shippingState.addresses.billing.vatin && shippingState.addresses.billing.isCompany && shippingState.addresses.billing.company) {
			shippingState.addresses.billing.vatin = shippingState.addresses.billing.company.vatin;
		}
	}
	
	function setOrderAddressDefaults() {
		shippingState.addresses.useInstant=false;
		var countryCode = inditex.iStoreJSON.countryCode.toUpperCase();
		var isWW = bskCountries.isInWW();
		
		if(shippingState.addresses.shipping && shippingState.addresses.shipping.isFullAddress && (isWW || shippingState.addresses.shipping.countryCode == countryCode)) {
			shippingState.addresses.instant=shippingState.addresses.shipping;
			shippingState.addresses.useInstant=true;
		} else if(shippingState.addresses.billing && shippingState.addresses.billing.isFullAddress && (isWW || shippingState.addresses.billing.countryCode == countryCode)) {
			shippingState.addresses.instant=shippingState.addresses.billing;
			shippingState.addresses.useInstant=true;
		}

		/*
		 * Solo pueden editar billing:
		 *   - Usuarios guest
		 *   - Usuarios registrados sin billing completa
		 */
		shippingState.addresses.canEditBilling=inditex.iUserJSON.userType=="G" || !shippingState.addresses.billing.isFullAddress;
		
		if(!shippingState.addresses.shipping) {
			shippingState.addresses.shipping = $.extend(true, {}, userAddresses.getLastShipping() || shippingState.addresses.billing);
			if(shippingState.addresses.shipping.countryCode !== countryCode) {
				shippingState.addresses.shipping = addressHelper.emptyAddress();
			}
			shippingState.addresses.isSameAddress = shippingState.addresses.canEditBilling;
		} else {
			shippingState.addresses.isSameAddress = shippingState.addresses.canEditBilling && shippingState.addresses.billing.id==shippingState.addresses.shipping.id;
		}

		// Por seguridad si no se puede seleccionar empresa en billing lo forzamos
		if(!userAddresses.canSelectCompany) {
			shippingState.addresses.billing.isCompany=false;
			shippingState.addresses.billing.company=null;
		}
		
		checkMinOrderBill();
	}
	
	function isCronos(method) {
		while(method) {
			if(method.app.cronosEnabled) {
				return true;
			}
			method = method.app.parent;
		}
		return false;
	}
	
	function setShippingMethod(method) {
		if(method.app.cronosEnabled && !method.app.parent) {
			shippingState.methods.selected = method;
			shippingState.step = constants.shipping.steps.ADDRESS_FORM;
		} else if(method.app.parent && method.app.parent.app.cronosEnabled) {
			shippingState.methods.selected = method.app.parent;
			shippingState.methods.specific = method;
			shippingState.step = constants.shipping.steps.SPECIFIC_SELECT;
		} else {
			shippingState.methods.selected = method;
			shippingState.step = shippingState.addresses.instant && method ? constants.shipping.steps.ADDRESS_FORM : constants.shipping.steps.METHOD_SELECT;
		}
	}
	
	function cronosGetSpecifics() {
		var id, zipCode;
		if(shippingState.addresses.useInstant) {
			id=shippingState.addresses.instant.id;
			zipCode=shippingState.addresses.instant.zipCode;
		} else {
			if(shippingState.addresses.shipping.id) {
				id = shippingState.addresses.shipping.id;				
				zipCode = shippingState.addresses.shipping.zipCode;
			} else if(shippingState.addresses.billing.id) {
				id = shippingState.addresses.billing.id;
				zipCode = shippingState.addresses.billing.zipCode;
			}
		}

		if(zipCode && id) {
			return shippingMethods.get(zipCode, id);
		}
		return shippingMethods.get();
	}
	
	function processFromCache(cb) {
		var shippingAddressId, physicalStoreId, shippingMethodId=cache.get("methodID"), step=cache.get("step");
		
		if(step=="payment" && factory.cart.shipping) { // tenemos shipping info
			if(factory.cart.shipping.shippingData) {
				shippingAddressId=factory.cart.shipping.shippingData.addressId || factory.cart.shipping.shippingData.walletAddressId;
				physicalStoreId=factory.cart.shipping.shippingData.physicalStoreId;
			}
			shippingMethodId=factory.cart.shipping.shippingMethodId;
		}
		
		if(!shippingMethodId || (!shippingAddressId && !physicalStoreId)) {
			step="shipping";
			if(!cache.get("hadShipping")) {
				shippingMethodId=undefined;
			}
		}

		var promises=[userAddresses.getBillingAddress(), shippingMethods.get(), userAddresses.getStates()];
		if(physicalStoreId) {
			promises.push(storesFactory.searchStore(physicalStoreId));
		} else {
			promises.push(storesFactory.searchFavourites());
		}

		return $q.all(promises).then(function(results) {
			if(step=="payment") {
				setBillingShippingAddress(results[0], shippingAddressId);
			} else if(!shippingState.addresses.billing) {
				shippingState.addresses.billing=$.extend(true, {}, results[0]);
			}
			
			setOrderAddressDefaults();
			states=results[2];
			if(physicalStoreId) {
				storesFactory.selected=results[3];
			}
			
			var shippingMethod=shippingMethods.find("id", shippingMethodId);
			
			if(isValidShippingMethod(shippingMethod)) {
				setShippingMethod(shippingMethod);
				
				var promises=[cronosGetSpecifics()];

				if(step=="payment") {
					promises.push(paymentMethods.get(), walletCards.get());
				}
				return $q.all(promises).then(function(results) {
					if(step=="payment") {
						paymentMethods.selected=paymentMethods.find("code", cache.get("methodID"));					
						factory.step=step;					
						if(!isValidPaymentMethod(paymentMethods.selected)) {
							paymentMethods.selected=null;
							orderCard.instant=null;
						}

						factory.sameBillingAddress = bskCountries.isInUE() && shippingState.methods.selected?shippingState.methods.selected.app.kind=="delivery":true;

						factory.step="payment";
					} else {
						factory.step="shipping";
					}
				});
			} else {
				factory.step="shipping";
				shippingMethods.step = constants.shipping.steps.METHOD_SELECT;
			}
		});
	}
	
	function processOrder(order) {
		factory.cart=order;
		
		if(cache.get("step")) {
			// tenemos información en la cache, seguimos con ella
			return processFromCache();
		}

		var shippingAddressId, physicalStoreId, shippingMethodId;
		
		if(factory.cart.shipping) { // tenemos shipping info
			if(factory.cart.shipping.shippingData) {
				shippingAddressId=factory.cart.shipping.shippingData.addressId || factory.cart.shipping.shippingData.walletAddressId;
				physicalStoreId=factory.cart.shipping.shippingData.physicalStoreId;
			}
			shippingMethodId=factory.cart.shipping.shippingMethodId;
		}

		var promises=[userAddresses.getBillingAddress(), userAddresses.getStates(), walletCards.get()];
		if(physicalStoreId) {
			promises.push(storesFactory.searchStore(physicalStoreId));
		} else {
			promises.push(storesFactory.searchFavourites());
		}

		return $q.all(promises).then(function(results) {
			setBillingShippingAddress(results[0], shippingAddressId);
			setOrderAddressDefaults();

			states=results[1];
			if(physicalStoreId) {
				storesFactory.selected=results[3];
			}

			return cronosGetSpecifics().then(function() {
				var shippingMethod;
				if(cache.get("hadShipping") && (shippingAddressId || storesFactory.selected)) {
					shippingMethod=shippingMethods.find("id", shippingMethodId);
				}
				
				if(isValidShippingMethod(shippingMethod) && (shippingAddressId || storesFactory.selected)) {
					setShippingMethod(shippingMethod);

					if(shippingState.methods.specific) {
						return $q.all([cronosGetSpecifics(), paymentMethods.get(), walletCards.get()]).then(function(results) {
							factory.step="payment";
						});
					} else {
						factory.step="shipping";
					}
				} else {
					factory.step="shipping";
					if (bskExperience.isEnabled() && shippingMethods.methods && shippingMethods.methods.length == 1) {
						setShippingMethod(shippingMethods.methods[0]);
						shippingMethods.step = constants.shipping.steps.ADDRESS_FORM;
					} else {
						shippingMethods.step = constants.shipping.steps.METHOD_SELECT;
					}
				}
			});
		});
	}
	
	function processOrderPreview(orderPreview) {
		factory.cart=orderPreview[0];
		shopCartService.setShopCart(orderPreview[0]);

		if(cache.get("step")) { // tenemos información en la cache, seguimos con ella
			return processFromCache();
		}
		
		var walletCard=orderPreview[1], shippingAddressId, physicalStoreId, shippingMethodId;
		
		if(factory.cart.shipping) { // tenemos shipping info
			if(factory.cart.shipping.shippingData) {
				shippingAddressId=factory.cart.shipping.shippingData.addressId || factory.cart.shipping.shippingData.walletAddressId;
				physicalStoreId=factory.cart.shipping.shippingData.physicalStoreId;
			}
			shippingMethodId=factory.cart.shipping.shippingMethodId;
		}

		if(!shippingMethodId || !(shippingAddressId || physicalStoreId)) { // intentamos procesarlo como una no OrderPreview
			return processOrder(factory.cart);
		}
		
		var promises=[userAddresses.getBillingAddress(), userAddresses.getStates(), walletCards.get()];
		if(physicalStoreId) {
			promises.push(storesFactory.searchStore(physicalStoreId));
		}

		return $q.all(promises).then(function(results) {
			if(physicalStoreId) {
				if(results[3]) {
					storesFactory.selected=results[3];
				} else {
					// intentamos procesarlo como una no OrderPreview
					factory.cart.shipping.shippingData.physicalStoreId = undefined;
					physicalStoreId = null;
				}
			}

			setBillingShippingAddress(results[0], shippingAddressId);
			setOrderAddressDefaults();

			states=results[1];

			return cronosGetSpecifics().then(function() {
				var shippingMethod;
				if(shippingAddressId || (physicalStoreId && storesFactory.selected)) {
					shippingMethod=shippingMethods.find("id", shippingMethodId);
				}
					
				if(isValidShippingMethod(shippingMethod)) {
					setShippingMethod(shippingMethod);
					if(shippingMethod.kind!="definedDeliveryDate") {
						return $q.all([cronosGetSpecifics(),paymentMethods.get()]).then(function(results) {
							if(walletCard) {
								var paymentMethod=paymentMethods.find("code",walletCard.paymentCode);
								if(isValidPaymentMethod(paymentMethod)) {
									var card=walletCards.find("hash", walletCard.hash);
									if(card) {
										if(!card.app.expired) {
											card.paymentModes=walletCard.paymentModes;
											orderCard.instant=card;
											orderCard.forMethod=paymentMethod;
											paymentMethods.selected=paymentMethod;
											factory.isWallet=true;
										} else {
											inditex.xOpenErrorPopUp(278, 'auto', inditex.text("modal.errorTitle"), inditex.text("checkout.errorExpiredCard"), null);
										}
									}
								}
							}
							
							factory.step="payment";
						});
					}
				} else {
					factory.step="shipping";
				}
			});			
		});
	}
	
	function getOrder() {
		$log.log("orderFactory", "Getting normal order");
		return shopCartService.promiseForceLoadShopCart().then(processOrder);
	}
	
	function getOrderPreview() {
		$log.log("orderFactory", "Getting order preview");
		return executeCache.execute([{
			"action": "wallet:orderPreview",
			"params": {
				"storeId": inditex.iStoreId,
				"languageId": inditex.iLangId
			}
		}]).then(function(results) {
			var preview = results[0].value;
			return shopCartService.promiseForceLoadShopCart().then(function(shopCart) {
				preview[0] = shopCart;
				return processOrderPreview(preview);
			});
		}, getOrder);
	}
	
	function getStateCode(code) {
		//return $.trim(userAddresses.showProvince ? code: states?states[0].code:"");
		return $.trim(code);
	}

	var searchState = function(prop, value) {
		for(var i=0,len=states.length;i<len;i++) {
			var state=states[i];
			var propValue=state[prop];
			if(propValue==value) {
				return state;
			} else if(prop == "name") {
				var splitName = propValue.split("/");
				for(var j=0 ; j<splitName.length; j++){
					if(splitName[j].trim() == value){
						return state;
					}
				}
			}
		}
		return null;
	};

	/*
	 * SHIPPING
	 */

	function getShippingDataForDelivery() {
		//var stateCode = getStateCode(shippingState.addresses.shipping.stateCode);
		//var province = searchState('code', stateCode);

		var data = {
			id: shippingState.addresses.shipping.id,
			firstName: shippingState.addresses.shipping.firstName,
			lastName: inditex.hasLastName() ? shippingState.addresses.shipping.lastName : "-",
			addressLines: shippingState.addresses.shipping.addressLines,
			isCompany: shippingState.addresses.shipping.isCompany,
			company: null,
			//vatin: shippingState.addresses.billing.vatin,
			city: shippingState.addresses.shipping.city,
			countryCode: shippingState.addresses.shipping.countryCode || inditex.iStoreJSON.countryCode,
			countryName: shippingState.addresses.shipping.countryName || inditex.iStoreJSON.countryName,
			zipCode: shippingState.addresses.shipping.zipCode,
			isShippingAddress: !shippingState.addresses.isSameAddress,
			gender: shippingState.addresses.billing.gender || "F",
			email: inditex.iUserJSON.email || shippingState.addresses.shipping.email,
			stateCode: shippingState.addresses.shipping.stateCode || shippingState.addresses.shipping.stateName,
			stateName: shippingState.addresses.shipping.stateName,
			//stateName: province?province.name:undefined,
			colony: shippingState.addresses.shipping.colony || undefined,
			municipality: shippingState.addresses.shipping.municipality || undefined,
			phones: shippingState.addresses.shipping.phones
		};

		if(data.isCompany) {
			data.company=$.extend({}, shippingState.addresses.shipping.company);
		}
		
		if(inditex.iUserJSON.userType!="G") {
			data.addressName=shippingState.addresses.shipping.addressName || (data.email + "|" + 'Bershka' + inditex.iStoreJSON.countryName);
		}

		if (userAddresses.hasMiddleName) {
			data.middleName = shippingState.addresses.shipping.middleName;
		}

		var countryCode = inditex.iStoreJSON.countryCode.toUpperCase();
		if (countryCode == 'TR' || countryCode == 'CN') {
			data.municipality = data.stateName;
		}
		
		data.isFullAddress = addressHelper.isFullAddress(data);

		return data;
	};

	function stringifyPhone(phone) {
		if(phone.countryCode) {
			return phone.countryCode + phone.subscriberNumber
		} else if(phone.prefixCode) {
			return phone.prefixCode + phone.subscriberNumber;
		}
		
		return phone.subscriberNumber;
	}
	
	function getShippingDataForDroppoint() {
		var droppoint=droppointsFactory.selected;
		var stateCode = getStateCode(droppoint.stateCode) || undefined;
		var province = null;

		if (droppoint.province) {
			province = searchState('name', droppoint.province.toUpperCase());
		}
		if (!province && stateCode) {
			province = searchState('code', stateCode);
		}

		var data = {
			addressLines: [droppoint.street],
			idDropPoint: droppoint.id,
			isShippingAddress: true,
			email: inditex.iUserJSON.email || shippingState.addresses.billing.email,
			firstName: shippingState.addresses.billing.firstName,
			lastName: inditex.hasLastName() ? shippingState.addresses.billing.lastName : "-",
			isCompany: false,
			company: null,
			countryCode: droppoint.countryCode,
			//countryName: shippingState.addresses.billing.countryName || inditex.iStoreJSON.countryName,
			zipCode: droppoint.zipCode,
			gender: shippingState.addresses.billing.gender || "F",
			stateCode: province?province.code:stateCode,
			stateName: province?province.name:undefined,
			phones: shippingState.addresses.billing.phones,
			dropType: droppointsFactory.droppointType,
			//vatin: shippingState.addresses.billing.vatin,
			dropPointName: droppoint.name || undefined,	
			colony: droppoint.colony || undefined,
			city: droppoint.city,
			municipality: droppoint.municipality || undefined
		};

		if (inditex.iUserJSON.userType != "G") {
			data.addressName=data.email + "|" + 'Bershka' + inditex.iStoreJSON.countryName;
		}
		if (userAddresses.hasMiddleName) {
			data.middleName = shippingState.addresses.billing.middleName;
		}

		if(droppointsFactory.newDroppointFormat) {
			data.idDropPointInterno = droppoint.internalId;
			
			if(shippingState.extraParams.same) {
				for(var key in droppointsFactory.selected.app.extraParams) {
					var dataKey=droppointsFactory.selected.app.extraParams[key].dataKey
					switch(key) {
						case "ExternalDestinationEmail":
							data[dataKey]=data.email;
							break;
						case "ExternalDestinationPhone":
							data[dataKey]=stringifyPhone(data.phones[0]);
							break;
						default:
							data[dataKey]=shippingState.extraParams[dataKey]
							break;
					}
				}
			} else {
				for(var key in droppointsFactory.selected.app.extraParams) {
					var dataKey=droppointsFactory.selected.app.extraParams[key].dataKey
					if(key == "ExternalDestinationPhone") {
						data[dataKey]=stringifyPhone(shippingState.extraParams[dataKey]);
					} else {
						data[dataKey]=shippingState.extraParams[dataKey];
					}
				}
			}			
		} else {
			data.addressLines.push(droppoint.id);
		}

		var countryCode = inditex.iStoreJSON.countryCode.toUpperCase();
		if (countryCode == 'TR' || countryCode == 'CN') {
			data.municipality = data.stateName;
		}

		if (countryCode == 'DE') {
			data.addressLines = [droppoint.id, shippingState.extraParams.idDropPointUser];
		}

		data.isFullAddress = addressHelper.isFullAddress(data);

		return data;
	};

	function getShippingDataForMail() {

		var data ={
			email: inditex.iUserJSON.email || shippingState.addresses.billing.email,
			firstName: shippingState.addresses.billing.firstName,
			lastName: shippingState.addresses.billing.lastName,
			countryCode: inditex.iStoreJSON.countryCode.toUpperCase(),
			countryName: inditex.iCountryName,
			phones: shippingState.addresses.billing.phones,
			isCompany: false,
			isShippingAddress: true
		};

		data.isFullAddress = addressHelper.isFullAddress(data);

		return data;
	};
	
	function getShippingData() {
		switch(shippingState.methods.selected.app.kind) {
			case "droppoint":
				return getShippingDataForDroppoint();
				break;
			case "delivery":
				return getShippingDataForDelivery();
				break;
			//case "mail":
				//return getShippingDataForMail();
				//break;
			default:
				return null;
		}
	}
	
	function getRealBillingData() {
		var address;
		if(factory.step == "payment") {
			address = shippingState.addresses.modBilling || shippingState.addresses.billing;
		} else {
			address = shippingState.addresses.billing;
		}
		var province = searchState('code', address.stateCode);
		var data = {
			id: address.id,
			firstName: address.firstName,
			lastName: inditex.hasLastName() ? address.lastName : "-",
			isCompany: address.isCompany || false,
			addressLines: address.addressLines && address.addressLines.length?address.addressLines:["-"],
			city: address.city,
			countryCode: address.countryCode,
			countryName: address.countryName,
			zipCode: address.zipCode,
			gender: address.gender || "F",
			email: inditex.iUserJSON.email || address.email,
			stateCode: address.stateCode || address.stateName,
			stateName: province?province.name:address.stateName || undefined,
			phones: address.phones,
			colony: address.colony,
			municipality: address.municipality,
			vatin: address.vatin,
			pec: address.PEC,
			receiverCode: address.receiverCode,
			company: null
		};
		
		if (inditex.iUserJSON.userType != "G") {
			data.addressName=address.addressName || (data.email + "|" + 'Bershka' + inditex.iStoreJSON.countryCode);
		}

		if (userAddresses.hasMiddleName) {
			data.middleName = address.middleName;
		}

		var countryCode = inditex.iStoreJSON.countryCode.toUpperCase();
		if (address.isCompany) {
			data.vatin = address.vatin;
			data.company = {
				vatin: address.vatin,
				name: address.company.name,
				registrationNumber: address.company.registrationNumber
			};

			if (countryCode == "TR") {
				data.company.taxOffice = address.company.taxOffice;
			}
		}

		if (countryCode == 'TR' || countryCode == 'MX' || countryCode == 'CN') {
			data.municipality = address.stateCode;
		}
		
		data.isFullAddress=addressHelper.isFullAddress(data);
		
		return data;
	}
	
	function getBillingData() {
		var data;
		if(shippingState.addresses.isSameAddress && !shippingState.methods.selected.app.directToBilling) {
			data = getShippingData();
			data.isShippingAddress=false;
			data.id=shippingState.addresses.billing.id;
		//} else if (shippingState.methods.selected.app.kind == "mail" && bskCountries.isInUE()) {
		//	data = getShippingData();
		} else {
			data = getRealBillingData();
		}
		
		return data;
	}
	
	function getZipCodeAddress() {
		if(shippingState.addresses.useInstant) {
			return shippingState.addresses.instant;
		} else {
			return shippingState.addresses.shipping;
		}
	}
	
	function getZipCodeForAddress() {
		var address = getZipCodeAddress();
		
		var countryCode = inditex.iStoreJSON.countryCode.toUpperCase();
		if(countryCode=="CN" || countryCode=="TR") {
			return address.colony.split("#")[0];
		}

		return address.zipCode;
	}
	
	function doCheckZipCode(defer) {
		shippingMethods.get(getZipCodeForAddress()).then(function(methods) {
			if(shippingMethods.find("id", shippingState.methods.selected.id)) {
				if(shippingMethods.sameDayMethod && !shippingState.methods.selected.app.sameDay) {
					inditex.xOpenConfirmPopup("hasSameDayMethod", "hasSameDayMethodModal", function ($element) {
						if ($element.hasClass("changeShippingMethod")) {
							factory.showShippingMethods();
							defer.reject();
						}
					}, null, function () {
						defer.resolve();
					});
				} else {
					defer.resolve();
				}
			} else {
				factory.showShippingMethods();
				inditex.xOpenErrorPopUp(478, 'auto', null, inditex.text("shipping.zipCodeInvalidShippingMethod"));
				defer.reject();
			}
		}, function(error) {
			defer.reject(error);
		});
	}
	
	function checkZipCode() {
		var defer=$q.defer();
		
		if(shippingState.methods.selected.app.kind!="delivery" || shippingState.methods.selected.app.cronosEnabled) {
			defer.resolve();
		} else {
			var address = getZipCodeAddress();
			var countryCode = address.countryCode.toUpperCase();
			if(bskCountries.isInWW() && address && countryCode != inditex.iStoreJSON.countryCode.toUpperCase()) {
				worldWideHelper.setISO(countryCode);
				executeCache.execute([{
					action: 'catalog:store',
					params: {
						storeId: inditex.iStoreId,
						languageId: inditex.iLangId,
						countryISO: countryCode
					},
					force: true
				}]).then(function(results) {
					inditex.iStoreJSON = results[0].value;
					bskCountries.init();
					doCheckZipCode(defer);
				});
			} else {
				doCheckZipCode(defer);
			}
		}
		return defer.promise;
	}

	function wwProtectBilling() {
		var newBilling = $.extend(true, {}, shippingState.addresses.billing);
		newBilling.countryCode = shippingState.addresses.shipping.countryCode;
		newBilling.countryName = shippingState.addresses.shipping.countryName;
		
		var billingToShipping = $.extend(true, {}, shippingState.addresses.billing);
		delete billingToShipping.id;
		delete billingToShipping.addressType;
		billingToShipping.isShippingAddress = true;

		return userAddresses.add(newBilling).then(function(address) {
			shippingState.addresses.billing = $.extend(true, {}, address);
			return userAddresses.add(billingToShipping).catch(function() {
				return $q.resolve();
			});
		}, function() {
			return $q.resolve();
		});
	}
	
	function commitShippingInfo() {
		var method=shippingState.methods.specific || shippingState.methods.selected;

		var promise = $q.resolve();
		if(bskCountries.isInWW() && shippingState.addresses.shipping.countryCode != shippingState.addresses.billing.countryCode && method.kind == "delivery") {
			if(!bskCountries.isInUE() || !bskCountries.isCountryInUE(shippingState.addresses.billing.countryCode)) {
				promise = wwProtectBilling();
			}
		}

		var action={
			"action": "order:checkoutShipping",
			"params": {
				"storeId": inditex.iStoreId,
				"orderId": shopCartService.getShopCartId(),
				"languageId": inditex.iLangId
			},
			"data": {
				"shippingMethodId": method.id,
				"name": method.name,
				"kind": method.kind,
				"shippingData": {
				},
				deliveryInfo: method.deliveryInfo || undefined
			}
		};
		
		return promise.then(function() {
			switch(method.kind) {
				case "mail":
					action.data.shippingData.addressId=shippingState.addresses.billing.id;
					break;
				case "pickup":
					action.data.shippingData.physicalStoreId=storesFactory.selected.id;
					break;
				case "delivery":
				case "droppoint":
				case "dropbox":
					action.data.shippingData.addressId=shippingState.addresses.shipping.id;
					break;
				case "definedDeliveryDate":
					action.data.shippingData.addressId=shippingState.addresses.shipping.id;
					action.data.datetime = shippingState.datetime + "";
					action.data.idTimeRange = shippingState.idTimeRange + "";
					break;
			}
			
			return executeCache.execute([action]).then(function(results) {
				return results[0].value;
			});
		});
	}
	
	
	/*
	 * PAYMENT
	 */
	
	function getPaymentCard() {
		var card = null;

		if (orderCard.instant) {
			card = {
				cardHash: orderCard.instant.hash,
				paymentMethodKind: 'walletcard',
				paymentMethodType: 'walletcard'
			};
			if (orderCard.instant.paymentModeId!==undefined) {
				card.paymentModeId = orderCard.instant.paymentModeId
			}
			if(!orderCard.isTrustedPayment()) {
				if(paymentMethods.selected.kind=="affinity") {
					card.number=orderCard.card.trustedInfo || "";
				} else {
					card.cvv2=orderCard.card.trustedInfo || "";
				}
			}
		} else if(paymentMethods.selected){
			switch (paymentMethods.selected.app.kind) {
				case 'credit_card':
					card = {
						cvv2: orderCard.card.cvv2,
						holder: orderCard.card.holder,
						month: parseInt(orderCard.card.expiration.split("-")[0]),
						number: orderCard.card.number,
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type,
						year: parseInt(orderCard.card.expiration.split("-")[1]),
						paymentModeId: orderCard.card.paymentModeId // undefined si no tiene installments
					};
					break;
				case 'affinity':
					card = {
						holder: orderCard.card.holder,
						vatin: orderCard.card.vatin,
						number: orderCard.card.number,
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type,
						paymentModeId: orderCard.card.paymentModeId
					};
					break;
				case 'paypal':
				case 'cod':
				case 'kcpcybersource': 
				case 'bancontact_qr':
					card = {
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};
					break;
				case 'multibanco':
					card = {
						eShopperCode: inditex.iStoreJSON.countryCode.toUpperCase(),
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};
					break;
				case 'p24':
					card = {
						eShopperCode: 'PL',
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};
					break;
				case 'ideal':
					card = {
						eShopperCode: orderCard.card.bank,
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};
					break;
				case 'kaccount':
				case 'kinvoice':
					card = {
						kbPNO: orderCard.card.personalNumber,
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};

					card.kbGender = orderCard.card.gender;

					if(factory.isGuestUser) {
						card.address={
							addressName: shippingState.addresses.billing.addressLines[0]+" "+shippingState.addresses.billing.addressLines[1],
							zipCode: shippingState.addresses.billing.zipCode,
							city: shippingState.addresses.billing.city,
							stateName: shippingState.addresses.billing.state
						}
					}

					break;
				case "gift_card":
					break;
				default:
					card = {
						paymentMethodKind: paymentMethods.selected.kind,
						paymentMethodType: paymentMethods.selected.type
					};
					break;
			}
		}

		return card;
	}

	function commitPaymentInfoError(errorKey, errorMessage) {
		$('#message_modal').dialog('close');
		var msg;
		if (errorKey) {
			if (errorKey == "_ERR_CREDIT_CARD_EXPIRED") {
				msg=inditex.text("checkout.errorExpiredCard");
			} else {
				msg = bershka.getErrorDescription(errorMessage) || inditex.text("modal.errorTitle");
			}
		} else {
			msg=inditex.text("modal.genericError");
		}
		
		hideProcessing();
		inditex.xOpenErrorPopUp(278, "auto", inditex.text("modal.errorTitle"), msg, null);
		if(errorKey) {
			trackingService.trackEvent({
				name: 'error-pago',
				data: {
					errorMessage: errorKey
				}
			});
		}
	}

	function commitShippingError(error) {
		hideProcessing();
		inditex.xOpenErrorPopUp(278, "auto", inditex.text("modal.errorTitle"), bershka.getErrorDescription(error), null);		
	}
	
	function billingAddressMandatory() {
		if (shopCartService.getTotalPrice() == 0) {
			return $q.resolve();
		}
		
		if (!factory.sameBillingAddress && shippingState.methods.selected.app.kind == "delivery" && factory.invoice) {
			return freeBillingAddress();
		}

		if ((paymentMethods.selected.billingAddressMandatory == "1" || factory.invoice) && (!shippingState.addresses.billing.isFullAddress || !factory.sameBillingAddress)) {
			return userAddresses.add(getRealBillingData());
		}
		
		if(shippingState.addresses.billing.isCompany && shippingState.showRegistrationNumber && !shippingState.addresses.billing.company.registrationNumber) {
			return userAddresses.add(getRealBillingData());
		}

		if(!userAddresses.compareAddresses(shippingState.addresses.modBilling || shippingState.addresses.billing, shippingState.addresses.billing)) {
			return userAddresses.add(getRealBillingData());
		}
		
		return $q.resolve(shippingState.addresses.billing);		
	}

	function freeBillingAddress() {
		var defer=$q.defer();

		if (shippingState.addresses.billing.id != shippingState.addresses.shipping.id) {
			return userAddresses.add(getRealBillingData());
		}

		// Guardamos la dirección de facturación como de envio
		var address=$.extend(true, {}, shippingState.addresses.billing);

		address.isShippingAddress = true;
		delete address.id;
		delete address.addressType;

		userAddresses.add(address).then(function(newAddress) {
			// Asociamos la nueva dirección de envio como dirección del pedido
			shippingState.addresses.shipping = newAddress;
			commitShippingInfo().then(function() {
				var newBillingAddress = getRealBillingData();
				newBillingAddress.isShippingAddress = false;
				// Actualizamos la billing
				userAddresses.add(newBillingAddress).then(function(){
					defer.resolve();
				});
			});
			
		});
		
		return defer.promise;
	}
	
	function registerNewsletter() {
		return executeCache.execute([{
            "action": "user:subscribeNewsletterRequest",
            "params": {
                "storeId" : inditex.iStoreId,
                "languageId": inditex.iLangId
            },
            "data": {
                "address" : {
                    "email" : shippingState.addresses.shipping.email || shippingState.addresses.billing.email
                },
                "newsletter" :  "CheckoutGuest",
				"privacyPolicyAccepted" :  true
            }
        }]);
	}

	function hideProcessing() {
		var modal=$("#message_modal");
		if(modal.length && modal.is(":visible")) {
			modal.dialog("close");
		}
	}

	var showShippingPrivacyPolicy=inditex.iUserJSON.userType=="G" && GDPRHelper.active;
	
	var factory={
		sameBillingAddress: true,
		cart: null,
		invalidOrder: false,
		hasGiftCards: false,
		isGuestUser: inditex.iUserJSON.userType=="G",
		showShippingPrivacyPolicy: showShippingPrivacyPolicy,
		shippingPrivacyPolicy: !showShippingPrivacyPolicy,
		paymentPrivacyPolicy: false,
		registerNewsletter: false,
		forcedInvoice: false,
		invoice: false,
		step: null,
		isWallet: false,
		bskExperienceEnabled: function() {
			return bskExperience.isEnabled();
		},
		bskExperienceCanSelectShipping: function() {
			if(!this.bskExperienceEnabled()) {
				return true;
			}
			if(!shippingMethods.methods) {
				return false;
			}
			return shippingMethods.methods.length > 1;
		},
		setProcessingShipping: function(state) {
			if(state) {
				var content=$("#continuingToPayment").html();
				if(content) {
					trackingService.setPopupUpSilent(true);
					inditex.popupHtml(content, 350, 200, undefined, undefined, 'message_modal', false, undefined, true, "processing-shipping");
				}
			} else {
				hideProcessing();
			}
		},
		setProcessingPayment: function(state) {
			if(state) {
				var content=$('#processingOrder').html();
				if(content) {
					trackingService.setPopupUpSilent(true);
					inditex.popupHtml(content, 300, "auto", undefined, undefined, 'message_modal', false, undefined, true, "processing-order");
				}
			} else {
				hideProcessing();
			}
		},
		persist: function() {
			cache.set("step", this.step);
			
			cache.remove("methodID");
			cache.set("hadShipping", !!shippingState.methods.selected);
			if(this.step=="shipping") {
				if(shippingState.methods.specific) {
					cache.set("methodID", shippingState.methods.specific.id);
				} else if(shippingState.methods.selected) {
					cache.set("methodID", shippingState.methods.selected.id);
				}
				orderCard.remove();
				shippingState.persist();
			} else {
				if(paymentMethods.selected) {
					cache.set("methodID", paymentMethods.selected.code);
				}
				orderCard.persist();
				shippingState.remove();
			}
		},
		showShippingMethods: function() {
			this.step="shipping";
			shippingState.step = constants.shipping.steps.METHOD_SELECT;
			shippingState.methods.selected=null;
			shippingState.methods.specific=null;
			this.persist();
			bershka.scrollToTop();
		},
		showShippingTypes: function() {
			this.step = "shipping";			
			shippingState.addresses.selectedInstant=null;
			shippingState.step = constants.shipping.steps.SPECIFIC_SELECT;
			this.persist();
			bershka.scrollToTop();
		},
		showAddressForm: function() {
			this.step = "shipping";
			shippingState.step = constants.shipping.steps.ADDRESS_FORM;
			//shippingState.addresses.useInstant = !!shippingState.addresses.instant;
			this.persist();
			bershka.scrollToTop();
		},
		editShipping: function() {
			this.step = "shipping";
			shippingState.step = constants.shipping.steps.ADDRESS_FORM;
			this.persist();
			bershka.scrollToTop();
		},
		showPaymentMethods: function() {
			this.step = "payment";
			paymentMethods.selected = null;
			this.persist();
			bershka.scrollToTop();
		},
		commitShipping: function() {
			var defer=$q.defer();
			function commitInfo() {
				checkZipCode().then(function() {
					if(!shippingState.methods.selected.app.cronosEnabled || shippingState.step == constants.shipping.steps.SPECIFIC_SELECT) {
						commitShippingInfo().then(function(order) {
							trackingService.trackEvent({
								name: 'seleccionar-envio',
								data: {
									selectedShippingMethod: shippingState.methods.specific || shippingState.methods.selected
								}
							});

							trackingService.trackEvent({ name: 'siguiente-paso' });
							
							checkMinOrderBill();
							factory.cart=order;
							factory.step="payment";
							factory.persist();
							bershka.scrollToTop();
							//cache.remove("billing").remove("shipping").persist();
							
							factory.invoiceNif=shippingState.addresses.billing.vatin || (shippingState.addresses.billing.company?shippingState.addresses.billing.company.vatin: null);
							
							shopCartService.setShopCart(order);
							
							hideProcessing();
							
							paymentMethods.get(true).then(function() {
								defer.resolve(factory)
							});
							
							factory.sameBillingAddress = bskCountries.isInUE() && shippingState.methods.selected?shippingState.methods.selected.app.kind=="delivery":true;
								
						}, function (error) {
							commitShippingError(error);
							defer.reject(error);
						});
					} else {
						factory.showShippingTypes();
						hideProcessing();
					}
				}, function() {
					defer.resolve(factory);
					hideProcessing();					
				});
			}
			
			function submitShipping() {
				if(shippingState.addresses.useInstant && shippingState.methods.selected.app.kind=="delivery") {
					shippingState.addresses.shipping=$.extend(true, {}, shippingState.addresses.instant);
					commitInfo();
				} else {
					if(shippingState.addresses.useInstant) {
						shippingState.addresses.instant = $.extend(true, {}, shippingState.addresses.shipping);
					}
					userAddresses.add(getShippingData()).then(function(address) {
						if(shippingState.addresses.isSameAddress && shippingState.methods.selected.app.kind!="droppoint") {
							shippingState.addresses.billing=$.extend(true, {}, address);
						}
						
						shippingState.addresses.shipping=$.extend(true, {}, address);
						commitInfo();
					}, function (error) {
						commitShippingError(error);
						defer.reject(error);
					});
				}
			}
			
			if(shippingState.addresses.selectedInstant && shippingState.addresses.useInstant && shippingState.methods.selected.app.kind=="delivery") {
				shippingState.addresses.instant = shippingState.addresses.selectedInstant;
			}

			factory.setProcessingShipping(true);
			if(shippingState.addresses.useInstant && !shippingState.methods.selected.app.directToBilling) {
				submitShipping();
			} else if(shippingState.addresses.canEditBilling || shippingState.methods.selected.app.directToBilling) {
				var billingData=getBillingData();
				userAddresses.add(billingData).then(function(address) {
					if(!billingData.isShippingAddress) {
						shippingState.addresses.billing=$.extend(true, {}, address);
						if((!shippingState.addresses.isSameAddress && !shippingState.methods.selected.app.directToBilling) || shippingState.methods.selected.app.kind=="droppoint") {
							submitShipping();
						} else {
							shippingState.addresses.shipping=$.extend(true, {}, address);
							commitInfo();
						}
					} else {
						shippingState.addresses.shipping=$.extend(true, {}, address);
						commitInfo();
					}
				}, function (error) {
					commitShippingError(error);
					defer.reject(error);
				});
			} else {
				submitShipping();
			}
			
			return defer.promise;			
		},
		commitPayment: function () {
			var urlKo = inditex.encodeUrl({
				action: 'ItxCheckoutPage',
				params: {
					storeId: inditex.iStoreId,
					langId: inditex.iLangId,
					catalogId: inditex.iCatalogId
				}
			});
			inditex.setSessionStorage('checkoutOrderId',factory.cart.id);

			if (this.saveCard) {
				inditex.setSessionStorage('saveWalletCards', true);
			}

			trackingService.trackEvent({
				name: 'seleccionar-pago',
				data: {
					'paymentMethodKind': paymentMethods.selected && paymentMethods.selected.kind
				}
			});

			var defer=$q.defer();
			var toWait=null;
			if(factory.registerNewsletter) {
				toWait=registerNewsletter();
			}

			$q.when(toWait).then(function(data) {
				if (data && data[0] && data[0].state=="resolved") {
						var trackLabel = "checkout";
						if (inditex.iUserJSON.userType == "G") {
							trackLabel = "checkout-guest";
						}
						trackingService.trackEvent({
							name:'newsletter-checkbox-succeed',
							data: {
								label: trackLabel
							}
						});
					}
				},
				function(error) {
					var code = error[0] && error[0].value ?error[0].value.code: undefined;
					var trackLabel = "checkout";
					if (inditex.iUserJSON.userType == "G") {
						trackLabel = "checkout-guest";
					}
					trackingService.trackEvent({
						name:'newsletter-checkbox-fail',
						data: {
							label: trackLabel + ':'	+ code
						}
					});
				}
			).finally(function() {
				if(factory.invoice) {
					trackingService.trackEvent({ name: 'solicitar-factura' });
				}
				if(factory.saveCard) {
					trackingService.trackEvent({ name: 'anadir-tarjeta' });
				}
				billingAddressMandatory().then(function() {
					inditex.submitPayment({
						"walletCheckBox": false,
						"walletCardName": false,
						"urlKo": urlKo,
						"addressId": shippingState.addresses.billing.id,
						"oneClickPayment": factory.isWallet && inditex.isOneClickAvailable ? "1" : "0",
						"invoice": factory.invoice ? "1" : "0",
						"vatin": factory.invoice?factory.invoiceNif:null,
						"onStart": function() {
							factory.setProcessingPayment(true);
						},
						"onError": commitPaymentInfoError,
						"card": getPaymentCard()
					});
				}, function(result) {
					commitPaymentInfoError(result);
					defer.reject(result);
				});
			});
			return defer.promise;
		},
		get: function() {
			var defer=$q.defer();

			function resolve() {
				this.invalidOrder=shopCartService.hasVirtualAndPhysicalItems();
             
				if(shippingState.addresses.useInstant && shippingState.addresses.instant.countryCode != inditex.iStoreJSON.countryCode.toUpperCase()) {
					return shippingMethods.getShippingAddresses().then(function(addresses) {
						var id = shippingState.addresses.instant.id
						shippingState.addresses.instant=null;
						shippingState.addresses.useInstant=false;
					  
						for (var i = addresses.length - 1; i >= 0; i--) {
							var address = addresses[i];
							if(address.id != id) {
								shippingState.addresses.instant = address;
								shippingState.addresses.useInstant = true;
								break;
							}
						}
					  
					});
				}
			}

			
			return bskExperience.prepareOrder().then(function() {
				if(inditex.iUserJSON.isWalletUser) {
					return getOrderPreview(resolve);
				} else {
					return getOrder(resolve);
				}
			});
			
			return defer.promise;
		}
	};
	
	$rootScope.$on(bershka.events.CheckoutPersist, function() {
		factory.persist();
	});
	
	$log.publish("orderFactory", factory);
	return factory;
}]);
/* END FIX ECOMBSKA-9516 */

/* FIX ECOMBSKA-9514 */
(function() {
	var oldBootstrap = angular.bootstrap;	
	var reg = /[^=]+\s*=\s*(.*)/g;
	
	var commentReg = /<!--.*-->/g;
		
	function parseConfigurations(id, text) {
		if(!id) {
			return;
		}
		
		text = text.replace(commentReg, "");
		var value;
		
		if(id == 'xWarehouseStores') {
			text = text.replace(/\s/g,"");
			if(text) {
				value = text.split(",").map(function(elem) {
					return "BK-PST-"+elem;
				});
			} else {
				value = [];
			}
		} else {
			value = text;
		}
		
		inditex[id] = value;
	}

	
	function parseTranslations(text) {
		var properties = text.indexOf("\n") != -1 ? text.split("\n") : text.split("\r");

		for(var j=0, len2=properties.length; j<len2; j++) {
			var matches = properties[j].match(reg) || [];

			for(var i=0, len=matches.length; i<len; i++) {
				var splitted = matches[i].split("=", 2);
				splitted = splitted.map(function(elem) {
					return elem.trim()
				});
				if(splitted.length==2 && splitted[0] && splitted[1] && splitted[0].indexOf("<!--")!==0) {
					inditex.addText(splitted[0], splitted[1]);
				}
			}
		}
	}
	
	angular.bootstrap = function() {
		var args = arguments;
		inditex.xGetMSpots(["BK3_ESpot_SINT","BK3_ESpot_SINTOPEN"], function(values) {
			for(var i=0, len=values.BK3_ESpot_SINT.length; i<len; i++) {
				parseTranslations(values.BK3_ESpot_SINT[i]);
			}
			for(var i=0, len=values.BK3_ESpot_SINTOPEN.length; i<len; i++) {
				parseConfigurations("xWarehouseStores", values.BK3_ESpot_SINTOPEN[i]);
			}
			oldBootstrap.apply(angular, args);
		}, function() {
			oldBootstrap.apply(angular, args);
		});
	}
})();

(function() {
	angular.module('itxApp').service('itemStockOriginService', itemStockOriginService);

	function itemStockOriginService () {
		function get (item) {
			if(item.stockLocations) {
				for(var j=0, len2=item.stockLocations.length; j<len2; j++) {
					var stockLocation = item.stockLocations[j];
					if(stockLocation.stockSourceCode) {
						if (inditex.xWarehouseStores && inditex.xWarehouseStores.indexOf(stockLocation.stockSourceCode) != -1) {
							return 'WAREHOUSESTORE';
						};

						if(stockLocation.stockSourceCode.indexOf('BK-PST') == 0 || stockLocation.stockLocationId == "2") {
							return 'STORE';
						}
					}
				}
			}
			return 'WAREHOUSE';
		}

		this.get = get;
	}
})();


shopCartItemCtrl.prototype.showReceiveLaterMessage = function() {
	return this.enabledSINTCart == "1" && (this.iProduct.stockOrigin == 'STORE' || this.iProduct.stockOrigin == 'WAREHOUSESTORE');
};

shopCartItemCtrl.prototype.getLaterText = function() {
	var message = this.iProduct.stockOrigin == 'STORE' ? inditex.text('shopcart.sint') : inditex.text('shopcart.sintopen');
	return message && message.substr(0,3) != '???' ? message : '';
}

shopCartItemCtrl.prototype.init=function() {
	this.enabledSINTCart = this.configurationFactory.inmediate('enable_messageSINT_cart') == "1";
};

shopCartItemCtrl.prototype.getProductUrl = shopCartItemCtrl.prototype.getProductURL;

(function(angular,inditex,$) {
	'use strict';

	angular.module("itxApp").service("shopCartService", ["itemStockOriginService", "bskCountries", "trackingService", "$log", "jetloreTracking", "bskProductColorHelpers", "$q", "bskStateFactory", "unifiedStockConstants", "userOrdersFactory", shopCartService]);
	
	var jetloreTracking;
	var productColorHelps;
	var isDeferredPersistence=false;
	
	var filteredItems = [];
	var filteredItemsOrder = [];

	// número de items que se guardan en la cache de últimos productos añadidos
	var maxLastItemsCached = 1;
	// array con los últimos productos añadidos a la cesta
	var lastAddedItems = [];
	// cache de productId # colorId con estilos para recuperarlos al hacer un update de un producto
	var cacheItemsWithStyle = {};
	
	var shopCart = null;
	
	// marca si hay una acción o acciones en proceso para que no se lancen nuevas hasta que finalize
	var updateInProgress = false;
	
	// semáforo que cuenta el número de controladores/servicios que han bloqueado el shopCartService con el blockCheckout
	var blockedFromController = 0;
	
	var loadShopCartCallbacks=[];
	
	var stockOriginService;
	
	function shopCartService(itemStockOriginService, bskCountries, trackingService, $log, jetloreTrack, productColorHelpers, $q, stateFactory, unifiedStock) {
		this.trackingService = trackingService;
		this.unifiedStock = unifiedStock;
		this.bskCountries = bskCountries;
		stockOriginService = itemStockOriginService;
		this.$log=$log;
		this.$q = $q;
		jetloreTracking = jetloreTrack;

		$log.publish("shopCartService", this);
		var alwaysPages=bershka.config("AlwaysPersistToServer");
		if(alwaysPages && alwaysPages.length && bershka.getStoreConfiguration("ShopCartDeferPersist")=="1") {
			isDeferredPersistence=alwaysPages.indexOf(inditex.iPage)==-1 && alwaysPages.indexOf("*")==-1;
		}
		
		productColorHelps=productColorHelpers;
		
		if(inditex.iPage != "ItxOrderConfirmationPage") {
			updateLocalShopCart();
		}
	};
	
	window.shopCartService=shopCartService;
	
	function applyShopCartItemsStyleAndCategory(items) {
		for(var i=0,len=items.length;i<len;i++) {
			var item=items[i];
			
			item.stockOrigin = stockOriginService.get(item)
			item.hasStyle=false;

			if(!item.availability) {
				item.availability="in_stock";
			}

			if(item.image && !item.image.style) {
				item.image.style=[];
			}
			
			if(item.origin && item.origin.length) {
				var style=item.origin[0].style;
				if(style) {
					if(!cacheItemsWithStyle[item.id]) {
						cacheItemsWithStyle[item.id]={};
					}
					cacheItemsWithStyle[item.id][item.colorId]=style;

					if(item.image) {
						item.image.style.push(style);
					}
					item.style=style;
					item.hasStyle=true;
				}
				
				item.categoryId=item.origin[0].categoryData || "0";
			} else if(item.style) {
				item.hasStyle=true;
				if(item.image) {
					item.image.style=[item.style];
				}
			}
		}
	}
	
	function orderShopCartItems(items) {
		// si tenemos un orden preestablecido (p.ej. se ha sustituido un SKU),
		// lo reaplicamos
		items.sort(function(a,b) {
			var indexOfA=filteredItemsOrder.indexOf(a.sku);
			var indexOfB=filteredItemsOrder.indexOf(b.sku);
			if(indexOfA<0 || indexOfB<0) {
				return 0;
			}
			return indexOfA-indexOfB;
		});
		filteredItemsOrder=[];
	}
	
	function finishLoadShopCart(shoppingCart) {
		shoppingCart.giftTicket = (shoppingCart.giftTicket==1);
		
		shopCart = shoppingCart;
		
		inditex.iUserJSON.shopCart = shoppingCart;
		
		var preOrderFiltered=bershka.filterShopCartItems(shopCart.items);
		
		orderShopCartItems(preOrderFiltered);
		
		applyShopCartItemsStyleAndCategory(preOrderFiltered);
		
		filteredItems=preOrderFiltered;
		
		if(isDeferredPersistence) {
			var totalPrice=0;
			for (var i = 0, len = filteredItems.length; i < len; i++) {
				var item = filteredItems[i];
				totalPrice += parseInt(item.unitPrice,10)*item.quantity;
			}
			shopCart.totalProduct=totalPrice;
			shopCart.totalOrder=totalPrice;
		}
		
		// si se añaden elemento, cambiamos los que tenemos temporalmente en el lastAddedItems
		// por sus definitivos
		for(var i=0, lastItemsLength=lastAddedItems.length; i<lastItemsLength; i++) {
			var sku=lastAddedItems[i].sku;
			for(var j=0, filteredItemsLength=filteredItems.length; j<filteredItemsLength; j++) {
				if(filteredItems[j].sku == sku) {
					lastAddedItems[i]=filteredItems[j];
					break;
				}
			}
		}
	}
	
	function doLoadShopCart(callback, forced) {
		if(callback && typeof callback == "function") {
			loadShopCartCallbacks.push(callback);
		}
		if(updateInProgress) {
			return;
		}
		updateInProgress=true;
		
		var action={
			action: "user:currentUser", 
			params: {
				"storeId" : inditex.iStoreId,
				"languageId": inditex.iLangId
			}
		}
		
		var useArg=true;
		if(!isDeferredPersistence || forced) {
			action.action = "order:shoppingCart";
		} else {
			useArg=false;
		}
		
		inditex.execute({
			"actions": [action],
			"onFinish": function (status, shoppingCart) {
				updateInProgress = false;
				
				var callbacks=loadShopCartCallbacks;
				loadShopCartCallbacks=[];

				if(!useArg) {
					shoppingCart=inditex.iUserJSON && inditex.iUserJSON.shopCart || {};
				} else if(status!=1){
					shoppingCart={};
				}

				if(status==1) {
					finishLoadShopCart(shoppingCart);
				}
				
				productColorHelps.setColorOverrideName(filteredItems);
				
				shopCartService.$parsers.callAll(shopCartService, filteredItems);

				// Ejecutamos todos los callbacks, realmente tendríamos que pasar
				// como primer parámetro una copia del shoppingCart o nuestra propia
				// instancia
				for(var i=0,len=callbacks.length;i<len;i++) {
					var callback = callbacks[i];
					if(typeof callback === 'function'){
						callback(status, shoppingCart);
					}
				}
			}
		});
	};
	
	shopCartService.prototype.setShopCart=function(shopCart) {
		if(shopCart) {			
			var totalProduct = shopCart.totalProduct;
			var totalOrder = shopCart.totalOrder;
			finishLoadShopCart(shopCart);
			shopCart.totalOrder = totalOrder;
			shopCart.totalProduct = totalProduct;
			
			productColorHelps.setColorOverrideName(filteredItems);
			shopCartService.$parsers.callAll(shopCartService, shopCart.items);
		}
	};
	
	function triggerLoadCallbacks() {
		var callbacks = loadShopCartCallbacks;
		loadShopCartCallbacks = [];
		
		for(var i=0,len=callbacks.length;i<len;i++) {
			var callback = callbacks[i];
			if(typeof callback === 'function'){
				callback(1, shopCart);
			}
		}
	}

	function execUpdateItems(items, quiet) {
		if(updateInProgress) {
			return;
		}
				
		updateInProgress = true;
		var errorElems = [];
		
		function doneAction(status, item, index) {
			if(status) {
				lastAddedItems.push(item);
				lastAddedItems=lastAddedItems.slice(-maxLastItemsCached);

				if(item.changes && item.changes.hasOwnProperty("quantity")) {
					jetloreTracking.shopcart(item, item.quantity-item.oldValues.quantity);
				} else {
					jetloreTracking.shopcart(item, item.quantity);
				}
			} else {
				errorElems.push(item);
			}
			if(!quiet) {
				if(item.changes) {
					$(document).trigger(bershka.events.UpdateCartItem, {
						status: status,
						changes: item.changes,
						oldValues: item.oldValues,
						item: item
					});
				} else {
					$(document).trigger(bershka.events.AddToCart, {
						status: status,
						item: item
					});
				}
			}

			if(item.callback) {
				item.callback(status,item);
			}

			pushItemChange(index+1);
		}
		
		function pushItemChange(index) {
			// si hemos acabado
			if(index >= items.length) {
				updateInProgress = false;
				// todo actualizado, lanzamos el update
				updateLocalShopCart();
				return;
			}
			
			var item=items[index];
			
			// si el elemento depende que uno de los ejecutados anteriormente haya finalizado correctamente
			if(item.dependant && errorElems.indexOf(item.dependant)>-1) {
				if(item.callback) {
					item.callback(0,item);
				}
				errorElems.push(item);
				pushItemChange(index+1);
				return;
			}
			
			if(item.changes) {
				inditex.xUpdateProduct('shopCart', item.changes, function(status) {
					doneAction(status, item, index);
				});			
			} else {
				if(item.reference=="XGIFTCARD") {
					var action;
					switch(item.type) {
						case "virtual":
							action="giftCard:addVirtualGiftCardToShopCart";
							break;
						case "physical":
							action="giftCard:addPhysicalGiftCardToShopCart";
							break;
						default:
							pushItemChange(index+1);
							return;
					}
					item.data.quantity=item.quantity;
					
					inditex.execute({
						"actions": [{
							"action": action,
							"params": {
								"storeId": inditex.iStoreId,
								"languageId": inditex.iLangId
							},
							"data": item.data
						}],
						"onFinish": function(status) {
							doneAction(status, item, index);
						}
					});
				} else {
					inditex.xAddProduct('shopCart', item, !quiet, function(status) {
						doneAction(status, item, index);
					});
				}
			}
		}
		
		pushItemChange(0);
	};
	
	function updateLocalShopCart(silent) {
		doLoadShopCart(function(status,currShopCart) {
			if(!silent) {
				$(document).trigger(bershka.events.UpdateCart,{
					status: status,
					shopCart: currShopCart
				});
			}
		});
	};

	function isItemOutOfStock(item) {
		return item.availability!="in_stock";
	};

	shopCartService.prototype.hasPendingActions = function() {
		return updateInProgress;
	};
	
	shopCartService.prototype.getShopCartId=function() {
		if(shopCart) {
			return shopCart.id;			
		}
		return -1;
	};
	
	shopCartService.prototype.getShopCartItems=function() {
		return filteredItems;
	};
	
	shopCartService.prototype.getLastShopCartItems=function() {
		return lastAddedItems;
	};
	
	shopCartService.prototype.getNumberOfItems=function() {
		if(shopCart) {
			return filteredItems.length;
		}
		return -1;
	};
	
	shopCartService.prototype.getTotalNumberOfItems=function() {
		var total=0;
		for(var i=0, len=filteredItems.length;i<len;i++) {
			total+=filteredItems[i].quantity;
		}
		return total;
	};
	
	shopCartService.prototype.getOutOfStockItems = function() {
		var ret=[];
		for(var i=0,len=filteredItems.length; i<len; i++) {
			var item=filteredItems[i];
			if(isItemOutOfStock(item)) {
				ret.push(item);
			}
		}
		return ret;
	};
	
	shopCartService.prototype.getNumberOutOfStockItems=function() {
		return this.getOutOfStockItems().length;
	};
	
	shopCartService.prototype.hasVirtualAndPhysicalItems=function() {
		var virtualCard = false;
		var physicalProduct = false;
		
		for(var i=0,len=filteredItems.length;i<len;i++) {
			var item=filteredItems[i];
			if(item.quantity==0) {
				continue;
			}
			
			item.productType == 'Virtual Card' ? virtualCard = true : physicalProduct = true;
			
			if (virtualCard && physicalProduct) {
				return true;
			}
		}
		return false;
	};
	
	shopCartService.prototype.hasVirtualItems=function() {
		for(var i=0,len=filteredItems.length;i<len;i++) {
			var item=filteredItems[i];
			if(item.quantity>0 && inditex.xIsVirtualCard(item)) {
				return true;
			}
		}
		return false;
	};
	
	shopCartService.prototype.hasPhysicalGiftCards=function() {
		for (var i = 0, len = filteredItems.length; i < len; i++) {
			var item = filteredItems[i];
			if(item.quantity>0 && inditex.xIsPhysicalCard(item)) {
				return true;
			}
		}
		return false;
	}
	
	shopCartService.prototype.hasIndomError=function(error) {
		var hasError = !!shopCart.indomError; 
		if(!error) {
			return hasError;
		}
		
		return hasError && error == shopCart.indomError;
	};
	
	shopCartService.prototype.getIndomError=function() {
		return shopCart.indomError || undefined;
	}
	
	shopCartService.prototype.canGoToCheckout=function() {
		return shopCart && !this.hasVirtualAndPhysicalItems() && this.getNumberOutOfStockItems()==0 &&
				this.getNumberOfItems()>0 && !this.hasPendingActions() && blockedFromController==0 && !this.hasIndomError(this.unifiedStock.errors.WARN_TOO_MANY_SUBORDERS);
	};
	
	shopCartService.prototype.getAffinityDiscount=function() {
		var semi=0;
		if(shopCart.payment) {
			for (var i = 0, len = shopCart.payment.length; i < len; i++) {
				var pay = shopCart.payment[i];
				if(pay.kind=="affinity" && pay.discountedAmount) {
					semi+=parseInt(pay.discountedAmount,10);
				}
			}
		}
		return semi;
	};
	
	shopCartService.prototype.getTotalPrice=function() {
		if(shopCart) {
			var total=shopCart.totalOrder;
			if (this.hasVirtualItems()) {
				total -= this.getTotalShippingPrice();
			}

			return shopCart.totalOrder;
		}
		return 0;
	};
	
	shopCartService.prototype.getTotalAdjustmentsPrice=function() {
		var adjustments=0;
		if(shopCart) {
			adjustments=shopCart.totalAdjustment;
			if(!bershka.config("AffinityDiscountInTotalAdjustments")) {
				adjustments-=this.getAffinityDiscount();
			}
		}
		return adjustments;
	};

	shopCartService.prototype.getTotalTaxPrice=function() {
		if(shopCart && (shopCart.isNoNexus === '0' || this.bskCountries.isInWW())) {
			return shopCart.tax;
		}
		
		return 0;
	};

	shopCartService.prototype.shallShowShippingTax = function(){ 
		return (shopCart && ( shopCart.shippingTax > 0) && !inditex.iStoreJSON.details.isTaxIncluded);
	}
	shopCartService.prototype.getShippingTax = function() {
		if((shopCart && shopCart.shippingPrice != 0) || (shopCart && shopCart.shippingPrice == 0 && shopCart.isNoNexus === '0') ){
			return shopCart.shippingTax;
		}
		return 0;
	};

	shopCartService.prototype.getTaxes=function() {
		if(shopCart && (this.bskCountries.isInWW() || shopCart.isNoNexus === '0') && shopCart.taxArray.length > 0) {
			return shopCart.taxArray;
		}
		return [];
	};
	
	shopCartService.prototype.getTotalAdjustmentsPriceNoShipping=function() {
		if(shopCart) {
			var price=this.getTotalAdjustmentsPrice();
			var adjustments=shopCart.adjustment;
			for(var i=0, len=adjustments.length; i<len; i++) {
				var adjustment=adjustments[i];
				if(adjustment.isShipping) {
					price-=parseInt(adjustment.amount,10);
				}
			}
			return price;
		}
		return 0;
	};
	
	shopCartService.prototype.getTotalShippingPrice=function() {
		if(shopCart) {
			return shopCart.shippingPrice;
		}
		return 0;
	};
	
	shopCartService.prototype.getTotalProductsPrice=function() {
		if(shopCart) {
			return shopCart.totalProduct;
		}
		return 0;
	};

	shopCartService.prototype.getShopCartAdjustments=function() {
		if(shopCart) {
			return shopCart.adjustment || [];
		}
		return [];
	};
	
	shopCartService.prototype.blockCheckout=function() {
		blockedFromController++;
	};
	
	shopCartService.prototype.unblockCheckout=function() {
		if(blockedFromController>0) {
			blockedFromController--;
		}
	};

	shopCartService.prototype.getStyleFor=function(item,colorId) {
		if(cacheItemsWithStyle[item.id]) {
			return cacheItemsWithStyle[item.id][colorId];
		}
		return null;
	};
	
	/*
	 * TODO: refactor para utilizar los dirty Items si es posible
	 */
	function setGiftTicket(state) {
		updateInProgress=true;
		
		var giftTicket = state ? "1" : "0";
		
		shopCart.giftTicket=giftTicket;
		
		inditex.execute({
			"actions": [{
				"action": "order:getGiftTicket",
				"params": {
					"storeId": inditex.iStoreId,
					"orderId": inditex.iUserJSON.shopCart.id,
					"languageId": inditex.iLangId,
					"gifticket": giftTicket
				}
			}],
			"onFinish": function(status,obj){
				updateInProgress=false;
				if(status!=1) {
					inditex.xOpenErrorPopUp(360,'auto',inditex.text("modal.errorTitle"), bershka.getErrorDescription(obj) || inditex.text("payment.errorGiftTicket"),null);
				}
				updateLocalShopCart();
			}
		});
	}
	
	shopCartService.prototype.addGiftTicket=function() {
		setGiftTicket(true);
	};
	
	shopCartService.prototype.removeGiftTicket=function() {
		setGiftTicket(false);
	};
	
	/*
	 * TODO: refactor para utilizar los dirty Items si es posible
	 */
	function removeGiftPacking(callback) {
		inditex.execute({
			actions: [{
				action: "order:deleteGiftPacking",
				params: {
					storeId: inditex.iStoreId,
					orderId: shopCart.id,
					languageId: inditex.iLangId,
				}
			}],
			onFinish: callback
		});
	};
	
	function addGiftMessage(message,callback) {
		var params = {
			storeId: inditex.iStoreId,
			orderId: shopCart.id,
			languageId: inditex.iLangId
		}
		
		if(message) {
			params.message=message;
			if(shopCart.packing!=1) {
				params.onlyMessage=true;
			}
		}		
		
		inditex.execute({
			actions: [{
				action: "order:addGiftpacking",
				params: params
			}],
			onFinish: callback
		});
	};
	
	function setGiftPacking(packing, message) {
		updateInProgress = true;

		shopCart.message=message;
		shopCart.packing=packing;
		
		var self=this;
		
		function endProcess(status,obj) {
			updateInProgress=false;
			if(status!=1) {
				inditex.xOpenErrorPopUp(360,'auto',inditex.text("modal.errorTitle"),bershka.getErrorDescription(obj) || inditex.text("payment.errorGiftTicket"),null);					
				self.trackingService.trackEvent({
					name:'cesta-error-formulario',
					data:{response:obj}
				});

			}
			updateLocalShopCart();
		}
		
		if(!packing) {
			removeGiftPacking(function(status) {
				if(message && status==1) {
					addGiftMessage(message,endProcess)
				} else {
					endProcess(status);
				}
			});
		} else {
			if(!message) {
				removeGiftPacking(function(status) {
					if(status==1) {
						addGiftMessage(null,endProcess);
					} else {
						endProcess(status);
					}
				});
            } else {
            	addGiftMessage(message,endProcess);
            }
		}
	};
	
	shopCartService.prototype.addGiftPacking=function() {
		if(shopCart) {
			setGiftPacking.call(this,true,shopCart.message);
		}
	};

	shopCartService.prototype.removeGiftPacking=function() {
		if(shopCart) {
			setGiftPacking.call(this,false,shopCart.message);
		}
	};
	
	shopCartService.prototype.addGiftMessage=function(message) {
		if(shopCart) {
			setGiftPacking.call(this,shopCart.giftPacking, message);
		}
	};
	
	shopCartService.prototype.removeGiftMessage=function() {
		if(shopCart) {
			setGiftPacking.call(this,shopCart.giftPacking, null);
		}
	};
	
	shopCartService.prototype.loadShopCart=function(callback) {
		if(updateInProgress) {
			loadShopCartCallbacks.push(callback);
		} else if (!shopCart) {
			loadShopCartCallbacks.push(callback);
			updateLocalShopCart();
		} else {
			callback(1,shopCart);
		}
	};
	
	shopCartService.prototype.promiseLoadShopCart=function() {
		var self=this;
		return this.$q(function(resolve, reject) {
			self.loadShopCart(function(status, cart) {
				if(status==1) {
					resolve(cart);
				} else {
					reject(cart);
				}
			}, true);
		});
	};

	shopCartService.prototype.forceLoadShopCart=function(callback, silent) {
		inditex.removeLocalStorage("cache-shop-cart");
		doLoadShopCart(function(status,currShopCart) {
			if(!silent) {
				$(document).trigger(bershka.events.UpdateCart,{
					status: status,
					shopCart: currShopCart
				});
			}
			callback && callback(status,currShopCart);
		}, true);
	};
	
	shopCartService.prototype.promiseForceLoadShopCart=function() {
		var self=this;
		return this.$q(function(resolve, reject) {
			self.forceLoadShopCart(function(status, cart) {
				if(status==1) {
					resolve(cart);
				} else {
					reject(cart);
				}
			}, true);
		});
	};
	
	// TODO: esto no tendría que poderse hacer, tenemos que crear los métodos
	// que se necesiten para no tener que acceder directamente a la cesta
	// o bien devolver una copia del shopCart
	shopCartService.prototype.getShopCart=function() {
		return shopCart;
	};
	
	shopCartService.prototype.addPromoCode=function(promoCode) {
		if(!promoCode) {
			return;
		}
		updateInProgress = true;
		
		var self=this;
		
		function applyPromoCode() {
			inditex.execute({
				"actions": [{
					"action": "order:addPromoCode",
					"params": {
						"storeId": inditex.iStoreId,
						"orderId": shopCart.id,
						"languageId": inditex.iLangId
					},
					"data": {
						"promoCode" : promoCode
					}
				}],
				"onFinish": function (status, obj) {
					updateInProgress=false;
					if(status!=1) {
						inditex.xOpenErrorPopUp(360,'auto',inditex.text("modal.errorTitle"), bershka.getErrorDescription(obj) || inditex.text("payment.errorPromoCode"),null);

						self.trackingService.trackEvent({
							name:'cesta-error-formulario',
							data:{response:obj}
						});
					}
					updateLocalShopCart();
				}
			});
		}

		if(inditex.iUserJSON.identity.userId==-1002) {
			inditex.execute({
		        "actions": [{
			        "action": "user:loginGuest",
			        "params": {
			          "storeId": inditex.iStoreId
			        },
			        "data": {
			          "id": inditex.iStoreId
			        }
				}], onFinish: function(status) {
					if(status==1) {
						applyPromoCode();
					}
				}
			})
		} else {
			applyPromoCode();
		}
	};
	
	shopCartService.prototype.removePromoCode=function(promoCode) {
		if(!promoCode) {
			return;
		}

		updateInProgress=true;
		
		inditex.execute({
			"actions": [{
				"action": "order:deletePromoCode",
				"params": {
					"storeId": inditex.iStoreId,
					"orderId": shopCart.id,
					"promoCode": promoCode,
					"languageId": inditex.iLangId
				}
			}],
			"onFinish": function (status, result) {
				updateInProgress=false;
				if(status!=1) {
					inditex.xOpenErrorPopUp(360,'auto',inditex.text("modal.errorTitle"),inditex.text("payment.errorPromoCode"),null);
				}
				updateLocalShopCart();
			}
		});
	};
	
	shopCartService.prototype.getCurrentPromo=function() {
		if(!shopCart || !shopCart.promotion || !shopCart.promotion.length) {
			return null;
		}
		return shopCart.promotion;
	};
	
	shopCartService.prototype.hasDirtyItems=function() {
		return dirtyItems.length > 0;
	};
	
	shopCartService.prototype.isLowInStock=function(item) {
		return false;
	};
	shopCartService.prototype.isOutOfStock=function(item) {
		return isItemOutOfStock(item);
	};
	
	function isInShopCart(newItem) {
		for(var i=0,len=shopCart.items.length;i<len;i++) {
			var item=shopCart.items[i];
			if(item.sku==newItem.sku) {
				return item;
			}
		}
		return null;
	}
		
	function updateDirtyItem(dirtyItem,changes,callback) {
		if(callback && $.isFunction(callback)) {
			dirtyItem.callback=callback;
		}
		for(var key in changes) {
			if(!dirtyItem.oldValues.hasOwnProperty(key)) {
				dirtyItem.oldValues[key]=dirtyItem[key];
			}
			dirtyItem[key]=changes[key];
		}
	}
	
	function createItemFromChanges(item, changes, callback) {
		var dirty=$.extend({},item);
		
		dirty.oldValues={}
		var existing=isInShopCart(item);
		if(existing) {
			dirty.originalPosition=shopCart.items.indexOf(existing);
		}

		if(callback && $.isFunction(callback)) {
			dirty.callback = callback;
		}
		
		for(var key in changes) {
			if(!dirty.oldValues.hasOwnProperty(key)) {
				dirty.oldValues[key]=dirty[key];
			}
			dirty[key]=changes[key];
		}

		dirty.changes=changes;
		dirty.changes.sku=item.sku;
		dirty.changes.id=item.id;

		dirty.dependant=null;

		return dirty;
	}
	
	function itemDependsOn(dirty, dependency) {
		if(dirty) {
			dirty.dependency=dependency;
		}
	}
	
	function preserveOrder() {
		filteredItemsOrder=[];
		for (var i = 0, len = shopCart.items.length; i < len; i++) {
			var item = shopCart.items[i];
			filteredItemsOrder.push(item.sku);
		}
	}
	
	shopCartService.prototype.updateItem=function(item, changes, callback, silent) {
		var quiet=false;
		var items=[];
		var changedItem=null;
		
		preserveOrder();
		
		if(changes.sku) {
			items.push(createItemFromChanges(item, {
				quantity: 0
			}));

			changedItem={
	     		parentId : item.origin && item.origin.length ? item.origin[0].parentId : undefined,
	     		productId : item.origin && item.origin.length ? item.origin[0].productId : undefined,
	     		name : item.name,
	     		quantity : item.quantity,
	     		reference : item.reference,
	     		productType : item.productType,
	     		categoryId: item.categoryId,
	     		callback: callback
			};

			$.extend(changedItem,changes);
			items.push(changedItem);
			
			var pos=filteredItemsOrder.indexOf(item.sku);
			if(pos>-1) {
				filteredItemsOrder[pos]=changes.sku;
			}

			quiet=true;			

			itemDependsOn(items[1], items[0]);
		} else {
			changedItem=createItemFromChanges(item, changes, callback);
			items.push(changedItem);
		}
		
		if(!silent) {
			this.trackEditeditem(item,changes);
		}
		// queremos que los cambios se apliquen ya desde el ciclo actual
		// suponemos que van a ir bien y modificamos el item actual con 
		// los nuevos datos
		execUpdateItems(items, quiet);
		return changedItem
	};
	
	shopCartService.prototype.trackEditeditem = function(item,changes){
		if(changes && changes.size && item.size !== changes.size){
			this.trackingService.trackEvent({
				name:'shopcart-edit-size',
				data:{
					item: item,
					changes: changes
				}
			});			
		}

		if(changes && changes.color && item.color !== changes.color){
			this.trackingService.trackEvent({
				name:'shopcart-edit-color',
				data:{
					item: item,
					changes: changes
				}
			});			
		}

		if(changes && (changes.size || changes.color)){
			this.trackingService.trackEvent({
				name:'shopcart-edit-item-ok',
				data:{
					item: item,
					changes: changes
				}
			});			
		}
	};

	shopCartService.prototype.deleteItem=function(item,callback, silent) {
		this.updateItem(item,{
			quantity: 0
		}, callback, silent);
	};
	
	shopCartService.prototype.addVirtualGiftCard=function(data, callback) {
		var self=this;
		this.forceLoadShopCart(function() {
			self.addGiftCart(data, "virtual", callback);
		});
	};
	
	shopCartService.prototype.addPhysicalGiftCard=function(data, callback) {
		var self=this;
		this.forceLoadShopCart(function() {
			self.addGiftCart(data, "physical", callback);
		});
	};
	
	shopCartService.prototype.addGiftCart=function(data, type, callback) {
		var item={
			reference: "XGIFTCARD",
			type: type,
			sku: data.sku,
			data: data,
			quantity: data.quantity
		};
		
		this.addItem(item, callback);
	};
	
	shopCartService.prototype.addItem=function(item,callback) {
		preserveOrder();
		item.searchConversion = item.jetLoreId;
		filteredItemsOrder.push(item.sku);
		
		item.callback=callback;
		execUpdateItems([item], false);
	};
	
	shopCartService.prototype.clearItems = function(callback) {
		if(shopCart) {
			var numItems = shopCart.items.length;
			var self = this;
			var items = [];
			
			for(var i=0; i<numItems; i++) {
				items.push({
					id: shopCart.items[i].id,
					quantity: 0
				});
			}
			
			inditex.xUpdateProduct('shopCart', items, function(status) {
				self.forceLoadShopCart(callback);
			});			
		} else {
			callback(shopCart);
		}
	};
	
	shopCartService.prototype.isDeferred=function() {
		return isDeferredPersistence;
	};

	shopCartService.prototype.hasGift=function() {
		if (shopCart) {
			for (var i = 0; i < shopCart.items.length; i++) {
				var el = shopCart.items[i];
				if (el.isAutoAdd == true) {
					return true;
				};	
			};	
		}
		
		return false;
	};
		
	shopCartService.$parsers=new bskCallbackArray(true);
})(angular,inditex,jQuery);

angular.module("itxApp").component("stockBanner", {
	transclude: {
		"store": "?stockBannerStore",
		"warehouse": "?stockBannerWarehouse",
		"both": "?stockBannerBoth",
		"none": "?stockBannerNone"
	},
	template: "\
		<div class='store-stock-banner' ng-if='$ctrl.hasItems'>\
			<div ng-if='$ctrl.hasStoreStock && !$ctrl.hasWarehouseStock' ng-transclude='store'></div>\
			<div ng-if='!$ctrl.hasStoreStock && $ctrl.hasWarehouseStock' ng-transclude='warehouse'></div>\
			<div ng-if='$ctrl.hasStoreStock && $ctrl.hasWarehouseStock' ng-transclude='both'></div>\
			<div ng-if='!$ctrl.hasStoreStock && !$ctrl.hasWarehouseStock' ng-transclude='none'></div>\
		</div>",
	controller: ["shopCartService", function(shopCartService) {
		var self = this;
		this.hasStoreStock = false;
		this.hasWarehouseStock = false;
		this.hasItems = false;

		function setStocksOrigin(shopCart) {
			self.hasItems = shopCart.items.length;

			for(var i=0, len=shopCart.items.length; i<len; i++) {
				var item = shopCart.items[i];
				if(item.stockLocations) {
					for(var j=0, len2=item.stockLocations.length; j<len2; j++) {
						var stockLocation = item.stockLocations[j];
						if(stockLocation.stockSourceCode) {
							if(stockLocation.stockSourceCode.indexOf('BK-PST')===0) {
								self.hasStoreStock = true;
							} else {
								self.hasWarehouseStock = true;
							}
						}
					}
				}

				if(self.hasStoreStock && self.hasWarehouseStock) {
					break;
				}
			}
		}

		$(document).on(bershka.events.UpdateCart ,function(event, data) {
			if(data.status === 1) {
				$timeout(function() {
					setStocksOrigin(data.shopCart);
				}, 0);
			}
		});
		shopCartService.promiseLoadShopCart().then(function(shopCart) {
            setStocksOrigin(shopCart);
		});
	}]
});
/* END FIX ECOMBSKA-9514 */

/* FIX ECOMBSKA-9511 */
ItxTrackingService.prototype.setCheckoutPagoConfirmacionPageviewData = function() {
	var retVal;
	//var shopCartService = this.getService("shopCartService");
	var iUser = inditex.iUserJSON;
	var currentOrderId = inditex._getURLParameter("orderId");
	var checkoutOrderId = inditex.getSessionStorage("checkoutOrderId");
	var validPurchase = false;
	var giftCardAmount = undefined;

	if (this.order && this.order.payment && this.order.payment.length > 1) {
		this.order.payment[0].type == "Affinity" ? this.order.payment.affinity = 'si' : this.order.payment.affinity = 'no';
		giftCardAmount = this.order.payment[0].type == "GiftCard" ? this.order.payment[0].amount : undefined;
	}
	
	if(checkoutOrderId && currentOrderId == checkoutOrderId){
		validPurchase = true;
		inditex.removeSessionStorage("checkoutOrderId");
	}

	this.dataLayer.user = {
			'clientType': iUser.isCompany ? 'empresa' : 'particular',
			'isBuyer': iUser.isBuyer ? 'si' : 'no',
			'userId': this._getUserId(),
			'userType': iUser.userType == 'R' ? 'registrado' : 'anonimo',
			'isLogged': iUser.userType == 'G' ? 'no_logueado' : 'logueado',
			'quickBuy': iUser.isWalletUser ? 'si' : 'no',
			'hashEmail': this._getHashEmail()
		};

	if (inditex._getURLParameter("guestToken")) {
		
		this.dataLayer.order = {
			'orderId': currentOrderId,
			'delivery': undefined,
			'payment': undefined,
			'discount': undefined
		};

	} else if (validPurchase) {
					
		this.dataLayer.order = {
			'orderId': this.order.id,
			'payment': {
				'type': this.order.payment.length > 1 ? this.order.payment[0].type : 'none',
				'giftcardAmount': giftCardAmount,
				'netAmount': bershka.analyticsPriceToUnits(this.order.totalProduct).toString(),
				'savedData' : inditex.iUserJSON.isWalletUser ? 'si':'no',
				'savedDataCheck': undefined,
				'giftTicket' : undefined
			},
			'delivery': {
				'shippingType' : this.order.shipping.kind					
			},
			'discount': {
				'discountType' : this.order.adjustment.length > 0 ? this.order.adjustment[0].type : undefined,
				'fullAmount' : bershka.analyticsPriceToUnits(this.order.totalAdjustment).toString()
			}
		};
		var coupons = [];
		if(this.order.promotion) {
			for (var i = 0, len = this.order.promotion.length; i < len; i++) {
				var promotion = this.order.promotion[i];
				if(promotion.code) {
					coupons.push(promotion.code);
				}
			}
		}
		
		this.dataLayer.ecommerce = {
			'currencyCode': this.currencyCode,
			'purchase': {
				'actionField': {
					'id': currentOrderId,
					'revenue': bershka.analyticsPriceToUnits(this.order.totalOrder).toString(),
					'shipping': bershka.analyticsPriceToUnits(this.order.shippingPrice).toString(),
					'tax': bershka.analyticsPriceToUnits(this.order.tax).toString(),
					'coupon': coupons.join(",")
				},
				'products': this.getCartProducts(this.order.items)
			}
		};

	} else {
		this.dataLayer.order = {
			'orderId': currentOrderId,
			'delivery': undefined,
			'payment': undefined,
			'discount': undefined
		}

	}

};
/* END FIX ECOMBSKA-9511 */

/* FIX ECOMBSKA-9506 */
(function() {
	ItxOrderConfirmationPageClass.prototype.getEstimatedMessage = function() {
		var sintEnabled = this.config.inmediate('enable_messageSINT_cart') == "1";
        if (sintEnabled && order.stockOrigin == "STORE") {
        	var message = inditex.text("confirmation.sint");
        	if(message.indexOf("???") != 0) {
        		return message;
        	}
        }
        return "";
	};
	ItxOrderConfirmationPageClass.prototype._bindings.getEstimatedDeliveryDate = function(order) {
		var isDeferred = order.shipping && order.shipping.dbcode == "DeferredStandard";
		if(!isDeferred) {
			var estimated = order.getEstimatedDeliveryDate();
			if(estimated && estimated.getDate && !isNaN(estimated.getDate())) {
				return moment(estimated).format("dddd D");
			}
		} else {
			return this.getEstimatedMessage();
		}
		
		return "";
	}
	
	$(function() {
		var $elem = $(".confirmation .confirmation-data-value-date");
		var $currentOrder = $elem.eq(0);
		var $currentSubOrder = $elem.eq(1);
		var attrNgIf;
		
		if($currentOrder) {
			attrNgIf = $currentOrder.parent().attr("ng-if");
			if(attrNgIf) {
				$currentOrder.parent().attr("ng-if",attrNgIf+" && getEstimatedDeliveryDate(order)");
			}
		}
		
		if($currentSubOrder) {
			attrNgIf = "getEstimatedDeliveryDate(subOrder)";
			$currentSubOrder.attr("ng-if", attrNgIf);
			$currentSubOrder.prev().attr("ng-if", attrNgIf);
		}
	});
})();
/* END FIX ECOMBSKA-9506 */

/* FIX ECOMBSKA-9501 */
angular.module("itxApp").factory("bskGridImages", ["$log", "bskGridState", "bskImageConstants", "gridFormatManager", "formatManagerConstants", "bskVideoHelperFactory", "bskDeviceService", function($log, state, imageConstants, formatManager, formatConstants, videoHelper, deviceService) {
	function shouldSelectDouble(product) {
		if(!product.draw.double) {
			return false;
		}

		var currentFormat = formatManager.getActiveFormat();
		if(state.imageType == "MOBILE_CATEGORY_PAGE" && currentFormat == formatConstants.formats.TEMPLATE) { // CHANGES
			return false;
		}
		return true;
	}

	function shouldViewVideo() {
		return state.imageType != "FILTER_CATEGORY_PAGE";
	}

	/* CHANGES */
	function drawLarge(product) {
		if(deviceService.isOnlyMobileScreen() && product.draw) {
			var currentFormat = formatManager.getActiveFormat();
			if(currentFormat == formatConstants.formats.NEW_IN) {
				return product.draw.double;
			}
			if(currentFormat == formatConstants.formats.TEMPLATE) {
				return product.draw.double && product.draw.expand;
			}
		}		
		return false;
	}
	/* END CHANGES */
	
	var factory = {
		imageIsDouble: function(image) {
			return image.clazz == imageConstants.doubleClazz || image.clazz == imageConstants.doubleDoubleClazz;
		},
		imageIsVideo: function(image) {
			return videoHelper.isVideo(image);
		},
		getTypeGroup: function(product, color) {
			var base;
			if (inditex.xIsGiftCard(product) || product.type=="BundleBean" || product.isBanner) {
				base = product;
			} else {
				base = color;
			}

			if(base && base.image && base.image[state.imageType]) {
				return base.image[state.imageType];
			}
			return {};
		},
		getImages: function(product, color) {
			var showVideo = shouldViewVideo(product);
			var showDouble = shouldSelectDouble(product);
            var size = state.imageSize;

			/* CHANGES */
            if(drawLarge(product)) {
                size = "LARGE";
            }
			/* END CHANGES */
			var images = this.getTypeGroup(product, color)[size] || [];
			var cleaned = images.slice(0);

			for (var i = cleaned.length; i--;) {
				var image = cleaned[i];
				if((this.imageIsDouble(image) && !showDouble) || (this.imageIsVideo(image) && !showVideo)) {
					cleaned.splice(i, 1);
				}
			}
			return cleaned;
		},
		getImage: function(product, color, index) {
			return this.getImages(product, color)[index] || {};
		}
	};

	$log.publish("gridImages", factory);
	return factory;
}]);
/* END FIX ECOMBSKA-9501 */

/* FIX ECOMBSKA-9469 */
(function() {
	var old = ItxUserPasswordForgetPageClass.prototype._loadBindings;
	ItxUserPasswordForgetPageClass.prototype._loadBindings = function() {
		old.apply(this, arguments);
		
		var self = this;
		self.iScope.submitForm = function(event){
			var hash = inditex.iParams && inditex.iParams.hash && inditex.iParams.hash[0] && inditex.iParams.hash[0].split('?')[0];
			
			var action = {
				"action": "user:updateResetUserPassword",
				"params": {
					"storeId": inditex.iStoreId,
					"languageId": inditex.iLangId
				},
				"data":{
					"email" : inditex._getURLParameter('logonId'),
					"code" : hash,
					"newPassword": self.iScope.form.iPwd,				
					"newPasswordConfirm": self.iScope.form.iConfirmPassword,
					captchaResponse: self.iScope.form.captchaResponse,
					"captchaValue": self.iScope.form.captchaValue,
					"captchaId": self.iScope.form.captchaId				
				}
			};
			
			var actions = [action];

			// TODO: Ver de donde obtener el id de usuario y los tokens para la peticion
			inditex.execute({
				"actions": actions,
				"onFinish": function (status, response) {
					if (status == 1) {
						// Si la llamada finaliza correctamente, se oculta la capa principal se muestra la de confirmacion
						self.iScope.showPrincipal = false;
						self.iScope.$apply();
						setTimeout(function() {
							self.iScope.goHome();
						}, inditex.closeTimeout);
					} else {							
						self.iScope.$broadcast(bershka.events.ReloadCaptcha);
						inditex.xOpenErrorPopUp(278, 'auto', null, bershka.getErrorDescription(response));
					}
				}
			});
		};
	};
})();
/* END FIX ECOMBSKA-9469 */

/* Ocultar PdP en paises No Venta hasta que tengamos PDF */
inditex.onReady(function() {
	if(!inditex.iStoreJSON.isOpenForSale) {
		$("html").addClass("is-not-open-for-sale");
	} else {
		$("html").removeClass("is-not-open-for-sale");
	}
}); 
/* Ocultar PdP en paises No Venta hasta que tengamos PDF */ 

/* FIX NEW URL */
/*
(function() {
	inditex.onReady(function() {
		// var olapicCountries = ["FR", "DE", "GR", "IE", "IT", "JP", "KR", "MX", "NL", "PL", "PT", "RU", "ES", "IC", "TR", "GB", "US"];
		var olapicCountries = {
			"GB": {
				"token": "928181be7c2243eb2e037cdf9cdfb4fb00afa130e294634cad867ec295ff7d16",
				"homeStreamId": "2167287797",
				"galleyStreamId": "2167287798"
			},
			"ES": {
				"token": "71f25b1cb06c8b421b12510727dde3ebb9880cfce88459c8f6fb05a64905c3df",
				"homeStreamId": "2167287803",
				"galleyStreamId": "2167287804"
			}
		};
		if (olapicCountries[inditex.iStoreJSON.countryCode]) {
			angular.module("itxApp").config(["bskConfigurationFactoryProvider", function(config) {
				config.set("OlapicRestSrc", "https://api.olapic-cdn.com");
				config.set("OLAPIC_TRACKING_ACCESS_TOKEN", olapicCountries[inditex.iStoreJSON.countryCode].token);
				config.set("OLAPIC_HOME_STREAM_ID", olapicCountries[inditex.iStoreJSON.countryCode].homeStreamId);
				config.set("OLAPIC_GALLERY_STREAM_ID", olapicCountries[inditex.iStoreJSON.countryCode].galleyStreamId);
			}]);
		};
	}, true);
})();
*/
/* END NEW URL OLAPIC */

/* FIX FAKE DOUBLE SIZE IMAGE QUALITY */
angular.module("itxApp").config(["$provide", function($provide) {
	$provide.decorator("bskGridImages", ["$delegate", function($delegate) {
		$delegate.getImage = function(product, color, index) {
			var oldImageSize = this.imageSize;
			if(product.isDoubleSize) {
				this.imageSize = "LARGE";
			}
			var ret = this.getImages(product, color)[index] || {};
			this.imageSize = oldImageSize;
			
			return ret;
		};

		return $delegate;
	}]);
}]);
bskImageService.prototype.specs[0].desktop = {
	0: { width: 124, height: 159, classic: 5 }, // SMALL
	1: { width: 1300, height: 1667, classic: 1 }, // MEDIUM
	2: { width: 1300, height: 1667, classic: 1 }, // LARGE
	3: { width: 640, height: 821, classic: 4 } // MODAL
};
bskImageService.prototype.specs[0].mobile = {
	0: { width: 124, height: 159, classic: 5 },
	1: { width: 320, height: 410, classic: 6 },
	2: { width: 1024, height: 1313, classic: 3 }
};

/* END FIX FAKE DOUBLE SIZE IMAGE QUALITY */

/* ADD PLAY PAUSE ON BSK-VIDEO */
bskVideoCtrl.prototype.init=function() {
	var $el = this.$element.get(0);
	$el.play=this.play.bind(this);
	$el.pause=this.pause.bind(this);

	var self = this;
	$el.toggle=function() {
		if (self.state==self.videoEnumerator.STATE_PAUSED
			|| self.state==self.videoEnumerator.STATE_STOPPED
			|| self.state==self.videoEnumerator.STATE_SCROLL_PAUSED) {
			self.play();
		} else {
			self.pause();
		}
	}
};
/* END ADD PLAY PAUSE ON BSK-VIDEO */

/* REDIRECCIÓN WW */
(function() {
       var splitted = location.href.split("/");
       
       if (splitted[3] && splitted[3].toLowerCase() == 'ww' && !inditex.getLocalStorage("COUNTRY_ISO")) {
              window.location.href = inditex.getWorldWideUrl();
       }      
})();  
/* END REDIRECCIÓN WW */

/* Cambios newsletter creators */

ItxNewsletterPageClass.prototype._init = function(){
	var self = this;

	this.iScope.iGender='F';
	this.iScope.iChecked=false;
	this.iScope.showUnsubscribe = true;
	this.iScope.showSubscribe = true;

	if(this.iScope.params) {
		if (this.iScope.params.showUnsubscribe !== undefined) {
			this.iScope.showUnsubscribe = this.iScope.params.showUnsubscribe;
		}

		if (this.iScope.params.showSubscribe !== undefined) {
			this.iScope.showSubscribe = this.iScope.params.showSubscribe;
		}

		if (this.iScope.params.email !== undefined) {
			this.iScope.iSubsEmail = this.iScope.params.email;
			this.iScope.iUnsEmail = this.iScope.params.email;
		}

		this.iScope.iBirthDate = this.iScope.params.birthdate;

		if(this.iScope.params.showBirthdate !== undefined && this.iScope.showBirthday) {
			this.iScope.showBirthday=this.iScope.params.showBirthdate;
		}
	}

	this._loadBindings();

	this.iScope.hasGDPRnewsletter=this.iScope.GDPRHelper.hasDocuments("newsletter");

	this.trackingService.trackPageview({name:'page-newsletter'});

	if (window.location.search.match("isLGNorigin") != null) {
		this.trackingService.trackEvent({
			name:'newsletter-form-try',
			data: {
				label: 'bershka_creators'
			}
		});
	}
}

ItxNewsletterPageClass.prototype._bindings.subscribe =  function() {

// CHANGE
var translations = {
	'es': {
		'title': 'GRACIAS POR SUSCRIBIRTE A LA NEWSLETTER',
		'msg': 'Ma\u00F1ana recibir\u00E1s un email donde te explicamos c\u00F3mo disfrutar de tu 10% de descuento'
	},
	'en': {
		'title': 'THANKS FOR SUBSCRIBING TO THE NEWSLETTER',
		'msg': "Tomorrow, you'll receive an email explaining how to get your 10% discount"
	},
	'ca': {
		'title': "GR\u00C0CIES PER SUBSCRIURE'T A LA NEWSLETTER",
		'msg': "Dem\u00E0 rebr\u00E0s un correu electr\u00F2nic en el qual t'expliquem com pots gaudir del teu 10\u00A0% de descompte"
	},
	'gl': {
		'title': 'GRAZAS POLA T\u00DAA SUBSCRICI\u00D3N \u00C1 NOSA NEWSLETTER',
		'msg': "Ma\u00F1\u00E1 recibir\u00E1s un correo electr\u00F3nico coa informaci\u00F3n para gozares do teu 10\u00A0% de desconto"
	},
	'eu': {
		'title': 'ESKERRIK ASKO NEWSLETTERRERA HARPIDETZEAGATIK',
		'msg': 'Bihar mezu elektroniko bat bidaliko dizugu, %10eko deskontua nola erabili azaltzeko'
	},
	'fr': {
		'title': 'BIENVENUE DANS LA FAMILY!',
		'msg': "Demain, tu recevras un email dans lequel on t'explique comment profiter de tes 10 % de réduc"
	},
	'de': {
		'title': 'VIELEN DANK, DASS DU UNSEREN NEWSLETTER ABONNIERT HAST',
		'msg': "Morgen erhältst du eine E-Mail, in der wir dir erklären, wie du dir 10 % Rabatt sicherst."
	},
	'nl': {
		'title': 'BEDANKT VOOR JE INSCHRIJVING VOOR DE NEWSLETTER',
		'msg': "Morgen ontvang je een e-mail waarin we je uitleggen hoe je kunt profiteren van jouw 10% korting"
	}
}
	var self = this;
	
	var isCreator = window.location.search.match("isLGNorigin") != null;

	var newLabel = isCreator ? "bershka_creators" : "footer"; // CHANGE
    var newnewsletterLabel = isCreator ? "bershka_creators" : "HomeFooter"; // CHANGE

	var birthdate = this.iScope.iBirthDate;

	if (birthdate && birthdate.length == 5) {
		birthdate = '1904-' + birthdate;
	}

	var address={
		email: this.iScope.iSubsEmail,
		gender: this.iScope.iGender,
		birthdate: birthdate
	};

	inditex.execute({
		"actions": [{
			"action": "user:subscribeNewsletterRequest",
			"params": {
				"storeId" : inditex.iStoreId,
				"languageId" : inditex.iLangId,
			},
			"data": {
				"address" : address,
				"newsletter" :  newnewsletterLabel, // CHANGE
				"privacyPolicyAccepted" :  true
			}
		}],
		"onFinish": function (status, result) {
			if (status == 1){
				var subscribeTextTitle, subscribeTextMsg;
				
				/*if (inditex.iCountryCode == 'ES' || inditex.iCountryCode == 'IC' || inditex.iCountryCode == 'FR' || inditex.iCountryCode == 'DE' || inditex.iCountryCode == 'NL') {  // CHANGE
						subscribeTextTitle = translations[inditex.xGetLanguageCode()].title;
						subscribeTextMsg = translations[inditex.xGetLanguageCode()].msg;
				} else */
				if (self.iScope.automaticSubscription){
					subscribeTextTitle = inditex.text('newsletter.autoSubscribeTitle');
					subscribeTextMsg = inditex.text('newsletter.autoSubscribeMsg');
				} else {
					subscribeTextTitle = inditex.text('newsletter.subscribeTitle');
					subscribeTextMsg = inditex.text('newsletter.subscribeMsg');
				}
				if (inditex.iCountryCode == "RU") { // CHANGE
					inditex.closeTimeout = 7000;
				}
				inditex.xOpenSuccessPopUp(278, 'auto', subscribeTextTitle , subscribeTextMsg);
				setTimeout(function(){
					$('#modal').dialog('close');
				},1000);
				if (inditex.iCountryCode == "RU") { // CHANGE
					inditex.closeTimeout = 4000;
				}

				$(document).triggerHandler(bershka.events.CompleteNewsletterRegistration,{
					status: status,
					newsletter: "HomeFooter",
					gender: self.iScope.iGender
				});

				if (!isCreator) {
					self.trackingService.trackEvent({
						name:'footer-newsletter-ok',
						data:{
							gender:self.iScope.iGender
						}
					});
				}
				
				self.trackingService.trackEvent({
					name:'newsletter-form-succeed',
					data: {
						label: newLabel // CHANGE
					}
				});
			}else {
				if(result){
					inditex.xOpenErrorPopUp(278, 'auto', " ", bershka.getErrorDescription(result));
				}else{
					inditex.xOpenErrorPopUp(278, 'auto');
				}
				self.trackingService.trackEvent({
					name:'newsletter-form-fail',
					data: {
						label: newLabel + ':'	+ result.code  // CHANGE
					}
				});
			}
		}
	});
}
/* Fin Cambios newsletter creators */


/* FIX TRACKING SERVICE */
ItxTrackingService.prototype.setAddToCartEventData = function() {
    this.product.detail = this.product.detail || this.product;
    var _list = this.getListStorage(this._getProductReference(this.product.detail.reference))
      , _category = "S_" + this.product.section + "/F_" + this.product.family + "/SF_" + this.product.subFamily
      , _modelName = this.product.detail && this.product.detail.colors && this.product.detail.colors.length ? this.product.detail.colors[0].modelName : void 0
      , _modelName = this.getModelName(_modelName);
    this.updateListStorage(this.product.detail.reference);
    var extendedData = this._addAddedToCart()
      , _position = this._getPosition()
      , shopCartService = this.getService("shopCartService")
      , metric4 = 0 == shopCartService.getNumberOfItems() ? 1 : 0;
    this.dataLayer.ecommerce = {
        currencyCode: this.currencyCode,
        add: {
            actionField: {
                list: extendedData.lista
            },
            products: [{
                name: this.product.name,
                id: this._getProductReference(this.product.detail.reference),
                price: bershka.analyticsPriceToUnits(this.productSize.price).toString(),
                category: _category,
                position: _position,
                key: this.product.id,
                quantity: this.quantity ? this.quantity : 1,
                dimension96: this.selectedColor ? this.selectedColor.id : this.doc.colorId,
                dimension97: this.productSize.mastersSizeId,
                dimension107: _modelName,
                dimension109: this.product.section,
                dimension111: this.product.family,
                dimension113: this.product.subFamily,
                dimension131: bershka.analyticsPriceToUnits(this.productSize.price).toString(),
				/*CHANGES*/
                dimension132: extendedData.price && extendedData.price.maxOldPrice ? bershka.analyticsPriceToUnits(extendedData.price.maxOldPrice - extendedData.price.maxPrice) : void 0,
				/*END CHANGES*/
                dimension134: extendedData.tipoProducto,
                dimension54: this._getIdProduct(extendedData.productId, extendedData.productId_Padre, extendedData.tipoProducto),
                dimension62: this._getParentIdProduct(extendedData.productId, extendedData.productId_Padre, extendedData.tipoProducto),
                dimension87: extendedData.control,
				/*CHANGES*/
                dimension142: extendedData.price && (extendedData.price.maxPrice != extendedData.price.minPrice) ? bershka.analyticsPriceToUnits(extendedData.price.minPrice) + "-" + bershka.analyticsPriceToUnits(extendedData.price.maxPrice) : void 0,
				/*END CHANGES*/
                dimension144: extendedData.composicionXmedia ? "foto_doble" : "foto",
                dimension145: extendedData.idCategoria,
                dimension146: extendedData.keyword,
                dimension147: extendedData.pageTypeAdded,
                dimension91: extendedData.recomendador,
                metric5: _position,
                metric4: metric4,
                dimension172: extendedData.imagen
            }]
        }
    };
    this.dataLayer.customData = {
        product: {
            reference: this._getProductReference(this.product.detail.reference),
            productState: this.product.detail.productState,
            color: this.selectedColor ? this.selectedColor.id : this.doc.colorId,
            talla: this.productSize ? this.productSize.mastersSizeId : void 0,
            claseProducto: this.product.section,
            section: void 0,
            family: void 0,
            subfamily: void 0,
            subsubfamily: void 0
        }
    }
}
/* END FIX TRACKING SERVICE */

/* FIX ECOMBSKA-8545 */
angular.module("itxApp").config(["$provide", function($provide) {
	$provide.decorator("bskStateFactory", ["$delegate", function($delegate) {
        if (inditex.iParams && inditex.iParams.showReactivationPromo=='true') {
            inditex.setSessionStorage("reactivationPromo", 1)
        }
		return $delegate;
	}]);
}]);

ItxLogonPageClass.prototype._bindings.showReactivationPromo = function() {
    return inditex.iUserJSON.userType != "R" && inditex.getSessionStorage('reactivationPromo') == 1;
}

ItxShopCartPageClass.prototype._bindings.showReactivationPromo = function() {
    return inditex.iUserJSON.userType != "R" && inditex.getSessionStorage('reactivationPromo') == 1;
}
/* END FIX ECOMBSKA-8545 */

/* FIX Redirección GeoBlocking en WordlWidePage */
/*if (inditex.iPage == "ItxWorldWidePage") {
	var geoStore = inditex.readCookie("BSKGeoStore");
	if (geoStore) {
		var url = window.location.origin + geoStore;
		
		window.location.ref = url.replace(/\/\//g,"/") + window.location.search;
	}
}*/
/* END FIX Redirección GeoBlocking en WordlWidePage */


/* FIX ECOMBSKA- */
ItxGiftCardVirtualClass.prototype._bindings.openTermsConditions = function($event) {
	this.iScope.openTermsAndConditions($event);
};
ItxGiftCardVirtualClass.prototype._bindings.openPrivacyPolicyGift = function($event) {
	this.iScope.openPrivacyPolicy($event);
};
ItxPhysicalCardClass.prototype._bindings.openPrivacyPolicyGift = function($event) {
	this.iScope.openPrivacyPolicy($event);
};
/* END FIX ECOMBSKA- */

/* FIX COLOR FOR 9414/984 */
(function() {
	function changeProductColor(product, isShopCart) {
		if(product.displayReference == "9414/984") {
			if(!isShopCart) {
				for(var j=0, len2=product.colors.length; j<len2; j++) {
					var color=product.colors[j];
					if(color.id=="615") {
						color.name="Camel";
					}
				}
			} else if(product.colorId=="615") {
				product.color="Camel";
			}
		}
	}
	
	productNormalizerService.$parsers.push(function changeColor(products) {
		for(var i=0, len=products.length; i<len; i++) {
			changeProductColor(products[i]);
		}
	});
	
	shopCartService.$parsers.push(function changeColor(items) {
		for(var i=0, len=items.length; i<len; i++) {
			changeProductColor(items[i], true);
		}
	});
})();
/* END FIX COLOR FOR 9414/984 */

inditex.onReady(function () {
  if (inditex.iPage == 'ItxOrderConfirmationPage') {
    var URL_JSON = '/config/cambio_moneda.json';

    // RATES at date 2019-07-16
    var RATES = { 'AT': 1.0, 'BE': 1.0, 'BG': 0.510204, 'CH': 0.87556, 'CN': 0.13421, 'CZ': 0.039427, 'DE': 1.0, 'DK': 0.134026, 'EE': 1.0, 'ES': 1.0, 'FI': 1.0, 'FR': 1.0, 'GB': 1.161288, 'GR': 1.0, 'HR': 0.135135, 'HU': 0.003086, 'IC': 1.0, 'IE': 1.0, 'IT': 1.0, 'JP': 0.007631, 'KR': 0.000748, 'LT': 1.0, 'LU': 1.0, 'LV': 1.0, 'MT': 1.0, 'MX': 0.043717, 'NL': 1.0, 'PL': 0.240317, 'PT': 1.0, 'RO': 0.221146, 'RU': 0.013031, 'SE': 0.095985, 'SI': 1.0, 'SK': 1.0, 'TR': 0.153636, 'US': 0.846478 };

    var getConvertedValue = function (rates) {
      var _totalOrder = window.inditex.iUserJSON.shopCart.totalOrder;
      var _decimals = window.inditex.iStoreJSON.details.locale.currencyDecimals;
      var _rate = rates[window.inditex.iCountryCode] || 1.0;
      if (_decimals === 0) return Math.round(_totalOrder * _rate * 100);
      if (_decimals === -2) return Math.round(_totalOrder * _rate);
    };

    var _pushOptiEvents = function (rates, purchaseData) {
      window.optimizely = window.optimizely || [];
      window.optimizely.push({
        type: 'event',
        eventName: 'trackRevenue',
        tags: {
          revenue: getConvertedValue(rates)
        }
      });

      var count = 0;
      for (var i = 0, len = purchaseData.order.items.length; i < len; i++) {
        count += purchaseData.order.items[i].quantity;
      }
      window.optimizely.push({
        type: 'event',
        eventName: 'conversionNumberUnits',
        tags: {
          value: count
        }
      });
    };

    var ajaxRequest = jQuery.ajax({ url: inditex.getStaticResourceUrl(URL_JSON) });

    jQuery(document).on(bershka.events.Purchase, function (ev, purchaseData) {
      if (purchaseData && purchaseData.order && !inditex._getURLParameter('guestToken')) {
        ajaxRequest.then(function (ajaxResponse) {
          _pushOptiEvents(ajaxResponse, purchaseData);
        }, function () {
          _pushOptiEvents(RATES, purchaseData);
        });
      }
    });
  }
}, true);

/* FIX SCROLL ON SUBSCRIBE NEWSLETTER */
inditex.xOpenNewsletterPage = function(email, showUnsubscribe, showSubscribe, showBirthdate) {
	var url = inditex.encodeUrl({
		action : "ItxNewsletterPage",
		params : {
			storeId : inditex.iStoreId,
			langId : inditex.iLangId
		},
		isAjax: false
	});
	
	if(!showUnsubscribe && !showSubscribe) {
		return;
	}

	inditex.popupUrl(url, (showUnsubscribe && showSubscribe) ? 820 : 460, 'auto', function() {
		inditex.initModalController('ItxNewsletterPage',{
			'email':email,
			'showUnsubscribe':showUnsubscribe,
			'showSubscribe':showSubscribe,
			"showBirthdate": showBirthdate
		});
	}, null, 'modal', true);
};
/* END FIX SCROLL ON SUBSCRIBE NEWSLETTER */

/* FIX NO CODE TIMESTAMP */
bskImageService.prototype._toAkamaiServiceUrl = function(url, sizeDesc, multiplier) {
	multiplier=multiplier || 1;
	
	if(url.indexOf("?t=")!=-1) {
		url+="1";
	}
	
	if(sizeDesc && this.hasAkamaiImageService && !this.videoHelper.isVideo(url)) {
		var pos=url.lastIndexOf("/");
		var path = url.substr(0,pos+1)
		var name = url.substr(pos+1);

		var reg=/(\d+_\d_\d)_\d(.*)/;
		var matches=name.match(reg);
		if(matches) {
			var policy=this.constants.akamaiPolicyMaps[sizeDesc.policy] || "itxmedium";
			var params="imwidth="+sizeDesc.width*multiplier+"&impolicy="+policy;
			var hasParams=matches[2].indexOf("?")!=-1;
			return path+matches[1]+"_"+this.akamaiImageServiceSize+matches[2]+(hasParams?"&":"?")+params;
		}
	}
	return url;
};
/* END FIX NO CODE TIMESTAMP */

/* FIX IMAGEN FORZADA HERMANADOS */
bskImageService.prototype._coreGetXMediaProductDetailImages = function (product, color, location, size, stylism) {
	var catentryJSON=product.detail || product;
	
	if(stylism) {
		var style=parseInt(stylism,10);
		if(!isNaN(style)) {
			catentryJSON.xmediaDefaultSet=style;
		}
	} else {
		catentryJSON.xmediaDefaultSet=null;
	}
	
	var set=this.getProductXMediaSet(product);
	if(color && set) {
		color._style=("00"+set).substr(-2);
	}

	var sizeDesc=this.getXMediaSizeFor(location, size);
	if(!sizeDesc) {
		return [];
	}

	if(location<0) {
		location=this.constants.locations.CATEGORY_PAGE;
	}

	var oldDefault;
	if(catentryJSON && catentryJSON.defaultImageType && inditex.iPage=="ItxCategoryPage" && color) {
		oldDefault=catentryJSON.defaultImageType;
		var splitted=oldDefault.split("_");
		splitted[0]=catentryJSON.displayReference.replace("/","")+color.id;
		product.detail.defaultImageType=splitted.join("_");
	}
	var images = inditex.getProductXmediaImagesData(catentryJSON, color && color.id, location, set, sizeDesc.width, sizeDesc.height);
	if(oldDefault) {
		product.detail.defaultImageType=oldDefault;
	}	
	return images;
};
/* END FIX IMAGEN FORZADA HERMANADOS */

/* FIX DISABLE AKAMAI IMAGE SERVICE FOR BANNERS */
productNormalizerService.prototype._generateBannerImageObj = function(path, isDouble, isBanner) {
	var image={
		hasDoubleSize: []
	};
	
	for(var location in this.bskImageConstants.locations) {
		image[location]={
			hasDoubleSize: []
		};
		if(isDouble) {
			image.hasDoubleSize.push(location);
		}
		for(var size in this.bskImageConstants.sizes) {
			var sizeDesc=this.bskImageService.getXMediaSizeFor(this.bskImageConstants.locations[location], this.bskImageConstants.sizes[size]);
			if(sizeDesc) {
				var images=[this._generateBannerImageUrl(path, isDouble, sizeDesc)];
				image[location][size]=images;
				if(isDouble) {
					image[location].hasDoubleSize.push(size);
				}
			}
		}
	}
	return image;
};
/* END FIX DISABLE AKAMAI IMAGE SERVICE FOR BANNERS */

/* FIX defaultImageType on ColorCuts */
bskImageService.prototype.getColorCuts = function(product) {
	var oldDefaultImageType=product.detail.defaultImageType;
	product.detail.defaultImageType=null;

	if (this.hasXMedia(product)) {
		colorCuts=this.getXMediaColorCuts(product);
	} else {
		colorCuts=this.getClassicColorCuts(product);
	}

	product.detail.defaultImageType=oldDefaultImageType;
	return colorCuts;
};
/* END FIX defaultImageType on ColorCuts */

/* Directiva Tracking Custom Click events */
ItxTrackingService.prototype.eventList['custom-click'] = $.noop;
/* Directiva Tracking Custom Click events */

inditex.getModifiedSizeReferencesAffected = function(ref, size) {
	return size;
}

inditex.openExtraContactContent=inditex.xOpenPopUpMSpot;

inditex.xSocialLoginExtendedPermissionDisabled = true;



/* FIX HIDE STORE RETURN USA */
if(inditex.iCountryCode=="US" && (inditex.iPage == "ItxMyAccountReturnsPage" || inditex.iPage == "ItxGuestOrdersPage" || inditex.iPage == "ItxOrderConfirmationPage")) {
	inditex.onReady(function() {
		inditex.iStoreJSON.details.hasPhisicalStores = false;	
	}, true);
}
/* END FIX HIDE STORE RETURN USA */

/* BEAUTY COLOR MAPPING */
inditex.xBeautyColorMapping={
	"039": { "4493/490": "01 ASH" },
	"098": { "4449/321": "01 COTTON CANDY" },
	"112": { "4471/470": "03 LOYAL" },
	"122": { "4496/321": "01 ATOMIC LILY" },
	"122": { "4526/321": "06 FORBIDDEN RED" },
	"144": { "4471/470": "05 PRETTY" },
	"146": { "4505/321": "01 SASSY BUBBLEGUM" },
	"148": {
		"4449/321": "04 ROSE MOCHA",
		"4457/321": "01 HEARTBEAT GLOW",
		"4526/321": "01 ROSE MERINGUE"
	},
	"250": {
		"4448/321": "01 UNICORN SOUVENIR",
		"4549/531": "01 NEUTRAL",
		"9518/490": "01 MULTICOLOR",
		"9783/470": "01 CRYSTAL POP",
		"9790/321": "01 NEUTRAL"
	},
	"302": {
		"4486/490": "04 MARS STONE 2G",
		"4563/321": "02 GOLD FURY"
	},
	"407": { "4486/490": "02 ULTRAMARINE ECLIPSE" },
	"505": { "4496/321": "04 SAVAGE JUNGLE" },
	"537": { "4471/470": "10 LUCKY " },
	"555": { "4526/321": "05 GOTH WINE" },
	"599": { "4539/321": "04 SCARLET MANIA " },
	"600": {
		"4450/321": "01 RISKY RED",
		"4471/470": "07 AMBITIOUS",
		"4505/321": "06 CHILI FLAME",
		"4526/321": "07 JUST RED",
		"9787/598": "03 RED SUGAR"
	},
	"606": {
		"4471/470": "01 SUCCESSFUL",
		"4486/490": "03 RUBY METEORITES",
		"4505/321": "09 SENSUAL SANGRIA"
	},
	"611": { "4539/321": "06 MIDNIGHT BERRY" },
	"615": { "4545/470": "03 COQUETTE CANDY" },
	"624": {
		"4505/321": "05 STRAWBERRY COCKTAIL",
		"4526/321": "08 RASPBERRY FUN"
	},
	"629": {
		"4550/531": "01 NEUTRAL",
		"9519/490": "01 MULTICOLOR"
	},
	"630": { "4471/470": "08 ROMANTIC",
		"4480/470": "09 SASSY",
		"4526/321": "12 FUCHSIA SURRENDER",
		"4539/321": "03 FLAMINGO BACHATA",
		"4545/470": "02 EXQUISITE BERRIES",
		"9520/490": "01 PINK"
	},
	"638": {
		"4449/321": "05 PAPAYA PARADISE",
		"4471/470": "06 HAPPY",
		"4484/490": "01 NEUTRAL",
		"4526/321": "09 PLAYFUL CORAL",
		"4539/321": "02 WATERMELON FIESTA"
	},
	"641": {
		"4505/321": "08 GARNET CHACHACHA",
		"4539/321": "05 VAMPIRE VITAMINS"
	},
	"663": { "4505/321": "02 PINKY PROMISE" },
	"666": { "4457/321": "02 FANG CANDY" },
	"690": { "4505/321": "04 FUCHSIA STORM" },
	"696": {
		"4505/321": "03 SHOCKING TUTU",
		"4545/470": "04 TEMPTING COCO"
	},
	"700": {
		"4466/321": "01 POOL SPIRIT ",
		"4467/321": "02 PARADISE HACK",
		"4468/321": "03 DESERT GLOW",
		"4469/321": "04 HOLIDAY VIBES",
		"4493/490": "03 PRALINE",
		"4496/321": "02 MAGNETIC AMBER"
	},
	"706": { "4526/321": "03 TENDER TAUPE" },
	"716": {
		"4493/490": "02 MOCHA",
		"4500/321": "03 CHOCO",
		"4505/321": "10 CHOCOLATE BBQ"
	},
	"735": {
		"4457/321": "03 TRANSYLVANIAN SUN",
		"4486/490": "05 VOLCANIC SHINE"
	},
	"736": {
		"4460/321": "01 LIGHT",
		"4461/321": "02 MEDIUN",
		"4464/321": "3 TAN",
		"4465/321": "04 DEEP",
		"4471/470": "04 REAL"
	},
	"763": { "4500/321": "01 NOUGAT" },
	"775": { "4500/321": "02 CINNAMON" },
	"800": {
		"4471/470": "00 GUILTY",
		"4486/490": "01 COSMIC BLACK",
		"4496/321": "03 ANGELIC SMOKEY",
		"4504/321": "01 BLACK",
		"4485/490": "01 MUY BLACK"
	},
	"802": { "4471/470": "02 SMART" },
	"808": {
		"4486/490": "06 GALAXY DIAMOND",
		"4558/490": "01 SILVER RIOT",
		"4563/321": "01 SILVER GODDESS"
	},
	"813": {
		"4450/321": "03 BURNING BRONZE",
		"4558/490": "02 BRONZE BLAST"
	},
	"902": {
		"4450/321": "02 PINK CHAMPAGNE",
		"4545/470": "01 JUICY WATERMELON",
		"4558/490": "03 PINK SHOWER",
		"9783/470": "02 PINK BOOM"
	},
	"906": {
		"4526/321": "11 PINK CONFETTI",
		"9787/598": "01 ROCKY ROSE"
	},
	"920": { "4471/470": "11 EXCITING" },
	"927": {
		"4505/321": "11 WOLVES BALLET",
		"4526/321": "02 BLUSH BLOOM"
	},
	"949": {
		"4526/321": "04 BURNT PURPLE"
	},
	"972": {
		"4449/321": "02 DOLCE CERISE",
		"9787/598": "02 PINK SMACK"
	},
	"976": {
		"4449/321": "03 RADIANT LYCHEE",
		"4526/321": "10 CORAL GOSSIP",
		"9783/470": "03 PIM PAM PEACH"
	},
	"990": {
		"4450/321": "04 IRON PINK",
		"4505/321": "12 UNDRESSED CACAO",
		"4539/321": "01 VOLUPTUOUS NUDE"
	},
	"997": { "4505/321": "07 CHERRY-LICIOUS" }
};
/* END BEAUTY COLOR MAPPING */

/*
 * itx-common-custom.js
 */
inditex.xGenderToId={
	"40259529": { /* BSK */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"40259531": { /* BSK_CN */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361617": { /* BSK_CN_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259530": { /* BSK_EU1 */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361616": { /* BSK_EU1_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259532": { /* BSK_EU2 */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361618": { /* BSK_EU2_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259533": { /* BSK_FR */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"40259534": { /* BSK_GB */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361619": { /* BSK_GB_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259535": { /* BSK_MX */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361620": { /* BSK_MX_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259536": { /* BSK_RU */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361621": { /* BSK_RU_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259537": { /* BSK_TR */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"60361622": { /* BSK_TR_SALES */
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	},
	"40259538": { /* CATALOG JP */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"40259539": { /* CATALOG KR */
		"BERSHKA_WOMAN": 1010193132,
		"BERSHKA_MAN": 1010193133
	},
	"40259541": { /* CATALOG KR SALES*/
		"BERSHKA_WOMAN": 1010222005,
		"BERSHKA_MAN": 1010222006
	}
};

inditex.xGetGenderCategory = function() {
	var gender=inditex.readCookie("BershkaGenderCategoryKey");
	if(gender) {
		gender=gender.replace("_SALES","");
	}
	if(inditex.iParams && inditex.iParams.selectGender && gender!=inditex.iParams.selectGender[0]) {
		gender=inditex.iParams.selectGender[0];
		inditex.xSetGenderCategory(gender);
	}
	
	if(gender) {
		return gender;
	}
	return null;
};


/* CN NEWSLETTER */
(function() {
			inditex.xOpenNewsletterLegal=function() {
			var spotID="legalapp";
			var width=300;
			var height=300;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.writeCookie(cookieName,1,cookieExpiration);
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".ui-dialog.ui-widget.ui-widget-content.ui-corner-all.ui-front.fixed-dialog").addClass("popuprinonera");
				}, null,"modal");
			});
		};

})();
/* END CN NEWSLETTER */

/* NEWSLETTER WEEKLYPLANNER */
(function() {
		inditex.xOpenNewsletterWeekly=function() {
			var spotID="weekplan";
			var width=750;
			var height=419;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").addClass("maqweekly");
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEWSLETTER WEEKLYPLANNER */

/* NEWSLETTER JAPAN 10 */
(function() {
			inditex.xOpenJapanPromoPage=function() {
			var spotID="jp10";
			var width=400;
			var height=420;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEWSLETTER JAPAN 10 */


/* NEWSLETTER Korea 10 */
(function() {
			inditex.xOpenKrPromoPage=function() {
			var spotID="kr10";
			var width=400;
			var height=420;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEWSLETTER KOREA 10 */

/* POP UP NEWSLETTER FREQUENCY*/
(function() {
	angular.module("itxApp").run(["$timeout", "bskStateFactory", function($timeout, state) {
		if(state.search('openNewsletterFrequency')) {
			var spotID="NewsletterFrequency";
			var width=400;
			var height=420;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					state.search('openNewsletterFrequency', null).replace();
				}, null,"modal");
			});
		}
	}]);
})();
/* END POP UP NEWSLETTER FREQUENCY*/


/* Popup TR payment regulation */
(function() {
			inditex.xOpenPaymentRegulationTR=function() {
			var spotID="paymentRegulationTR";
			var width=700;
			var height=550;
			

			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END Popup TR payment regulation */



/* NEW EXPRESS DELIVERY PL */
(function() {
			inditex.xOpenExpressPopupPL=function() {
			var spotID="ExpressPL";
			var width=500;
			var height=218;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEW EXPRESS DELIVERY PL */



/* NEW EXPRESS DELIVERY PL */
(function() {
			inditex.xOpenNextDayPLGB=function() {
			var spotID="NextDay";
			var width=600;
			var height=220;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEW EXPRESS DELIVERY PL */



/* BUEN FIN MX */
(function() {
			inditex.xOpenBFLegalMX =function() {
			var spotID="buenfin_MX";
			var width=600;
			var height=300;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END BUEN FIN MX */


/* PRE SALDO */
(function() {
			inditex.xOpenPresaldo =function() {
			var spotID="presaldo";
			var width=600;
			var height=300;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* PRE SALDO */

/* SIN INTERESES MX */
(function() {
	inditex.xOpenSILegalMX =function() {
	var spotID="sinint_MX";
	var width=600;
	var height=300;
	
	inditex.loadSpot(spotID,function(mSpotHtml) {
		inditex.popupHtml(mSpotHtml, width, height, function() {
			inditex.initModalController("ItxNewsletterPage", {
				'showUnsubscribe' : false,
				'showBirthday': false
			});
			$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
		}, null,"modal");
	});
};

})();
/* SIN INTERESES */


/* BLACK FRIDAY FRONT */
(function() {
			inditex.xOpenBlackFridayLegal =function() {
			var spotID="blackfriday_popup";
			var width=600;
			var height=220;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END BLACK FRIDAY FRONT */



/* PROMO KR*/
(function() {
			inditex.xOpenPromoKR =function() {
			var spotID="promoKR";
			var width=600;
			var height=220;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO KR */


/* PROMO US*/
(function() {
			inditex.xOpenPromoUS =function() {
			var spotID="promoUS";
			var width=600;
			var height=220;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO US */




/* NEW EXPRESS DELIVERY DE */
(function() {
			inditex.xOpenExpressPopupDE=function() {
			var spotID="ExpressDE";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END NEW EXPRESS DELIVERY DE */


/* PROMO LAPIZ TR */
(function() {
			inditex.xOpenLapizTR=function() {
			var spotID="LapizTR";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO LAPIZ TR */



/* ENTREGAS NAVIDAD */
(function() {
			inditex.xOpenEntregasNavidad=function() {
			var spotID="EntregasNavidad";
			var width=650;
			var height=450;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END ENTREGAS NAVIDAD */

/* TURKEY ANNIVERSARY */
(function() {
			inditex.xOpenTrAnniversary=function() {
			var spotID="TrBday";
			var width=500;
			var height=218;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END TURKEY ANNIVERSARY */


/* FIT GUIDE WOMAN */
(function() {
		inditex.xOpenFitGuideWoman=function() {
			var spotID="modalFitGuideWoman";
			var width=500;
			var height=218;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal",true,null,true);
			});
		};

})();
/* END FIT GUIDE WOMAN */


/* TURKEY ANNIVERSARY2 */
(function() {
			inditex.xOpenTrAnniversary2=function() {
			var spotID="TrBday2";
			var width=500;
			var height=300;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END TURKEY ANNIVERSARY2 */


/* TURKEY WEEKLY */
(function() {
			inditex.xOpenTrWeekly=function() {
			var spotID="weekplan";
			var width=750;
			var height=420;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").addClass("maqweekly");
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END TURKEY WEEKLY */


/* PROMO SHOES 21/10 */
(function() {
			inditex.xOpenPromoShoes=function() {
			var spotID="PromoShoes";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO SHOES 21/10 */


/* REBAJAS INVIERNO 2018 */
(function() {
			inditex.xOpenPopupSalesWinter2018=function() {
			var spotID="PopupSalesSummer2018";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END REBAJAS INVIERNO 2018 */


/* PROMO COMPRA POR RECOMPENSA */
(function() {
			inditex.xOpenCPR=function() {
			var spotID="PromoCPR";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO POR RECOMPENSA */


/* PROMO COMPRA POR RECOMPENSA */
(function() {
			inditex.xOpenCPR2=function() {
			var spotID="PromoCPR2";
			var width=500;
			var height=347;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO POR RECOMPENSA */


/* PROMO 30 */
(function() {
			inditex.xOpenPromo30=function() {
			var spotID="Promo30";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO 30 */

/* PROMO 30 */
(function() {
			inditex.xOpenPromoCPRShoes=function() {
			var spotID="PromoCPRShoes";
			var width=500;
			var height=247;
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				inditex.popupHtml(mSpotHtml, width, height, function() {
					inditex.initModalController("ItxNewsletterPage", {
						'showUnsubscribe' : false,
						'showBirthday': false
					});
					$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations","home_march_lookbook");
				}, null,"modal");
			});
		};

})();
/* END PROMO 30 */


/* USA POPUP STORE */
(function() {
			inditex.xOpenPopupStore=function() {
			var spotID="PopupStore";
			var width=$(window).width()-100;
			var height=(width*9/16);
			
			var $container=$("<div />").addClass("video-container");
			var $video=$("<div />").addClass("video-container-video");
			var $close=$("<span />").addClass("video-container-close ico ico-close-thick").on("click", function() {
				$container.detach();
				bershka.showScrolls();
			});
			
			inditex.loadSpot(spotID,function(mSpotHtml) {
				bershka.hideScrolls();
				var centerX=($(window).width()-width)/2;
				var centerY=($(window).height()-height)/2;

				$video.css({
					top: centerY,
					left: centerX,
					width: width,
					height: height
				}).html(mSpotHtml).append($close);

				$container.append($video).appendTo($("body"));
			});
		};

})();
/* END USA POPUP STORE */


/* JP HIDE FILTERS */
(function() {
	if(inditex.iCountryCode=="JP" || inditex.iCountryCode=="KR") {
		ItxCategoryPageClass.prototype._getDefaultFiltersVisibility=function() {
			return false;
		};
	}
})();
/* END JP HIDE FILTERS */

/* OPEN POPUP MSPOT WITH CLASS */
(function() {
	/*
	 * Busca textos según prioridad, primero langId+countryCode, despues langId, al final ingles por defecto
	 */
	function getTranslation(translations)	{
		var currentLangId=inditex.iLangId.toString();
		var currentCountry=inditex.iCountryCode;
		
		var spec=[currentLangId+currentCountry, currentLangId, "-1"]; // prioridades de busqueda
		for(var i=0, len=spec.length; i<len; i++) {
			var currentSpec=spec[i];
			for(var j=0, numTexts=translations.texto.length; j<numTexts; j++) {
				var currTexto=translations.texto[j];
				if(currTexto.lang==currentSpec) {
					return currTexto.descripcion;
				}
			}
		}
		return "";
	}
	
	function assignTextsByLang(translations, DOM) {
		for(var i=0, len=translations.contenido.length; i<len; i++) {
			var current=translations.contenido[i];
			var where=DOM.find("."+current.referencia);
			if(where.length) { // tenemos que hacer sustitucion
				where.html(getTranslation(current));
			}
		}
	}
	
	function assignTexts(DOM) {
		var JSON=inditex.xGetDataHomeJSON();
		var dataTranslations=DOM.find("[data-translations]").addBack().attr("data-translations");
		if(JSON && dataTranslations) {
			for(var i=0, len=JSON.length; i<len; i++) {
				var current=JSON[i];
				if(current.nameHomeModule==dataTranslations) {
					assignTextsByLang(current, DOM);
				}
			}
		}
	}
	
	angular.module("itxApp").controller("popupConverse", ["$scope", function($scope) {
		$scope.core=inditex;
	}]);

	inditex.xOpenPopupMSpotWithClass=function(mSpotId, width, height, cls) {
		inditex.loadSpot(mSpotId,function(mSpotHtml) {
			var DOM=$(mSpotHtml);
			
			assignTexts(DOM);
			inditex.popupDom(DOM, width, height, function() {
				$("#modal").addClass(cls);
				inditex.initModalController("ItxConversePage", {
					'showUnsubscribe' : false,
					'showBirthday': false
				});
			}, null,"modal");
		});
	};
})();
/* END OPEN POPUP MSPOT WITH CLASS */

/* OCULTAR TALLAS BEAUTY */
if(inditex.iCategoryId==1010193143 || inditex.iCategoryId==1010193185) {
	var styleHidden=".prodInfo .sizes { visibility: hidden; }";
	var styleNone=".product-description .prodInfo .sizes, .prodInfo .product-detail-size-name, .prodInfo .product-detail-sizeguide { display: none; }";
	var styleText="p.small.modelSize { font-size: 13px; color: #000; margin-bottom: 15px; line-height: 140%; }";
	var $style=$("<style />").html(styleHidden+styleNone+styleText);
	$("head").append($style);
}
/* END OCULTAR TALLAS BEAUTY */

/* getUniqueSizes fix para tallas con "-" */
/*
inditex.ixGetUniqueSizes = function(sizes, visibilityMap) {
	if (!sizes) {
		return [];
	}

	var sizesLength = sizes.length;
	var uniqueSizes = [];
	
	var priority = {
		"hidden" : 0,
		"sold_out" : 1,
		"coming_soon" : 2,
		"back_soon" : 3,
		"show" : 4
	};
	
	var secondPriority = {
		"UNDEFINED_UMBRAL_STOCK": 0,
		"BSK_UMBRAL_BAJO": 1,
		"BSK_UMBRAL_ALTO": 2
	};

	for (var i = 0; i < sizesLength; i++) {
		var exists = false;
		var size = sizes[i];
		var uniqueSizesLength = uniqueSizes.length;
		
		for (var j = 0; j < uniqueSizesLength; j++) {
			var uniqueSize = uniqueSizes[j];
			var uname = $.trim(uniqueSize.name);
			var sname = $.trim(size.name);

			if (uname.toUpperCase() == sname.toUpperCase()) {
				exists = true;
				
				var uniqueSizePriority = priority[visibilityMap[uniqueSize.sku]];
				var sizePriority = priority[visibilityMap[size.sku]];

				var uniqueSizeSecondPriority = secondPriority[stockMap[uniqueSize.sku]] || 0;
				var sizeSecondPriority = secondPriority[stockMap[size.sku]];

				if ((sizePriority >= uniqueSizePriority) && (sizeSecondPriority > uniqueSizeSecondPriority)) {
					uniqueSizes[j] = sizes[i];
				}

				break;
			}
		}

		if (!exists) {
			uniqueSizes.push(size);
		}
	}

	var uniqueSizesName = $.map(uniqueSizes, function(size) {
		return size.name.replace(/\s*\([^)]*\)/g,"");
	});
	uniqueSizesName=inditex.sortSizes(uniqueSizesName);
	uniqueSizes=uniqueSizes.sort(function(a,b) {
		var aName=a.name.split("-")[0];
		var bName=b.name.split("-")[0];
		return uniqueSizesName.indexOf(aName)-uniqueSizesName.indexOf(bName);
	});
	
	return uniqueSizes;
};
*/
/* end fix */

/* FIX BACK PERSISTENCE */
!(function() {
	window.xConfigOverride=window.xConfigOverride || {};
	window.xConfigOverride.ShopCartDeferPersist="1"
})();
/* END FIX BACK PERSISTENCE */

/*
 * itx-home-custom.js
 */
 
(function() {
	if(inditex.iPage=="ItxHomePage" && inditex.xGetGenderHome && !inditex.getSessionStorage("GENDER_REDIRECTED")) {
		var genderId=inditex.xGetGenderCategoryId();
		var genderHome=inditex.getCategoryUrl(genderId);

		if(genderId && genderHome) {
			var utmParams=location.href.split("?")[1];
			if(utmParams) {
				genderHome += (genderHome.indexOf("?") == -1)?"?"+utmParams:"&"+utmParams;
			}
			
			var referrer=document.referrer;
			if(referrer) {
				document.cookie = "bsk_source="+referrer+"; path=/";
			}
			
			inditex.setSessionStorage("GENDER_REDIRECTED", true);
			window.location.href=genderHome;
		}
	} else {
		inditex.onReady(function() {
			inditex.removeSessionStorage("GENDER_REDIRECTED");
		}, true);
	}
})();

/* IMPRINT DE */
inditex.xOpenImpressum=function() {
	inditex.loadSpot("Imprint",function(html){
		inditex.popupHtml(html, 647, 500, null, null, "aux_modal", false);
	});
}
/* END IMPRINT DE */

/* START STORE REDIRECT WITH PARAMS */
inditex.encodeStoreUrlWithParams = function(store, langId, useHostName) {
	var paramsToKeep=["openPrivacyPolicy", "promo", "showChangePassword", "showContact", "showNewsletter", "showNewsletterConfirm", "sign", "unsubscription", "sendMe", "mail", "myAccount", "hashValue", "utm_source", "utm_medium", "utm_campaign", "csbsMe"];
	var params={};
	for(var i=0, len=paramsToKeep.length; i<len; i++) {
		var param=paramsToKeep[i];
		if(inditex.iParams[param] && inditex.iParams[param].length) {
			params[param]=inditex.iParams[param];
		}
	}
	return inditex.encodeStoreUrl(store, langId, useHostName, params);
};
/* END STORE REDIRECT WITH PARAMS */

(function() {
	
/*
 * Especificaciones
 *   days: cadena de texto separado por comas con los siguientes posibles valores L,M,X,J,V,S,D
 *   startTime: numero de minutos desde medianoche para que se aplique el mensaje, por defecto 0
 *   endTime: numero de minutos desde medianoche para que se aplique el mensaje, si no está por defecto es siempre
 *   refreshTime: cada cuantos segundos hay que refrescar el mensaje, por defecto cada segundo
 *   messages: conjunto de mensajes por idioma que se tienen que mostrar, las posibles sustituciones son:
 *      {H} por hora 1/2 digitos
 *      {HH} por hora 2 digitos
 *      {M} por minutos 1/2 digitos
 *      {MM} por minutos 2 digitos
 *      {S} por segundos 1/2 digitos
 *      {SS} por segundos 2 digitos
 *
 */

	/*
	var configuration={
		"ES": [
			{
				selector: "#countdown",
				days: "L,M,X,J",
				endTime: 1080, //18:00
				messages: {
					"-1": "Buy it in {H}:{MM}:{SS} and get it tomorrow in one of our stores!",
					"-5": "Compra en {H}:{MM}:{SS} y ¡recíbelo mañana en tienda!"
				}
			},
			{
				selector: "#countdown",
				days: "L,M,X,J",
				startTime: 660, //11:00
				endTime: 840, //14:00
				messages: {
					"-1": "Buy it in {H}:{MM}:{SS} and get it tomorrow 1!",
					"-5": "Compra en {H}:{MM}:{SS} y ¡recíbelo mañana 1!"
				}
			},
			{
				selector: "#countdown",
				days: "L,M,X,J",
				startTime: 600, //10:00
				endTime: 840, //14:00
				messages: {
					"-1": "Buy it in {H}:{MM}:{SS} and get it tomorrow 2!",
					"-5": "Compra en {H}:{MM}:{SS} y ¡recíbelo mañana 2!"
				}
			},
			{
				selector: "#countdown",
				days: "V",
				endTime: 1280, //18:00
				messages: {
					"-1": "Buy it in {H}:{MM}:{SS} and get it monday!",
					"-5": "Compra en {H}:{MM}:{SS} y ¡recíbelo el lunes!"
				}
			},
			{
				selector: "#countdown",
				days: "L,M,X,J",
				messages: {
					"-1": "get it in one day!",
					"-5": "¡Recibe tu pedido en un día!"
				}
			}
		]
	};
	*/
	var configuration=
	{
		// "GB": [
		// 	{
		// 		selector: ".txtA",
		// 		days: "L,M,X,J",
		// 		endTime: 1080, //18:00
		// 		messages: {
		// 			"-1": "<a onClick='inditex.xOpenNextDayPLGB()'>Purchase in {H}:{MM}:{SS} and get it tomorrow!</a> | Free Shipping on all orders above £40"
		// 		}
		// 	}, {
		// 		selector: ".txtA-m",
		// 		days: "L,M,X,J",
		// 		endTime: 1080, //18:00
		// 		messages: {
		// 			"-1": "<a onClick='inditex.xOpenNextDayPLGB()'>Purchase in {H}:{MM}:{SS} and get it tomorrow!</a>"
		// 		}
		// 	}
		// ],
		"PL": [
			{
				selector: ".txtB",
				days: "L,M,X,J",
				endTime: 960, //16:00
				messages: {
					"-1": "<a onClick='inditex.xOpenNextDayPLGB()'>Purchase in {H}:{MM}:{SS} and get it tomorrow!</a>",
					"-22": "<a onClick='inditex.xOpenNextDayPLGB()'>Kup w ciągu {H}:{MM}:{SS} i otrzymaj zakupy jutro!</a>"
				}
			}
		]
}
	
	function toLength(str, len, fill) {
		var filler=Array(len+1).join(fill||"0");
		return (filler+str).substr(-len);
	}
	
	function getNowTime() {
		var now=new Date();
		return now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
	}
	
	function replaceMessage(configElement) {
		var message=configElement.messages?configElement.messages[inditex.iLangId]:"";
		if(message) {
			var deltaTime=configElement.endTime-getNowTime();
			
			var deltaH=Math.floor(deltaTime/3600);
			deltaTime-=deltaH*3600;
			var deltaM=Math.floor(deltaTime/60);
			deltaTime-=deltaM*60;
			var deltaS=deltaTime;

			var substitutions={
				"HH": toLength(deltaH,2),
				"H": deltaH,
				"MM": toLength(deltaM,2),
				"M": deltaM,
				"SS": toLength(deltaS,2),
				"S": deltaS
			}
			for(var key in substitutions) {
				if(substitutions.hasOwnProperty(key)) {
					message=message.replace("{"+key+"}", substitutions[key]);
				}
			}
		}
		return message;
	}
	
	var countryConfig=[];

	function refreshMessage() {
		var now=new Date();
		var limit=getNowTime();
		var weekDay=now.getDay();
		var found = null;
		
		for(var i=0, len=countryConfig.length; i<len; i++) {
			var configElement=countryConfig[i];
			if(configElement.startTime<limit && configElement.endTime>limit && configElement.days.indexOf(weekDay)!=-1) {
				if(found && found.selector == configElement.selector) {
					continue;
				}
				var message=replaceMessage(configElement);
				$(configElement.selector).html(message);
				if(configElement.refreshTime && !found) {
					setTimeout(refreshMessage, configElement.refreshTime);
				}
				found = configElement;
			}
		}
	}
	
	function normalizeConfig() {
		var daysToNumber=["D","L","M","X","J","V","S"];
		
		for(var i=0, len=configuration[inditex.iCountryCode].length; i<len; i++) {
			var currentConfig=configuration[inditex.iCountryCode][i];
			
			if(typeof currentConfig.endTime=="undefined") {
				currentConfig.endTime=86400; //24:00:00
			} else {
				currentConfig.endTime*=60;
			}
			if(typeof currentConfig.startTime=="undefined") {
				currentConfig.startTime=0;
			} else {
				currentConfig.startTime*=60;
			}
			if(typeof currentConfig.refreshTime == "undefined") {
				currentConfig.refreshTime=1000;
			} else {
				currentConfig.refreshTime*=1000;
			}
			
			var days=currentConfig.days.split(",");
			if(!days.length) {
				days=daysToNumber;
			}
			currentConfig.days=[];
			for(var j=0, numDays=days.length; j<numDays; j++) {
				currentConfig.days.push(daysToNumber.indexOf(days[j]));
			}
			
			if(typeof currentConfig.selector != "undefined" || typeof currentConfig.days == "undefined") {
				countryConfig.push(currentConfig);
			}
		}
	}

	if(configuration && configuration[inditex.iCountryCode]) {
		normalizeConfig();
		
		if(countryConfig.length) {
			countryConfig.sort(function(a,b) {
				var end=a.endTime-b.endTime;
				if(end==0) {
					end=a.startTime-a.startTime
				}
				return end;
			});
			
			refreshMessage();
		}
	}
})();

/* TEST A/B HELPERS */

/* DISABLE STOCK CHECK ON MULTIPLE QUICKSHOP */
ItxAjaxLookPageClass.prototype._filterProductByStock = function(toFilterProducts,visibilityMap){
	return toFilterProducts;
};
/* END DISABLE STOCK CHECK ON MULTIPLE QUICKSHOP */

angular.module("itxApp").directive("olapicHome", ["$timeout", function($timeout) {
	return {
		scope: {
			src: "@",
			olapic: "@",
			instance: "@",
			apikey: "@",
			lang: "@"
		},
		restrict: "E",
		replace: true,
		link: function(scope) {
			$timeout(function() {
				var scr="<script type='text/javascript' src='"+scope.src+"' data-olapic='"+scope.olapic+"' data-instance='"+scope.instance+"' data-apikey='"+scope.apikey+"' data-lang='"+scope.lang+"' async='async'></script>"
				$("body").append(scr);
			},0,false);
		}
	};
}]);

inditex.openQuickLook = function(productId, colorId, categoryId, isProduct, productIndex, isWishList, pHeight, SKU, stylism) {
    inditex.xOpenQuickLook({
        productId: productId,
        colorId: colorId,
        isWishList: isWishList,
        SKU: SKU,
		categoryId: categoryId,
        stylism: stylism
    }, null, pHeight)
};

inditex.xGoToCategory=function(categoryId, target) {
	target=target||"_self";
	var url=inditex.getCategoryUrl(categoryId);
	window.open(url, target);
	return false;
};
/*
inditex.xGetCategoryUrlByKey=function(key) {
	if(key) {
		var category=inditex.xFindCategoryKey(key).pop() || inditex.xFindCategoryKey(key+"_SALES").pop();
		if(category) {
			return inditex.getCategoryUrl(category.viewCategory || category.id);
		}
		return "#";
	}
	return "#";
};
*/
angular.module("itxApp").controller("landingPage", ["$scope", "bskDeviceService", function($scope, deviceService) {
    $scope.deviceService=deviceService;
}]);

ItxHomeTrackingController.prototype._loadBindings=function() {
	var oldLoadBindings=bershka.generateLoadBindingsFunction();
	oldLoadBindings.apply(this);
	
	if (inditex.iPage == "ItxMSpotPage" &&
        window.location.search.match("isLGNorigin") != null &&
        window.location.search.match("app") != null) {
             inditex.xOpenNewsletterPage(null,false,true, false);
    }
	
	this.iScope.deviceService=inditex.xDesktopMobileScreenModule;
}

ItxHomeTrackingController.prototype._bindings.getCategoryName=function(id) {
	var found=this.iScope.categoryFactory.findCategoryId(id).pop();
	if(found) {
		return found.name;
	}
	return ""
};

angular.module("itxApp").directive("imageInViewport", ["bskScrollFactory", "$timeout", function(scrollFactory, $timeout) {
	function parseThreshold(threshold) {
		if(!threshold) {
			return 0;
		}
		threshold=threshold.toString();
		var winHeight=$(window).height();
		var numeric=parseInt(threshold,10);
		if(isNaN(numeric)) {
			return 0;
		}
		if(threshold.indexOf("%")!=-1) {
			return winHeight*numeric/100;
		}
		return numeric;
	}

	var timer=null;
	function triggerRecheck() {
		timer && $timeout.cancel(timer);
		timer=$timeout(function() {
			scrollFactory.checkAllElements();
		},0,false);
	}

	return {
		restrict: "A",
		link: function(scope, element, attrs) {
			var threshold=parseThreshold(attrs.imageInViewportThreshold);

			var watcher=scrollFactory.addElement(element, function(inViewport) {
                var altSrc = element.attr("alt-src");
                if(inViewport && altSrc) {
                    element.attr("src", altSrc);
                    element.removeAttr("alt-src");
                }
			}, false, threshold);

			triggerRecheck();

			scope.$on("$destroy", function() {
				scrollFactory.removeElement(watcher);
			});
		}
	};
}]);

/* CAROUSEL TIPOLOGIES */
(function() {
	angular.module("itxApp").config(["$provide", function($provide) {
		$provide.decorator("bskCarouselDirective", ["$delegate", function($delegate) {
			var directive=$delegate[0];
			directive.controller[directive.controller.length-1] = bskCarouselCtrlFix;
			
			return $delegate;
		}]);
	}]);
	
	function normalize(settings, parent) {
		var normalized=$.extend({}, parent, settings);
		normalized.slides=parseInt(normalized.slides,10);
		normalized.move=Math.min(normalized.slides, parseInt(normalized.move,10));
        if(isNaN(normalized.move)) {
            normalized.move=normalized.slides;
        }
        
		normalized.touchMove=parseInt(normalized.touchMove,10);
		if(isNaN(normalized.touchMove) || !normalized.touchMove) {
			normalized.touchMove=normalized.move;
		}
		if(normalized.touchMove>normalized.slides) {
			normalized.touchMove=normalized.slides;
		}

		if(normalized.breakpoints) {
			var breakpoints=normalized.breakpoints;
			delete normalized.breakpoints;
			var newBreakpoints={};
			for(var key in breakpoints) {
				var numericKey=parseInt(key, 10);
				if(!isNaN(numericKey)) {
					newBreakpoints[key]=normalize(breakpoints[key], normalized);
				}
			}
			normalized.breakpoints=newBreakpoints;
		}
		return normalized;
	}

	var instances=0;
	function bskCarouselCtrlFix($swipe, $timeout, $element, $attrs, $scope, window, config) {
		this.instanceId=instances++;

		this.$window = $(window);
		this.$swipe = $swipe;
		this.$timeout = $timeout;
		this.$element = $element;
		this.$loading = $element.find(".carousel-loading");
		this.$slidesContainer = $element.find(".bsk-carousel-slides");
		this.$scope = $scope;
		this.config=config;
		this.$attrs=$attrs;

		this.showNext = false;
		this.showPrevious = false;
		
		this.normalizedSettings = null;
		this.currentSettings = null;
		this.waitingForImages = false;
		this.position = 0;
		
		this.$slidesContainer.hide();

		this.init.apply(this, arguments);
	}
	
	bskCarouselCtrlFix.prototype.init = function() {};
	
	function isTrueValue(val) {
		return val=="1" || val=="true";
	}
	
	bskCarouselCtrlFix.prototype.$onInit = function() {
		var self = this;

		if(this.modelCtrl) {
			this.modelCtrl.$render = function() {
				if(self.currentSettings) {
					self.setSlide(self.modelCtrl.$viewValue);
				} else {
					self.index=self.modelCtrl.$viewValue;
				}
			}
		} else {
			this.index=0;
		}		

		this.$window.on("resize.bsk-carousel-"+this.instanceId, _.debounce(function() {
			self.recalculate();
		},50));
		
		this.$element.on("bsk-carousel-slide.bsk-carousel-"+this.instanceId, function(ev, data) {
			self.$timeout(function() {
				var index=parseInt(data, 10);
				if(!isNaN(index)) {
					self.setSlide(index);
				}
			});
		});
		
		this.$scope.$on("ngRepeatFinished", function() {
			self.index=0;
			self.recalculate();
		});
	};
	
	bskCarouselCtrlFix.prototype.$onChanges = function(changes) {
		if(changes && changes.settings && changes.settings.currentValue) {
			this.normalizedSettings = normalize(this.settings, this.config.settings);

			this.recalculate();
		}
	};
	
	bskCarouselCtrlFix.prototype.$onDestroy = function() {
		this.$window.off("resize.bsk-carousel-"+this.instanceId);
		this.$element.off("bsk-carousel-slide.bsk-carousel-"+this.instanceId);
	};

	bskCarouselCtrlFix.prototype.isOnDemand=function() {
		return this.$attrs.hasOwnProperty("onDemand");
	};
	
	bskCarouselCtrlFix.prototype.isOnDemandWait=function() {
		return this.$attrs.hasOwnProperty("onDemandWait");
	};
	
	bskCarouselCtrlFix.prototype.setSettings=function() {
		if(!this.normalizedSettings) {
			this.normalizedSettings = normalize(this.settings, this.config.settings);
		}
		this.currentSettings=this.normalizedSettings;
		if(this.normalizedSettings.breakpoints) {
			var lastDelta=1, width=this.$window.width();
			for(var key in this.normalizedSettings.breakpoints) {
				var delta=width-parseInt(key, 10);
				if(delta<=0 && (lastDelta>0 || delta>lastDelta)) {
					lastDelta=delta;
					this.currentSettings=this.normalizedSettings.breakpoints[key];
				}
			}
		}
		this.slideWidth=(100/this.currentSettings.slides);
	};

	bskCarouselCtrlFix.prototype.recalculate = function() {
		var self=this;
		this.$timeout(function() {
			self.setSettings();
			self.$slides = self.$slidesContainer.find("[bsk-carousel-slide]");
			self.numSlides = self.$slides.length;
			self.setSlide(self.index || 0);
			self.$slidesContainer.show();
		});
	};
	
	function doSlidesPreload(preloadSlides) {
        preloadSlides.addClass("bsk-carousel-slide-preload").each(function() {
            $(this).triggerHandler("bsk-slide-preload");
        });
	}

	function triggerSlides(visibleSlides) {
        var hiddenSlides = this.$slides.not(visibleSlides);

        visibleSlides.addClass(this.currentSettings.clazz);
        hiddenSlides.removeClass(this.currentSettings.clazz);

        visibleSlides.addClass("bsk-carousel-slide-loaded").each(function() {
            $(this).triggerHandler("bsk-slide-visible");
        });
        hiddenSlides.each(function() {
            $(this).triggerHandler("bsk-slide-hidden");
        });
	}
	
	function transformCarousel(index, wait) {
        var position = (this.slideWidth*index).toFixed(2);

		if(wait) {
			var self = this;
			this.$timeout(function() {
				self.position = position;
				self.index = index;
			});
		} else {
			this.position = position;
			this.index = index;
		}
		this.$slidesContainer.css("transform", "translateX(-"+position+"%)");
		this.waitingForImages = false;
		this.$element.triggerHandler("bsk-carousel-slide-end", index);
	}

	bskCarouselCtrlFix.prototype.setStyles = function(index) {
        var preloadSlides = this.$slides.slice(index<this.currentSettings.slides?0:index-this.currentSettings.slides, index+this.currentSettings.slides*2), // slides to preload
        visibleSlides = this.$slides.slice(index, index+this.currentSettings.slides), // slides to show
		visibleSlidesNotLoaded = visibleSlides.not(".bsk-carousel-slide-loaded, .bsk-carousel-slide-preload");

	    this.$element.triggerHandler("bsk-carousel-slide-start", index);
	
	    if(this.isOnDemand()) {
			doSlidesPreload.call(this, preloadSlides);
	
	        if(this.isOnDemandWait() && visibleSlidesNotLoaded.length) {
	            var self = this;
	
				this.$loading.show();
				this.waitingForImages = true;
	
	            visibleSlidesNotLoaded.imagesLoaded(function() {
                    self.$loading.hide();
	
					triggerSlides.call(self, visibleSlides);
					transformCarousel.call(self, index, true);
	            });
	        } else {
				transformCarousel.call(this, index, false);
	        }
	    } else {
			transformCarousel.call(this, index, false);
		}
	};
	
	bskCarouselCtrlFix.prototype.refreshControls = function(index) {
		if(this.numSlides<=this.currentSettings.slides) {
			this.showPrevious = false;
			this.showNext = false;
		}
		this.showPrevious = index>0;
		this.showNext = (index+this.currentSettings.slides)<this.numSlides;
	};
	
	bskCarouselCtrlFix.prototype.setSlide = function(index) {
		if(!this.waitingForImages) {
			index = index||0;			
			if((index+this.currentSettings.slides)>=this.numSlides) {
				index = this.numSlides-this.currentSettings.slides;
			}
			
			if(index<0) {
				index = 0;
			}
			
			this.setStyles(index);
			this.refreshControls(index);
			
			if(this.modelCtrl) {
				this.modelCtrl.$setViewValue(index);
			}
		}
	};

	bskCarouselCtrlFix.prototype.getSlidesToMove = function(swipe) {
		return swipe?this.currentSettings.touchMove:this.currentSettings.move;
	};
	
	bskCarouselCtrlFix.prototype.nextSlide = function(swipe, $event) {
		$event && $event.stopPropagation();
		if(!swipe || this.currentSettings.slide) {
			this.setSlide(this.index+this.getSlidesToMove(swipe));
		}
	};
	
	bskCarouselCtrlFix.prototype.previousSlide = function(swipe, $event) {
		$event && $event.stopPropagation();
		if(!swipe || this.currentSettings.slide) {
			this.setSlide(this.index-this.getSlidesToMove(swipe));
		}
	};	
})();

tipologyCarouselCtrl.prototype.$onInit=function() {	
	this.hasFilters = false;
	//this.buildDescriptors();
	//this.orderSubcategories();

    var removerAdd = this.filterService.$applied.push(this.orderSubcategories.bind(this));
    var removerDel = this.filterService.$removed.push(this.orderSubcategories.bind(this));
	var self=this;
	var removerLoaded = this.filterService.$loaded.push(function() {
		self.buildDescriptors();
		self.orderSubcategories();
	});
	
	this.clearImagePath = this.imagePath+"/"+this.categoryId+"_"+inditex.langId+".jpg";
    
    this.$onDestroy=function() {
        removerAdd();
        removerDel();
		removerLoaded();
    };
};

tipologyCarouselCtrl.prototype.buildDescriptors = function() {
	var category = this.categoryFactory.findCategoryId(this.categoryId || inditex.iCategoryId).pop();
	if(category._config.isFilterCategory) {
		category = this.categoryFactory.findCategoryId(category._config.linkCategoryId).pop();
	}
	var categories = category?category.subcategories:[];

	this.descriptors=[];

	for(var i=0, len=categories.length; i<len; i++) {
		var current=categories[i];
		var obj={
			category: current,
			selected: false,
			clears: false,
			multiLanguage: false,
			label: this.showLabels?current.name:""
		}

		this.descriptors.push(obj);
	}	
};

tipologyCarouselCtrl.prototype.orderSubcategories=function() {
	if(!this.descriptors) {
		return;
	}
	var active = this.filterService.getActiveFilters("tipology");
	var i, len;
	this.hasFilters = false;

	for(i=0, len=this.descriptors.length; i<len; i++) {
		var obj=this.descriptors[i];
		var found=this.searchFilterForCategory(active, obj.category);

		if(found) {
			obj.selected=true;
			this.hasFilters=true;
		} else {
			obj.selected=false;
		}
	}
	
	if(!this.hasFilters) {
		for(i=0, len=this.descriptors.length; i<len; i++) {
			this.descriptors[i].selected=true;
		}
	}
};

tipologySliderCtrl.prototype.goToCategory=function(ev) {
	ev.preventDefault();
	ev.stopPropagation();
	var filters=this.filterService.getFilters("tipology");
	var found=this.searchFilterForCategory(filters, this.descriptor.category);
	var active=this.filterService.getActiveFilters("tipology").slice(0);
	
	this.filterService.clearActive("tipology");
	if(found && (active.length!=1 || found!=active[0])) {
		this.filterService.toggle("tipology", found);
	}
};

angular.module("itxApp").directive("filterActions", ["gridFilterService", function(filterService) {
	return {
		scope: true,
		replace: false,
		link: function(scope, $element) {
			scope.loaded=false;
			
			var remover=filterService.$loaded.push(function() {
				scope.loaded=true;
			});
			
			scope.$on("$destroy", remover);
			
			scope.clear=function(type) {
				filterService.clearActive(type);
			};
			
			scope.hasActive=function(type) {
				return filterService.hasActiveFilters(type);
			};
		}
	};
}]);
/* END CAROUSEL TIPOLOGIES */

angular.module("itxApp").directive("hideContentUntilLoaded", ["bskDeviceService", "bskVideoEnumeratorFactory", function(deviceService, videoEnumerator) {
	return {
		scope: false,
		link: function(scope, element, attrs) {
			var interval, remover;
			var $overlay = $("<div />").addClass("overlay-loader overlay-waiting").append($("<div />").append("<span></span><span></span><span></span><span></span><span></span>"));
			var $body=$("body"), $content=$("#iPageContent");
			
			function removeOverlay() {
				$overlay.remove();
			}
			
			function hideContainer() {
				$body.addClass("waiting-for-element-loading");
				$content.css("visibility", "hidden");
				
				if(!inditex.isAppPage) {
					$body.append($overlay);
				}
			}
			
			function unhideContainer() {
				$content.css("visibility", "visible");
				$body.removeClass("waiting-for-element-loading");
				if(!inditex.isAppPage) {					
					$overlay.on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', removeOverlay);
					// FALLBACK
					//setTimeout(removeOverlay,500);
				}
			}
			
			function checkState() {
				if(element.is("bsk-video")) {
					interval=setInterval(function() {
						for(var key in videoEnumerator.videos) {
							var video=videoEnumerator.videos[key];
							if(video.$element==element && (video.loaded=="canplay" || video.loaded=="loaded")) {
								unhideContainer();
								interval=clearInterval(interval);
							}
						}
					}, 50);
				} else {
					element.parent().imagesLoaded(unhideContainer);
				}
			}
			
			hideContainer();
			if(attrs.hideContentUntilLoaded) {
				if(deviceService.getActualState()==attrs.hideContentUntilLoaded) {
					checkState();
				} else {
					unhideContainer();
				}
			} else {
				checkState();
			}
			scope.$on("$destroy", function() {
				if(interval) {
					clearInterval(interval)
				}
			});
		}
	};
}]);

/* DRAGON BALL TERMS AND CONDITIONS */
inditex.onReady(function() {
	var param = inditex.iParams.dbterms || inditex.iParams.DBTerms;
	if(param == "true" || param == 1) {
		if(window.history && window.history.replaceState) {
			try {
				var splitted = location.href.split("?");
				var search = splitted[1];
				if(search) {
					search = search.split("&");
					for(var i=0; i<search.length; i++) {
						if(search[i].indexOf("dbterms=") === 0 || search[i].indexOf("DBTerms=") === 0) {
							search.splice(i,1);
							break;
						}
					}
					search = search.join("&");
					if(search) {
						search="?"+search;
					}
				}
				window.history.replaceState(history.state, document.title, splitted[0]+search);
			} catch(e) {}
		}
		window.location.href = inditex.getStaticResourceUrl("/docs/concurso_dragon_ball_en.pdf");
	}
}, true);
/* END DRAGON BALL TERMS AND CONDITIONS */

/* TRIGGER EVENT ON TRANSLATIONS LOADED */
angular.module("itxApp").config(["$provide", function($provide) {
	$provide.decorator("translationsDirective", ["$delegate", "$timeout", "bskTranslationsFactory", function($delegate, $timeout, translationsFactory) {
		var directive = $delegate[0];
		directive.compile = function($element, attrs) {
			return function(scope, $element, attrs) {
				if(!attrs.translations) {
					return;
				}

				var splitted=attrs.translations.split(":");
				var id,tag;
				if(splitted.length==1) {
					tag=splitted[0];
				} else {
					id=splitted[0];
					tag=splitted[1];
				}
				
				$timeout(function() {
					translationsFactory.translate($element, id, tag).then(function() {
						$element.trigger("translated", { element: $element, translation: attrs.translations});
					});
				}, 0, false);
			};
		}
		return $delegate;
	}]);
}]);
/* END TRIGGER EVENT ON TRANSLATIONS LOADED */


/*SWIPER FOR CARROUSELS*/

/**
 * Swiper 4.4.6
 * Most modern mobile touch slider and framework with hardware accelerated transitions
 * http://www.idangero.us/swiper/
 *
 * Copyright 2014-2018 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: December 19, 2018
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Swiper=t()}(this,function(){"use strict";var f="undefined"==typeof document?{body:{},addEventListener:function(){},removeEventListener:function(){},activeElement:{blur:function(){},nodeName:""},querySelector:function(){return null},querySelectorAll:function(){return[]},getElementById:function(){return null},createEvent:function(){return{initEvent:function(){}}},createElement:function(){return{children:[],childNodes:[],style:{},setAttribute:function(){},getElementsByTagName:function(){return[]}}},location:{hash:""}}:document,J="undefined"==typeof window?{document:f,navigator:{userAgent:""},location:{},history:{},CustomEvent:function(){return this},addEventListener:function(){},removeEventListener:function(){},getComputedStyle:function(){return{getPropertyValue:function(){return""}}},Image:function(){},Date:function(){},screen:{},setTimeout:function(){},clearTimeout:function(){}}:window,l=function(e){for(var t=0;t<e.length;t+=1)this[t]=e[t];return this.length=e.length,this};function L(e,t){var a=[],i=0;if(e&&!t&&e instanceof l)return e;if(e)if("string"==typeof e){var s,r,n=e.trim();if(0<=n.indexOf("<")&&0<=n.indexOf(">")){var o="div";for(0===n.indexOf("<li")&&(o="ul"),0===n.indexOf("<tr")&&(o="tbody"),0!==n.indexOf("<td")&&0!==n.indexOf("<th")||(o="tr"),0===n.indexOf("<tbody")&&(o="table"),0===n.indexOf("<option")&&(o="select"),(r=f.createElement(o)).innerHTML=n,i=0;i<r.childNodes.length;i+=1)a.push(r.childNodes[i])}else for(s=t||"#"!==e[0]||e.match(/[ .<>:~]/)?(t||f).querySelectorAll(e.trim()):[f.getElementById(e.trim().split("#")[1])],i=0;i<s.length;i+=1)s[i]&&a.push(s[i])}else if(e.nodeType||e===J||e===f)a.push(e);else if(0<e.length&&e[0].nodeType)for(i=0;i<e.length;i+=1)a.push(e[i]);return new l(a)}function r(e){for(var t=[],a=0;a<e.length;a+=1)-1===t.indexOf(e[a])&&t.push(e[a]);return t}L.fn=l.prototype,L.Class=l,L.Dom7=l;var t={addClass:function(e){if(void 0===e)return this;for(var t=e.split(" "),a=0;a<t.length;a+=1)for(var i=0;i<this.length;i+=1)void 0!==this[i]&&void 0!==this[i].classList&&this[i].classList.add(t[a]);return this},removeClass:function(e){for(var t=e.split(" "),a=0;a<t.length;a+=1)for(var i=0;i<this.length;i+=1)void 0!==this[i]&&void 0!==this[i].classList&&this[i].classList.remove(t[a]);return this},hasClass:function(e){return!!this[0]&&this[0].classList.contains(e)},toggleClass:function(e){for(var t=e.split(" "),a=0;a<t.length;a+=1)for(var i=0;i<this.length;i+=1)void 0!==this[i]&&void 0!==this[i].classList&&this[i].classList.toggle(t[a]);return this},attr:function(e,t){var a=arguments;if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var i=0;i<this.length;i+=1)if(2===a.length)this[i].setAttribute(e,t);else for(var s in e)this[i][s]=e[s],this[i].setAttribute(s,e[s]);return this},removeAttr:function(e){for(var t=0;t<this.length;t+=1)this[t].removeAttribute(e);return this},data:function(e,t){var a;if(void 0!==t){for(var i=0;i<this.length;i+=1)(a=this[i]).dom7ElementDataStorage||(a.dom7ElementDataStorage={}),a.dom7ElementDataStorage[e]=t;return this}if(a=this[0]){if(a.dom7ElementDataStorage&&e in a.dom7ElementDataStorage)return a.dom7ElementDataStorage[e];var s=a.getAttribute("data-"+e);return s||void 0}},transform:function(e){for(var t=0;t<this.length;t+=1){var a=this[t].style;a.webkitTransform=e,a.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var t=0;t<this.length;t+=1){var a=this[t].style;a.webkitTransitionDuration=e,a.transitionDuration=e}return this},on:function(){for(var e,t=[],a=arguments.length;a--;)t[a]=arguments[a];var i=t[0],r=t[1],n=t[2],s=t[3];function o(e){var t=e.target;if(t){var a=e.target.dom7EventData||[];if(a.indexOf(e)<0&&a.unshift(e),L(t).is(r))n.apply(t,a);else for(var i=L(t).parents(),s=0;s<i.length;s+=1)L(i[s]).is(r)&&n.apply(i[s],a)}}function l(e){var t=e&&e.target&&e.target.dom7EventData||[];t.indexOf(e)<0&&t.unshift(e),n.apply(this,t)}"function"==typeof t[1]&&(i=(e=t)[0],n=e[1],s=e[2],r=void 0),s||(s=!1);for(var d,p=i.split(" "),c=0;c<this.length;c+=1){var u=this[c];if(r)for(d=0;d<p.length;d+=1){var h=p[d];u.dom7LiveListeners||(u.dom7LiveListeners={}),u.dom7LiveListeners[h]||(u.dom7LiveListeners[h]=[]),u.dom7LiveListeners[h].push({listener:n,proxyListener:o}),u.addEventListener(h,o,s)}else for(d=0;d<p.length;d+=1){var v=p[d];u.dom7Listeners||(u.dom7Listeners={}),u.dom7Listeners[v]||(u.dom7Listeners[v]=[]),u.dom7Listeners[v].push({listener:n,proxyListener:l}),u.addEventListener(v,l,s)}}return this},off:function(){for(var e,t=[],a=arguments.length;a--;)t[a]=arguments[a];var i=t[0],s=t[1],r=t[2],n=t[3];"function"==typeof t[1]&&(i=(e=t)[0],r=e[1],n=e[2],s=void 0),n||(n=!1);for(var o=i.split(" "),l=0;l<o.length;l+=1)for(var d=o[l],p=0;p<this.length;p+=1){var c=this[p],u=void 0;if(!s&&c.dom7Listeners?u=c.dom7Listeners[d]:s&&c.dom7LiveListeners&&(u=c.dom7LiveListeners[d]),u&&u.length)for(var h=u.length-1;0<=h;h-=1){var v=u[h];r&&v.listener===r?(c.removeEventListener(d,v.proxyListener,n),u.splice(h,1)):r||(c.removeEventListener(d,v.proxyListener,n),u.splice(h,1))}}return this},trigger:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var a=e[0].split(" "),i=e[1],s=0;s<a.length;s+=1)for(var r=a[s],n=0;n<this.length;n+=1){var o=this[n],l=void 0;try{l=new J.CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0})}catch(e){(l=f.createEvent("Event")).initEvent(r,!0,!0),l.detail=i}o.dom7EventData=e.filter(function(e,t){return 0<t}),o.dispatchEvent(l),o.dom7EventData=[],delete o.dom7EventData}return this},transitionEnd:function(t){var a,i=["webkitTransitionEnd","transitionend"],s=this;function r(e){if(e.target===this)for(t.call(this,e),a=0;a<i.length;a+=1)s.off(i[a],r)}if(t)for(a=0;a<i.length;a+=1)s.on(i[a],r);return this},outerWidth:function(e){if(0<this.length){if(e){var t=this.styles();return this[0].offsetWidth+parseFloat(t.getPropertyValue("margin-right"))+parseFloat(t.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null},outerHeight:function(e){if(0<this.length){if(e){var t=this.styles();return this[0].offsetHeight+parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null},offset:function(){if(0<this.length){var e=this[0],t=e.getBoundingClientRect(),a=f.body,i=e.clientTop||a.clientTop||0,s=e.clientLeft||a.clientLeft||0,r=e===J?J.scrollY:e.scrollTop,n=e===J?J.scrollX:e.scrollLeft;return{top:t.top+r-i,left:t.left+n-s}}return null},css:function(e,t){var a;if(1===arguments.length){if("string"!=typeof e){for(a=0;a<this.length;a+=1)for(var i in e)this[a].style[i]=e[i];return this}if(this[0])return J.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(a=0;a<this.length;a+=1)this[a].style[e]=t;return this}return this},each:function(e){if(!e)return this;for(var t=0;t<this.length;t+=1)if(!1===e.call(this[t],t,this[t]))return this;return this},html:function(e){if(void 0===e)return this[0]?this[0].innerHTML:void 0;for(var t=0;t<this.length;t+=1)this[t].innerHTML=e;return this},text:function(e){if(void 0===e)return this[0]?this[0].textContent.trim():null;for(var t=0;t<this.length;t+=1)this[t].textContent=e;return this},is:function(e){var t,a,i=this[0];if(!i||void 0===e)return!1;if("string"==typeof e){if(i.matches)return i.matches(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);for(t=L(e),a=0;a<t.length;a+=1)if(t[a]===i)return!0;return!1}if(e===f)return i===f;if(e===J)return i===J;if(e.nodeType||e instanceof l){for(t=e.nodeType?[e]:e,a=0;a<t.length;a+=1)if(t[a]===i)return!0;return!1}return!1},index:function(){var e,t=this[0];if(t){for(e=0;null!==(t=t.previousSibling);)1===t.nodeType&&(e+=1);return e}},eq:function(e){if(void 0===e)return this;var t,a=this.length;return new l(a-1<e?[]:e<0?(t=a+e)<0?[]:[this[t]]:[this[e]])},append:function(){for(var e,t=[],a=arguments.length;a--;)t[a]=arguments[a];for(var i=0;i<t.length;i+=1){e=t[i];for(var s=0;s<this.length;s+=1)if("string"==typeof e){var r=f.createElement("div");for(r.innerHTML=e;r.firstChild;)this[s].appendChild(r.firstChild)}else if(e instanceof l)for(var n=0;n<e.length;n+=1)this[s].appendChild(e[n]);else this[s].appendChild(e)}return this},prepend:function(e){var t,a;for(t=0;t<this.length;t+=1)if("string"==typeof e){var i=f.createElement("div");for(i.innerHTML=e,a=i.childNodes.length-1;0<=a;a-=1)this[t].insertBefore(i.childNodes[a],this[t].childNodes[0])}else if(e instanceof l)for(a=0;a<e.length;a+=1)this[t].insertBefore(e[a],this[t].childNodes[0]);else this[t].insertBefore(e,this[t].childNodes[0]);return this},next:function(e){return 0<this.length?e?this[0].nextElementSibling&&L(this[0].nextElementSibling).is(e)?new l([this[0].nextElementSibling]):new l([]):this[0].nextElementSibling?new l([this[0].nextElementSibling]):new l([]):new l([])},nextAll:function(e){var t=[],a=this[0];if(!a)return new l([]);for(;a.nextElementSibling;){var i=a.nextElementSibling;e?L(i).is(e)&&t.push(i):t.push(i),a=i}return new l(t)},prev:function(e){if(0<this.length){var t=this[0];return e?t.previousElementSibling&&L(t.previousElementSibling).is(e)?new l([t.previousElementSibling]):new l([]):t.previousElementSibling?new l([t.previousElementSibling]):new l([])}return new l([])},prevAll:function(e){var t=[],a=this[0];if(!a)return new l([]);for(;a.previousElementSibling;){var i=a.previousElementSibling;e?L(i).is(e)&&t.push(i):t.push(i),a=i}return new l(t)},parent:function(e){for(var t=[],a=0;a<this.length;a+=1)null!==this[a].parentNode&&(e?L(this[a].parentNode).is(e)&&t.push(this[a].parentNode):t.push(this[a].parentNode));return L(r(t))},parents:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].parentNode;i;)e?L(i).is(e)&&t.push(i):t.push(i),i=i.parentNode;return L(r(t))},closest:function(e){var t=this;return void 0===e?new l([]):(t.is(e)||(t=t.parents(e).eq(0)),t)},find:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].querySelectorAll(e),s=0;s<i.length;s+=1)t.push(i[s]);return new l(t)},children:function(e){for(var t=[],a=0;a<this.length;a+=1)for(var i=this[a].childNodes,s=0;s<i.length;s+=1)e?1===i[s].nodeType&&L(i[s]).is(e)&&t.push(i[s]):1===i[s].nodeType&&t.push(i[s]);return new l(r(t))},remove:function(){for(var e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var a,i;for(a=0;a<e.length;a+=1){var s=L(e[a]);for(i=0;i<s.length;i+=1)this[this.length]=s[i],this.length+=1}return this},styles:function(){return this[0]?J.getComputedStyle(this[0],null):{}}};Object.keys(t).forEach(function(e){L.fn[e]=t[e]});var e,a,i,ee={deleteProps:function(e){var t=e;Object.keys(t).forEach(function(e){try{t[e]=null}catch(e){}try{delete t[e]}catch(e){}})},nextTick:function(e,t){return void 0===t&&(t=0),setTimeout(e,t)},now:function(){return Date.now()},getTranslate:function(e,t){var a,i,s;void 0===t&&(t="x");var r=J.getComputedStyle(e,null);return J.WebKitCSSMatrix?(6<(i=r.transform||r.webkitTransform).split(",").length&&(i=i.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),s=new J.WebKitCSSMatrix("none"===i?"":i)):a=(s=r.MozTransform||r.OTransform||r.MsTransform||r.msTransform||r.transform||r.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,")).toString().split(","),"x"===t&&(i=J.WebKitCSSMatrix?s.m41:16===a.length?parseFloat(a[12]):parseFloat(a[4])),"y"===t&&(i=J.WebKitCSSMatrix?s.m42:16===a.length?parseFloat(a[13]):parseFloat(a[5])),i||0},parseUrlQuery:function(e){var t,a,i,s,r={},n=e||J.location.href;if("string"==typeof n&&n.length)for(s=(a=(n=-1<n.indexOf("?")?n.replace(/\S*\?/,""):"").split("&").filter(function(e){return""!==e})).length,t=0;t<s;t+=1)i=a[t].replace(/#\S+/g,"").split("="),r[decodeURIComponent(i[0])]=void 0===i[1]?void 0:decodeURIComponent(i[1])||"";return r},isObject:function(e){return"object"==typeof e&&null!==e&&e.constructor&&e.constructor===Object},extend:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var a=Object(e[0]),i=1;i<e.length;i+=1){var s=e[i];if(null!=s)for(var r=Object.keys(Object(s)),n=0,o=r.length;n<o;n+=1){var l=r[n],d=Object.getOwnPropertyDescriptor(s,l);void 0!==d&&d.enumerable&&(ee.isObject(a[l])&&ee.isObject(s[l])?ee.extend(a[l],s[l]):!ee.isObject(a[l])&&ee.isObject(s[l])?(a[l]={},ee.extend(a[l],s[l])):a[l]=s[l])}}return a}},te=(i=f.createElement("div"),{touch:J.Modernizr&&!0===J.Modernizr.touch||!!(0<J.navigator.maxTouchPoints||"ontouchstart"in J||J.DocumentTouch&&f instanceof J.DocumentTouch),pointerEvents:!!(J.navigator.pointerEnabled||J.PointerEvent||"maxTouchPoints"in J.navigator),prefixedPointerEvents:!!J.navigator.msPointerEnabled,transition:(a=i.style,"transition"in a||"webkitTransition"in a||"MozTransition"in a),transforms3d:J.Modernizr&&!0===J.Modernizr.csstransforms3d||(e=i.style,"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e),flexbox:function(){for(var e=i.style,t="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),a=0;a<t.length;a+=1)if(t[a]in e)return!0;return!1}(),observer:"MutationObserver"in J||"WebkitMutationObserver"in J,passiveListener:function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});J.addEventListener("testPassiveListener",null,t)}catch(e){}return e}(),gestures:"ongesturestart"in J}),s=function(e){void 0===e&&(e={});var t=this;t.params=e,t.eventsListeners={},t.params&&t.params.on&&Object.keys(t.params.on).forEach(function(e){t.on(e,t.params.on[e])})},n={components:{configurable:!0}};s.prototype.on=function(e,t,a){var i=this;if("function"!=typeof t)return i;var s=a?"unshift":"push";return e.split(" ").forEach(function(e){i.eventsListeners[e]||(i.eventsListeners[e]=[]),i.eventsListeners[e][s](t)}),i},s.prototype.once=function(i,s,e){var r=this;if("function"!=typeof s)return r;return r.on(i,function e(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];s.apply(r,t),r.off(i,e)},e)},s.prototype.off=function(e,i){var s=this;return s.eventsListeners&&e.split(" ").forEach(function(a){void 0===i?s.eventsListeners[a]=[]:s.eventsListeners[a]&&s.eventsListeners[a].length&&s.eventsListeners[a].forEach(function(e,t){e===i&&s.eventsListeners[a].splice(t,1)})}),s},s.prototype.emit=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var a,i,s,r=this;return r.eventsListeners&&("string"==typeof e[0]||Array.isArray(e[0])?(a=e[0],i=e.slice(1,e.length),s=r):(a=e[0].events,i=e[0].data,s=e[0].context||r),(Array.isArray(a)?a:a.split(" ")).forEach(function(e){if(r.eventsListeners&&r.eventsListeners[e]){var t=[];r.eventsListeners[e].forEach(function(e){t.push(e)}),t.forEach(function(e){e.apply(s,i)})}})),r},s.prototype.useModulesParams=function(a){var i=this;i.modules&&Object.keys(i.modules).forEach(function(e){var t=i.modules[e];t.params&&ee.extend(a,t.params)})},s.prototype.useModules=function(i){void 0===i&&(i={});var s=this;s.modules&&Object.keys(s.modules).forEach(function(e){var a=s.modules[e],t=i[e]||{};a.instance&&Object.keys(a.instance).forEach(function(e){var t=a.instance[e];s[e]="function"==typeof t?t.bind(s):t}),a.on&&s.on&&Object.keys(a.on).forEach(function(e){s.on(e,a.on[e])}),a.create&&a.create.bind(s)(t)})},n.components.set=function(e){this.use&&this.use(e)},s.installModule=function(t){for(var e=[],a=arguments.length-1;0<a--;)e[a]=arguments[a+1];var i=this;i.prototype.modules||(i.prototype.modules={});var s=t.name||Object.keys(i.prototype.modules).length+"_"+ee.now();return(i.prototype.modules[s]=t).proto&&Object.keys(t.proto).forEach(function(e){i.prototype[e]=t.proto[e]}),t.static&&Object.keys(t.static).forEach(function(e){i[e]=t.static[e]}),t.install&&t.install.apply(i,e),i},s.use=function(e){for(var t=[],a=arguments.length-1;0<a--;)t[a]=arguments[a+1];var i=this;return Array.isArray(e)?(e.forEach(function(e){return i.installModule(e)}),i):i.installModule.apply(i,[e].concat(t))},Object.defineProperties(s,n);var o={updateSize:function(){var e,t,a=this,i=a.$el;e=void 0!==a.params.width?a.params.width:i[0].clientWidth,t=void 0!==a.params.height?a.params.height:i[0].clientHeight,0===e&&a.isHorizontal()||0===t&&a.isVertical()||(e=e-parseInt(i.css("padding-left"),10)-parseInt(i.css("padding-right"),10),t=t-parseInt(i.css("padding-top"),10)-parseInt(i.css("padding-bottom"),10),ee.extend(a,{width:e,height:t,size:a.isHorizontal()?e:t}))},updateSlides:function(){var e=this,t=e.params,a=e.$wrapperEl,i=e.size,s=e.rtlTranslate,r=e.wrongRTL,n=e.virtual&&t.virtual.enabled,o=n?e.virtual.slides.length:e.slides.length,l=a.children("."+e.params.slideClass),d=n?e.virtual.slides.length:l.length,p=[],c=[],u=[],h=t.slidesOffsetBefore;"function"==typeof h&&(h=t.slidesOffsetBefore.call(e));var v=t.slidesOffsetAfter;"function"==typeof v&&(v=t.slidesOffsetAfter.call(e));var f=e.snapGrid.length,m=e.snapGrid.length,g=t.spaceBetween,b=-h,w=0,y=0;if(void 0!==i){var x,T;"string"==typeof g&&0<=g.indexOf("%")&&(g=parseFloat(g.replace("%",""))/100*i),e.virtualSize=-g,s?l.css({marginLeft:"",marginTop:""}):l.css({marginRight:"",marginBottom:""}),1<t.slidesPerColumn&&(x=Math.floor(d/t.slidesPerColumn)===d/e.params.slidesPerColumn?d:Math.ceil(d/t.slidesPerColumn)*t.slidesPerColumn,"auto"!==t.slidesPerView&&"row"===t.slidesPerColumnFill&&(x=Math.max(x,t.slidesPerView*t.slidesPerColumn)));for(var E,S=t.slidesPerColumn,C=x/S,M=Math.floor(d/t.slidesPerColumn),k=0;k<d;k+=1){T=0;var P=l.eq(k);if(1<t.slidesPerColumn){var z=void 0,$=void 0,L=void 0;"column"===t.slidesPerColumnFill?(L=k-($=Math.floor(k/S))*S,(M<$||$===M&&L===S-1)&&S<=(L+=1)&&(L=0,$+=1),z=$+L*x/S,P.css({"-webkit-box-ordinal-group":z,"-moz-box-ordinal-group":z,"-ms-flex-order":z,"-webkit-order":z,order:z})):$=k-(L=Math.floor(k/C))*C,P.css("margin-"+(e.isHorizontal()?"top":"left"),0!==L&&t.spaceBetween&&t.spaceBetween+"px").attr("data-swiper-column",$).attr("data-swiper-row",L)}if("none"!==P.css("display")){if("auto"===t.slidesPerView){var I=J.getComputedStyle(P[0],null),D=P[0].style.transform,O=P[0].style.webkitTransform;if(D&&(P[0].style.transform="none"),O&&(P[0].style.webkitTransform="none"),t.roundLengths)T=e.isHorizontal()?P.outerWidth(!0):P.outerHeight(!0);else if(e.isHorizontal()){var A=parseFloat(I.getPropertyValue("width")),N=parseFloat(I.getPropertyValue("padding-left")),H=parseFloat(I.getPropertyValue("padding-right")),G=parseFloat(I.getPropertyValue("margin-left")),B=parseFloat(I.getPropertyValue("margin-right")),X=I.getPropertyValue("box-sizing");T=X&&"border-box"===X?A+G+B:A+N+H+G+B}else{var Y=parseFloat(I.getPropertyValue("height")),V=parseFloat(I.getPropertyValue("padding-top")),F=parseFloat(I.getPropertyValue("padding-bottom")),R=parseFloat(I.getPropertyValue("margin-top")),q=parseFloat(I.getPropertyValue("margin-bottom")),W=I.getPropertyValue("box-sizing");T=W&&"border-box"===W?Y+R+q:Y+V+F+R+q}D&&(P[0].style.transform=D),O&&(P[0].style.webkitTransform=O),t.roundLengths&&(T=Math.floor(T))}else T=(i-(t.slidesPerView-1)*g)/t.slidesPerView,t.roundLengths&&(T=Math.floor(T)),l[k]&&(e.isHorizontal()?l[k].style.width=T+"px":l[k].style.height=T+"px");l[k]&&(l[k].swiperSlideSize=T),u.push(T),t.centeredSlides?(b=b+T/2+w/2+g,0===w&&0!==k&&(b=b-i/2-g),0===k&&(b=b-i/2-g),Math.abs(b)<.001&&(b=0),t.roundLengths&&(b=Math.floor(b)),y%t.slidesPerGroup==0&&p.push(b),c.push(b)):(t.roundLengths&&(b=Math.floor(b)),y%t.slidesPerGroup==0&&p.push(b),c.push(b),b=b+T+g),e.virtualSize+=T+g,w=T,y+=1}}if(e.virtualSize=Math.max(e.virtualSize,i)+v,s&&r&&("slide"===t.effect||"coverflow"===t.effect)&&a.css({width:e.virtualSize+t.spaceBetween+"px"}),te.flexbox&&!t.setWrapperSize||(e.isHorizontal()?a.css({width:e.virtualSize+t.spaceBetween+"px"}):a.css({height:e.virtualSize+t.spaceBetween+"px"})),1<t.slidesPerColumn&&(e.virtualSize=(T+t.spaceBetween)*x,e.virtualSize=Math.ceil(e.virtualSize/t.slidesPerColumn)-t.spaceBetween,e.isHorizontal()?a.css({width:e.virtualSize+t.spaceBetween+"px"}):a.css({height:e.virtualSize+t.spaceBetween+"px"}),t.centeredSlides)){E=[];for(var j=0;j<p.length;j+=1){var U=p[j];t.roundLengths&&(U=Math.floor(U)),p[j]<e.virtualSize+p[0]&&E.push(U)}p=E}if(!t.centeredSlides){E=[];for(var K=0;K<p.length;K+=1){var _=p[K];t.roundLengths&&(_=Math.floor(_)),p[K]<=e.virtualSize-i&&E.push(_)}p=E,1<Math.floor(e.virtualSize-i)-Math.floor(p[p.length-1])&&p.push(e.virtualSize-i)}if(0===p.length&&(p=[0]),0!==t.spaceBetween&&(e.isHorizontal()?s?l.css({marginLeft:g+"px"}):l.css({marginRight:g+"px"}):l.css({marginBottom:g+"px"})),t.centerInsufficientSlides){var Z=0;if(u.forEach(function(e){Z+=e+(t.spaceBetween?t.spaceBetween:0)}),(Z-=t.spaceBetween)<i){var Q=(i-Z)/2;p.forEach(function(e,t){p[t]=e-Q}),c.forEach(function(e,t){c[t]=e+Q})}}ee.extend(e,{slides:l,snapGrid:p,slidesGrid:c,slidesSizesGrid:u}),d!==o&&e.emit("slidesLengthChange"),p.length!==f&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),c.length!==m&&e.emit("slidesGridLengthChange"),(t.watchSlidesProgress||t.watchSlidesVisibility)&&e.updateSlidesOffset()}},updateAutoHeight:function(e){var t,a=this,i=[],s=0;if("number"==typeof e?a.setTransition(e):!0===e&&a.setTransition(a.params.speed),"auto"!==a.params.slidesPerView&&1<a.params.slidesPerView)for(t=0;t<Math.ceil(a.params.slidesPerView);t+=1){var r=a.activeIndex+t;if(r>a.slides.length)break;i.push(a.slides.eq(r)[0])}else i.push(a.slides.eq(a.activeIndex)[0]);for(t=0;t<i.length;t+=1)if(void 0!==i[t]){var n=i[t].offsetHeight;s=s<n?n:s}s&&a.$wrapperEl.css("height",s+"px")},updateSlidesOffset:function(){for(var e=this.slides,t=0;t<e.length;t+=1)e[t].swiperSlideOffset=this.isHorizontal()?e[t].offsetLeft:e[t].offsetTop},updateSlidesProgress:function(e){void 0===e&&(e=this&&this.translate||0);var t=this,a=t.params,i=t.slides,s=t.rtlTranslate;if(0!==i.length){void 0===i[0].swiperSlideOffset&&t.updateSlidesOffset();var r=-e;s&&(r=e),i.removeClass(a.slideVisibleClass),t.visibleSlidesIndexes=[],t.visibleSlides=[];for(var n=0;n<i.length;n+=1){var o=i[n],l=(r+(a.centeredSlides?t.minTranslate():0)-o.swiperSlideOffset)/(o.swiperSlideSize+a.spaceBetween);if(a.watchSlidesVisibility){var d=-(r-o.swiperSlideOffset),p=d+t.slidesSizesGrid[n];(0<=d&&d<t.size||0<p&&p<=t.size||d<=0&&p>=t.size)&&(t.visibleSlides.push(o),t.visibleSlidesIndexes.push(n),i.eq(n).addClass(a.slideVisibleClass))}o.progress=s?-l:l}t.visibleSlides=L(t.visibleSlides)}},updateProgress:function(e){void 0===e&&(e=this&&this.translate||0);var t=this,a=t.params,i=t.maxTranslate()-t.minTranslate(),s=t.progress,r=t.isBeginning,n=t.isEnd,o=r,l=n;0===i?n=r=!(s=0):(r=(s=(e-t.minTranslate())/i)<=0,n=1<=s),ee.extend(t,{progress:s,isBeginning:r,isEnd:n}),(a.watchSlidesProgress||a.watchSlidesVisibility)&&t.updateSlidesProgress(e),r&&!o&&t.emit("reachBeginning toEdge"),n&&!l&&t.emit("reachEnd toEdge"),(o&&!r||l&&!n)&&t.emit("fromEdge"),t.emit("progress",s)},updateSlidesClasses:function(){var e,t=this,a=t.slides,i=t.params,s=t.$wrapperEl,r=t.activeIndex,n=t.realIndex,o=t.virtual&&i.virtual.enabled;a.removeClass(i.slideActiveClass+" "+i.slideNextClass+" "+i.slidePrevClass+" "+i.slideDuplicateActiveClass+" "+i.slideDuplicateNextClass+" "+i.slideDuplicatePrevClass),(e=o?t.$wrapperEl.find("."+i.slideClass+'[data-swiper-slide-index="'+r+'"]'):a.eq(r)).addClass(i.slideActiveClass),i.loop&&(e.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+n+'"]').addClass(i.slideDuplicateActiveClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+n+'"]').addClass(i.slideDuplicateActiveClass));var l=e.nextAll("."+i.slideClass).eq(0).addClass(i.slideNextClass);i.loop&&0===l.length&&(l=a.eq(0)).addClass(i.slideNextClass);var d=e.prevAll("."+i.slideClass).eq(0).addClass(i.slidePrevClass);i.loop&&0===d.length&&(d=a.eq(-1)).addClass(i.slidePrevClass),i.loop&&(l.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+l.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicateNextClass),d.hasClass(i.slideDuplicateClass)?s.children("."+i.slideClass+":not(."+i.slideDuplicateClass+')[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass):s.children("."+i.slideClass+"."+i.slideDuplicateClass+'[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(i.slideDuplicatePrevClass))},updateActiveIndex:function(e){var t,a=this,i=a.rtlTranslate?a.translate:-a.translate,s=a.slidesGrid,r=a.snapGrid,n=a.params,o=a.activeIndex,l=a.realIndex,d=a.snapIndex,p=e;if(void 0===p){for(var c=0;c<s.length;c+=1)void 0!==s[c+1]?i>=s[c]&&i<s[c+1]-(s[c+1]-s[c])/2?p=c:i>=s[c]&&i<s[c+1]&&(p=c+1):i>=s[c]&&(p=c);n.normalizeSlideIndex&&(p<0||void 0===p)&&(p=0)}if((t=0<=r.indexOf(i)?r.indexOf(i):Math.floor(p/n.slidesPerGroup))>=r.length&&(t=r.length-1),p!==o){var u=parseInt(a.slides.eq(p).attr("data-swiper-slide-index")||p,10);ee.extend(a,{snapIndex:t,realIndex:u,previousIndex:o,activeIndex:p}),a.emit("activeIndexChange"),a.emit("snapIndexChange"),l!==u&&a.emit("realIndexChange"),a.emit("slideChange")}else t!==d&&(a.snapIndex=t,a.emit("snapIndexChange"))},updateClickedSlide:function(e){var t=this,a=t.params,i=L(e.target).closest("."+a.slideClass)[0],s=!1;if(i)for(var r=0;r<t.slides.length;r+=1)t.slides[r]===i&&(s=!0);if(!i||!s)return t.clickedSlide=void 0,void(t.clickedIndex=void 0);t.clickedSlide=i,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt(L(i).attr("data-swiper-slide-index"),10):t.clickedIndex=L(i).index(),a.slideToClickedSlide&&void 0!==t.clickedIndex&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}};var d={getTranslate:function(e){void 0===e&&(e=this.isHorizontal()?"x":"y");var t=this.params,a=this.rtlTranslate,i=this.translate,s=this.$wrapperEl;if(t.virtualTranslate)return a?-i:i;var r=ee.getTranslate(s[0],e);return a&&(r=-r),r||0},setTranslate:function(e,t){var a=this,i=a.rtlTranslate,s=a.params,r=a.$wrapperEl,n=a.progress,o=0,l=0;a.isHorizontal()?o=i?-e:e:l=e,s.roundLengths&&(o=Math.floor(o),l=Math.floor(l)),s.virtualTranslate||(te.transforms3d?r.transform("translate3d("+o+"px, "+l+"px, 0px)"):r.transform("translate("+o+"px, "+l+"px)")),a.previousTranslate=a.translate,a.translate=a.isHorizontal()?o:l;var d=a.maxTranslate()-a.minTranslate();(0===d?0:(e-a.minTranslate())/d)!==n&&a.updateProgress(e),a.emit("setTranslate",a.translate,t)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]}};var p={setTransition:function(e,t){this.$wrapperEl.transition(e),this.emit("setTransition",e,t)},transitionStart:function(e,t){void 0===e&&(e=!0);var a=this,i=a.activeIndex,s=a.params,r=a.previousIndex;s.autoHeight&&a.updateAutoHeight();var n=t;if(n||(n=r<i?"next":i<r?"prev":"reset"),a.emit("transitionStart"),e&&i!==r){if("reset"===n)return void a.emit("slideResetTransitionStart");a.emit("slideChangeTransitionStart"),"next"===n?a.emit("slideNextTransitionStart"):a.emit("slidePrevTransitionStart")}},transitionEnd:function(e,t){void 0===e&&(e=!0);var a=this,i=a.activeIndex,s=a.previousIndex;a.animating=!1,a.setTransition(0);var r=t;if(r||(r=s<i?"next":i<s?"prev":"reset"),a.emit("transitionEnd"),e&&i!==s){if("reset"===r)return void a.emit("slideResetTransitionEnd");a.emit("slideChangeTransitionEnd"),"next"===r?a.emit("slideNextTransitionEnd"):a.emit("slidePrevTransitionEnd")}}};var c={slideTo:function(e,t,a,i){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===a&&(a=!0);var s=this,r=e;r<0&&(r=0);var n=s.params,o=s.snapGrid,l=s.slidesGrid,d=s.previousIndex,p=s.activeIndex,c=s.rtlTranslate;if(s.animating&&n.preventInteractionOnTransition)return!1;var u=Math.floor(r/n.slidesPerGroup);u>=o.length&&(u=o.length-1),(p||n.initialSlide||0)===(d||0)&&a&&s.emit("beforeSlideChangeStart");var h,v=-o[u];if(s.updateProgress(v),n.normalizeSlideIndex)for(var f=0;f<l.length;f+=1)-Math.floor(100*v)>=Math.floor(100*l[f])&&(r=f);if(s.initialized&&r!==p){if(!s.allowSlideNext&&v<s.translate&&v<s.minTranslate())return!1;if(!s.allowSlidePrev&&v>s.translate&&v>s.maxTranslate()&&(p||0)!==r)return!1}return h=p<r?"next":r<p?"prev":"reset",c&&-v===s.translate||!c&&v===s.translate?(s.updateActiveIndex(r),n.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),"slide"!==n.effect&&s.setTranslate(v),"reset"!==h&&(s.transitionStart(a,h),s.transitionEnd(a,h)),!1):(0!==t&&te.transition?(s.setTransition(t),s.setTranslate(v),s.updateActiveIndex(r),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,i),s.transitionStart(a,h),s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(e){s&&!s.destroyed&&e.target===this&&(s.$wrapperEl[0].removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.$wrapperEl[0].removeEventListener("webkitTransitionEnd",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(a,h))}),s.$wrapperEl[0].addEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.$wrapperEl[0].addEventListener("webkitTransitionEnd",s.onSlideToWrapperTransitionEnd))):(s.setTransition(0),s.setTranslate(v),s.updateActiveIndex(r),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,i),s.transitionStart(a,h),s.transitionEnd(a,h)),!0)},slideToLoop:function(e,t,a,i){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===a&&(a=!0);var s=e;return this.params.loop&&(s+=this.loopedSlides),this.slideTo(s,t,a,i)},slideNext:function(e,t,a){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var i=this,s=i.params,r=i.animating;return s.loop?!r&&(i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft,i.slideTo(i.activeIndex+s.slidesPerGroup,e,t,a)):i.slideTo(i.activeIndex+s.slidesPerGroup,e,t,a)},slidePrev:function(e,t,a){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var i=this,s=i.params,r=i.animating,n=i.snapGrid,o=i.slidesGrid,l=i.rtlTranslate;if(s.loop){if(r)return!1;i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft}function d(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}var p,c=d(l?i.translate:-i.translate),u=n.map(function(e){return d(e)}),h=(o.map(function(e){return d(e)}),n[u.indexOf(c)],n[u.indexOf(c)-1]);return void 0!==h&&(p=o.indexOf(h))<0&&(p=i.activeIndex-1),i.slideTo(p,e,t,a)},slideReset:function(e,t,a){return void 0===e&&(e=this.params.speed),void 0===t&&(t=!0),this.slideTo(this.activeIndex,e,t,a)},slideToClosest:function(e,t,a){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);var i=this,s=i.activeIndex,r=Math.floor(s/i.params.slidesPerGroup);if(r<i.snapGrid.length-1){var n=i.rtlTranslate?i.translate:-i.translate,o=i.snapGrid[r];(i.snapGrid[r+1]-o)/2<n-o&&(s=i.params.slidesPerGroup)}return i.slideTo(s,e,t,a)},slideToClickedSlide:function(){var e,t=this,a=t.params,i=t.$wrapperEl,s="auto"===a.slidesPerView?t.slidesPerViewDynamic():a.slidesPerView,r=t.clickedIndex;if(a.loop){if(t.animating)return;e=parseInt(L(t.clickedSlide).attr("data-swiper-slide-index"),10),a.centeredSlides?r<t.loopedSlides-s/2||r>t.slides.length-t.loopedSlides+s/2?(t.loopFix(),r=i.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+a.slideDuplicateClass+")").eq(0).index(),ee.nextTick(function(){t.slideTo(r)})):t.slideTo(r):r>t.slides.length-s?(t.loopFix(),r=i.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]:not(.'+a.slideDuplicateClass+")").eq(0).index(),ee.nextTick(function(){t.slideTo(r)})):t.slideTo(r)}else t.slideTo(r)}};var u={loopCreate:function(){var i=this,e=i.params,t=i.$wrapperEl;t.children("."+e.slideClass+"."+e.slideDuplicateClass).remove();var s=t.children("."+e.slideClass);if(e.loopFillGroupWithBlank){var a=e.slidesPerGroup-s.length%e.slidesPerGroup;if(a!==e.slidesPerGroup){for(var r=0;r<a;r+=1){var n=L(f.createElement("div")).addClass(e.slideClass+" "+e.slideBlankClass);t.append(n)}s=t.children("."+e.slideClass)}}"auto"!==e.slidesPerView||e.loopedSlides||(e.loopedSlides=s.length),i.loopedSlides=parseInt(e.loopedSlides||e.slidesPerView,10),i.loopedSlides+=e.loopAdditionalSlides,i.loopedSlides>s.length&&(i.loopedSlides=s.length);var o=[],l=[];s.each(function(e,t){var a=L(t);e<i.loopedSlides&&l.push(t),e<s.length&&e>=s.length-i.loopedSlides&&o.push(t),a.attr("data-swiper-slide-index",e)});for(var d=0;d<l.length;d+=1)t.append(L(l[d].cloneNode(!0)).addClass(e.slideDuplicateClass));for(var p=o.length-1;0<=p;p-=1)t.prepend(L(o[p].cloneNode(!0)).addClass(e.slideDuplicateClass))},loopFix:function(){var e,t=this,a=t.params,i=t.activeIndex,s=t.slides,r=t.loopedSlides,n=t.allowSlidePrev,o=t.allowSlideNext,l=t.snapGrid,d=t.rtlTranslate;t.allowSlidePrev=!0,t.allowSlideNext=!0;var p=-l[i]-t.getTranslate();i<r?(e=s.length-3*r+i,e+=r,t.slideTo(e,0,!1,!0)&&0!==p&&t.setTranslate((d?-t.translate:t.translate)-p)):("auto"===a.slidesPerView&&2*r<=i||i>=s.length-r)&&(e=-s.length+i+r,e+=r,t.slideTo(e,0,!1,!0)&&0!==p&&t.setTranslate((d?-t.translate:t.translate)-p));t.allowSlidePrev=n,t.allowSlideNext=o},loopDestroy:function(){var e=this.$wrapperEl,t=this.params,a=this.slides;e.children("."+t.slideClass+"."+t.slideDuplicateClass+",."+t.slideClass+"."+t.slideBlankClass).remove(),a.removeAttr("data-swiper-slide-index")}};var h={setGrabCursor:function(e){if(!(te.touch||!this.params.simulateTouch||this.params.watchOverflow&&this.isLocked)){var t=this.el;t.style.cursor="move",t.style.cursor=e?"-webkit-grabbing":"-webkit-grab",t.style.cursor=e?"-moz-grabbin":"-moz-grab",t.style.cursor=e?"grabbing":"grab"}},unsetGrabCursor:function(){te.touch||this.params.watchOverflow&&this.isLocked||(this.el.style.cursor="")}};var v={appendSlide:function(e){var t=this,a=t.$wrapperEl,i=t.params;if(i.loop&&t.loopDestroy(),"object"==typeof e&&"length"in e)for(var s=0;s<e.length;s+=1)e[s]&&a.append(e[s]);else a.append(e);i.loop&&t.loopCreate(),i.observer&&te.observer||t.update()},prependSlide:function(e){var t=this,a=t.params,i=t.$wrapperEl,s=t.activeIndex;a.loop&&t.loopDestroy();var r=s+1;if("object"==typeof e&&"length"in e){for(var n=0;n<e.length;n+=1)e[n]&&i.prepend(e[n]);r=s+e.length}else i.prepend(e);a.loop&&t.loopCreate(),a.observer&&te.observer||t.update(),t.slideTo(r,0,!1)},addSlide:function(e,t){var a=this,i=a.$wrapperEl,s=a.params,r=a.activeIndex;s.loop&&(r-=a.loopedSlides,a.loopDestroy(),a.slides=i.children("."+s.slideClass));var n=a.slides.length;if(e<=0)a.prependSlide(t);else if(n<=e)a.appendSlide(t);else{for(var o=e<r?r+1:r,l=[],d=n-1;e<=d;d-=1){var p=a.slides.eq(d);p.remove(),l.unshift(p)}if("object"==typeof t&&"length"in t){for(var c=0;c<t.length;c+=1)t[c]&&i.append(t[c]);o=e<r?r+t.length:r}else i.append(t);for(var u=0;u<l.length;u+=1)i.append(l[u]);s.loop&&a.loopCreate(),s.observer&&te.observer||a.update(),s.loop?a.slideTo(o+a.loopedSlides,0,!1):a.slideTo(o,0,!1)}},removeSlide:function(e){var t=this,a=t.params,i=t.$wrapperEl,s=t.activeIndex;a.loop&&(s-=t.loopedSlides,t.loopDestroy(),t.slides=i.children("."+a.slideClass));var r,n=s;if("object"==typeof e&&"length"in e){for(var o=0;o<e.length;o+=1)r=e[o],t.slides[r]&&t.slides.eq(r).remove(),r<n&&(n-=1);n=Math.max(n,0)}else r=e,t.slides[r]&&t.slides.eq(r).remove(),r<n&&(n-=1),n=Math.max(n,0);a.loop&&t.loopCreate(),a.observer&&te.observer||t.update(),a.loop?t.slideTo(n+t.loopedSlides,0,!1):t.slideTo(n,0,!1)},removeAllSlides:function(){for(var e=[],t=0;t<this.slides.length;t+=1)e.push(t);this.removeSlide(e)}},m=function(){var e=J.navigator.userAgent,t={ios:!1,android:!1,androidChrome:!1,desktop:!1,windows:!1,iphone:!1,ipod:!1,ipad:!1,cordova:J.cordova||J.phonegap,phonegap:J.cordova||J.phonegap},a=e.match(/(Windows Phone);?[\s\/]+([\d.]+)?/),i=e.match(/(Android);?[\s\/]+([\d.]+)?/),s=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),n=!s&&e.match(/(iPhone\sOS|iOS)\s([\d_]+)/);if(a&&(t.os="windows",t.osVersion=a[2],t.windows=!0),i&&!a&&(t.os="android",t.osVersion=i[2],t.android=!0,t.androidChrome=0<=e.toLowerCase().indexOf("chrome")),(s||n||r)&&(t.os="ios",t.ios=!0),n&&!r&&(t.osVersion=n[2].replace(/_/g,"."),t.iphone=!0),s&&(t.osVersion=s[2].replace(/_/g,"."),t.ipad=!0),r&&(t.osVersion=r[3]?r[3].replace(/_/g,"."):null,t.iphone=!0),t.ios&&t.osVersion&&0<=e.indexOf("Version/")&&"10"===t.osVersion.split(".")[0]&&(t.osVersion=e.toLowerCase().split("version/")[1].split(" ")[0]),t.desktop=!(t.os||t.android||t.webView),t.webView=(n||s||r)&&e.match(/.*AppleWebKit(?!.*Safari)/i),t.os&&"ios"===t.os){var o=t.osVersion.split("."),l=f.querySelector('meta[name="viewport"]');t.minimalUi=!t.webView&&(r||n)&&(1*o[0]==7?1<=1*o[1]:7<1*o[0])&&l&&0<=l.getAttribute("content").indexOf("minimal-ui")}return t.pixelRatio=J.devicePixelRatio||1,t}();function g(){var e=this,t=e.params,a=e.el;if(!a||0!==a.offsetWidth){t.breakpoints&&e.setBreakpoint();var i=e.allowSlideNext,s=e.allowSlidePrev,r=e.snapGrid;if(e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),t.freeMode){var n=Math.min(Math.max(e.translate,e.maxTranslate()),e.minTranslate());e.setTranslate(n),e.updateActiveIndex(),e.updateSlidesClasses(),t.autoHeight&&e.updateAutoHeight()}else e.updateSlidesClasses(),("auto"===t.slidesPerView||1<t.slidesPerView)&&e.isEnd&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0);e.allowSlidePrev=s,e.allowSlideNext=i,e.params.watchOverflow&&r!==e.snapGrid&&e.checkOverflow()}}var b={attachEvents:function(){var e=this,t=e.params,a=e.touchEvents,i=e.el,s=e.wrapperEl;e.onTouchStart=function(e){var t=this,a=t.touchEventsData,i=t.params,s=t.touches;if(!t.animating||!i.preventInteractionOnTransition){var r=e;if(r.originalEvent&&(r=r.originalEvent),a.isTouchEvent="touchstart"===r.type,(a.isTouchEvent||!("which"in r)||3!==r.which)&&!(!a.isTouchEvent&&"button"in r&&0<r.button||a.isTouched&&a.isMoved))if(i.noSwiping&&L(r.target).closest(i.noSwipingSelector?i.noSwipingSelector:"."+i.noSwipingClass)[0])t.allowClick=!0;else if(!i.swipeHandler||L(r).closest(i.swipeHandler)[0]){s.currentX="touchstart"===r.type?r.targetTouches[0].pageX:r.pageX,s.currentY="touchstart"===r.type?r.targetTouches[0].pageY:r.pageY;var n=s.currentX,o=s.currentY,l=i.edgeSwipeDetection||i.iOSEdgeSwipeDetection,d=i.edgeSwipeThreshold||i.iOSEdgeSwipeThreshold;if(!l||!(n<=d||n>=J.screen.width-d)){if(ee.extend(a,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),s.startX=n,s.startY=o,a.touchStartTime=ee.now(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,0<i.threshold&&(a.allowThresholdMove=!1),"touchstart"!==r.type){var p=!0;L(r.target).is(a.formElements)&&(p=!1),f.activeElement&&L(f.activeElement).is(a.formElements)&&f.activeElement!==r.target&&f.activeElement.blur();var c=p&&t.allowTouchMove&&i.touchStartPreventDefault;(i.touchStartForcePreventDefault||c)&&r.preventDefault()}t.emit("touchStart",r)}}}}.bind(e),e.onTouchMove=function(e){var t=this,a=t.touchEventsData,i=t.params,s=t.touches,r=t.rtlTranslate,n=e;if(n.originalEvent&&(n=n.originalEvent),a.isTouched){if(!a.isTouchEvent||"mousemove"!==n.type){var o="touchmove"===n.type?n.targetTouches[0].pageX:n.pageX,l="touchmove"===n.type?n.targetTouches[0].pageY:n.pageY;if(n.preventedByNestedSwiper)return s.startX=o,void(s.startY=l);if(!t.allowTouchMove)return t.allowClick=!1,void(a.isTouched&&(ee.extend(s,{startX:o,startY:l,currentX:o,currentY:l}),a.touchStartTime=ee.now()));if(a.isTouchEvent&&i.touchReleaseOnEdges&&!i.loop)if(t.isVertical()){if(l<s.startY&&t.translate<=t.maxTranslate()||l>s.startY&&t.translate>=t.minTranslate())return a.isTouched=!1,void(a.isMoved=!1)}else if(o<s.startX&&t.translate<=t.maxTranslate()||o>s.startX&&t.translate>=t.minTranslate())return;if(a.isTouchEvent&&f.activeElement&&n.target===f.activeElement&&L(n.target).is(a.formElements))return a.isMoved=!0,void(t.allowClick=!1);if(a.allowTouchCallbacks&&t.emit("touchMove",n),!(n.targetTouches&&1<n.targetTouches.length)){s.currentX=o,s.currentY=l;var d,p=s.currentX-s.startX,c=s.currentY-s.startY;if(!(t.params.threshold&&Math.sqrt(Math.pow(p,2)+Math.pow(c,2))<t.params.threshold))if(void 0===a.isScrolling&&(t.isHorizontal()&&s.currentY===s.startY||t.isVertical()&&s.currentX===s.startX?a.isScrolling=!1:25<=p*p+c*c&&(d=180*Math.atan2(Math.abs(c),Math.abs(p))/Math.PI,a.isScrolling=t.isHorizontal()?d>i.touchAngle:90-d>i.touchAngle)),a.isScrolling&&t.emit("touchMoveOpposite",n),void 0===a.startMoving&&(s.currentX===s.startX&&s.currentY===s.startY||(a.startMoving=!0)),a.isScrolling)a.isTouched=!1;else if(a.startMoving){t.allowClick=!1,n.preventDefault(),i.touchMoveStopPropagation&&!i.nested&&n.stopPropagation(),a.isMoved||(i.loop&&t.loopFix(),a.startTranslate=t.getTranslate(),t.setTransition(0),t.animating&&t.$wrapperEl.trigger("webkitTransitionEnd transitionend"),a.allowMomentumBounce=!1,!i.grabCursor||!0!==t.allowSlideNext&&!0!==t.allowSlidePrev||t.setGrabCursor(!0),t.emit("sliderFirstMove",n)),t.emit("sliderMove",n),a.isMoved=!0;var u=t.isHorizontal()?p:c;s.diff=u,u*=i.touchRatio,r&&(u=-u),t.swipeDirection=0<u?"prev":"next",a.currentTranslate=u+a.startTranslate;var h=!0,v=i.resistanceRatio;if(i.touchReleaseOnEdges&&(v=0),0<u&&a.currentTranslate>t.minTranslate()?(h=!1,i.resistance&&(a.currentTranslate=t.minTranslate()-1+Math.pow(-t.minTranslate()+a.startTranslate+u,v))):u<0&&a.currentTranslate<t.maxTranslate()&&(h=!1,i.resistance&&(a.currentTranslate=t.maxTranslate()+1-Math.pow(t.maxTranslate()-a.startTranslate-u,v))),h&&(n.preventedByNestedSwiper=!0),!t.allowSlideNext&&"next"===t.swipeDirection&&a.currentTranslate<a.startTranslate&&(a.currentTranslate=a.startTranslate),!t.allowSlidePrev&&"prev"===t.swipeDirection&&a.currentTranslate>a.startTranslate&&(a.currentTranslate=a.startTranslate),0<i.threshold){if(!(Math.abs(u)>i.threshold||a.allowThresholdMove))return void(a.currentTranslate=a.startTranslate);if(!a.allowThresholdMove)return a.allowThresholdMove=!0,s.startX=s.currentX,s.startY=s.currentY,a.currentTranslate=a.startTranslate,void(s.diff=t.isHorizontal()?s.currentX-s.startX:s.currentY-s.startY)}i.followFinger&&((i.freeMode||i.watchSlidesProgress||i.watchSlidesVisibility)&&(t.updateActiveIndex(),t.updateSlidesClasses()),i.freeMode&&(0===a.velocities.length&&a.velocities.push({position:s[t.isHorizontal()?"startX":"startY"],time:a.touchStartTime}),a.velocities.push({position:s[t.isHorizontal()?"currentX":"currentY"],time:ee.now()})),t.updateProgress(a.currentTranslate),t.setTranslate(a.currentTranslate))}}}}else a.startMoving&&a.isScrolling&&t.emit("touchMoveOpposite",n)}.bind(e),e.onTouchEnd=function(e){var t=this,a=t.touchEventsData,i=t.params,s=t.touches,r=t.rtlTranslate,n=t.$wrapperEl,o=t.slidesGrid,l=t.snapGrid,d=e;if(d.originalEvent&&(d=d.originalEvent),a.allowTouchCallbacks&&t.emit("touchEnd",d),a.allowTouchCallbacks=!1,!a.isTouched)return a.isMoved&&i.grabCursor&&t.setGrabCursor(!1),a.isMoved=!1,void(a.startMoving=!1);i.grabCursor&&a.isMoved&&a.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);var p,c=ee.now(),u=c-a.touchStartTime;if(t.allowClick&&(t.updateClickedSlide(d),t.emit("tap",d),u<300&&300<c-a.lastClickTime&&(a.clickTimeout&&clearTimeout(a.clickTimeout),a.clickTimeout=ee.nextTick(function(){t&&!t.destroyed&&t.emit("click",d)},300)),u<300&&c-a.lastClickTime<300&&(a.clickTimeout&&clearTimeout(a.clickTimeout),t.emit("doubleTap",d))),a.lastClickTime=ee.now(),ee.nextTick(function(){t.destroyed||(t.allowClick=!0)}),!a.isTouched||!a.isMoved||!t.swipeDirection||0===s.diff||a.currentTranslate===a.startTranslate)return a.isTouched=!1,a.isMoved=!1,void(a.startMoving=!1);if(a.isTouched=!1,a.isMoved=!1,a.startMoving=!1,p=i.followFinger?r?t.translate:-t.translate:-a.currentTranslate,i.freeMode){if(p<-t.minTranslate())return void t.slideTo(t.activeIndex);if(p>-t.maxTranslate())return void(t.slides.length<l.length?t.slideTo(l.length-1):t.slideTo(t.slides.length-1));if(i.freeModeMomentum){if(1<a.velocities.length){var h=a.velocities.pop(),v=a.velocities.pop(),f=h.position-v.position,m=h.time-v.time;t.velocity=f/m,t.velocity/=2,Math.abs(t.velocity)<i.freeModeMinimumVelocity&&(t.velocity=0),(150<m||300<ee.now()-h.time)&&(t.velocity=0)}else t.velocity=0;t.velocity*=i.freeModeMomentumVelocityRatio,a.velocities.length=0;var g=1e3*i.freeModeMomentumRatio,b=t.velocity*g,w=t.translate+b;r&&(w=-w);var y,x,T=!1,E=20*Math.abs(t.velocity)*i.freeModeMomentumBounceRatio;if(w<t.maxTranslate())i.freeModeMomentumBounce?(w+t.maxTranslate()<-E&&(w=t.maxTranslate()-E),y=t.maxTranslate(),T=!0,a.allowMomentumBounce=!0):w=t.maxTranslate(),i.loop&&i.centeredSlides&&(x=!0);else if(w>t.minTranslate())i.freeModeMomentumBounce?(w-t.minTranslate()>E&&(w=t.minTranslate()+E),y=t.minTranslate(),T=!0,a.allowMomentumBounce=!0):w=t.minTranslate(),i.loop&&i.centeredSlides&&(x=!0);else if(i.freeModeSticky){for(var S,C=0;C<l.length;C+=1)if(l[C]>-w){S=C;break}w=-(w=Math.abs(l[S]-w)<Math.abs(l[S-1]-w)||"next"===t.swipeDirection?l[S]:l[S-1])}if(x&&t.once("transitionEnd",function(){t.loopFix()}),0!==t.velocity)g=r?Math.abs((-w-t.translate)/t.velocity):Math.abs((w-t.translate)/t.velocity);else if(i.freeModeSticky)return void t.slideToClosest();i.freeModeMomentumBounce&&T?(t.updateProgress(y),t.setTransition(g),t.setTranslate(w),t.transitionStart(!0,t.swipeDirection),t.animating=!0,n.transitionEnd(function(){t&&!t.destroyed&&a.allowMomentumBounce&&(t.emit("momentumBounce"),t.setTransition(i.speed),t.setTranslate(y),n.transitionEnd(function(){t&&!t.destroyed&&t.transitionEnd()}))})):t.velocity?(t.updateProgress(w),t.setTransition(g),t.setTranslate(w),t.transitionStart(!0,t.swipeDirection),t.animating||(t.animating=!0,n.transitionEnd(function(){t&&!t.destroyed&&t.transitionEnd()}))):t.updateProgress(w),t.updateActiveIndex(),t.updateSlidesClasses()}else if(i.freeModeSticky)return void t.slideToClosest();(!i.freeModeMomentum||u>=i.longSwipesMs)&&(t.updateProgress(),t.updateActiveIndex(),t.updateSlidesClasses())}else{for(var M=0,k=t.slidesSizesGrid[0],P=0;P<o.length;P+=i.slidesPerGroup)void 0!==o[P+i.slidesPerGroup]?p>=o[P]&&p<o[P+i.slidesPerGroup]&&(k=o[(M=P)+i.slidesPerGroup]-o[P]):p>=o[P]&&(M=P,k=o[o.length-1]-o[o.length-2]);var z=(p-o[M])/k;if(u>i.longSwipesMs){if(!i.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(z>=i.longSwipesRatio?t.slideTo(M+i.slidesPerGroup):t.slideTo(M)),"prev"===t.swipeDirection&&(z>1-i.longSwipesRatio?t.slideTo(M+i.slidesPerGroup):t.slideTo(M))}else{if(!i.shortSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&t.slideTo(M+i.slidesPerGroup),"prev"===t.swipeDirection&&t.slideTo(M)}}}.bind(e),e.onClick=function(e){this.allowClick||(this.params.preventClicks&&e.preventDefault(),this.params.preventClicksPropagation&&this.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))}.bind(e);var r="container"===t.touchEventsTarget?i:s,n=!!t.nested;if(te.touch||!te.pointerEvents&&!te.prefixedPointerEvents){if(te.touch){var o=!("touchstart"!==a.start||!te.passiveListener||!t.passiveListeners)&&{passive:!0,capture:!1};r.addEventListener(a.start,e.onTouchStart,o),r.addEventListener(a.move,e.onTouchMove,te.passiveListener?{passive:!1,capture:n}:n),r.addEventListener(a.end,e.onTouchEnd,o)}(t.simulateTouch&&!m.ios&&!m.android||t.simulateTouch&&!te.touch&&m.ios)&&(r.addEventListener("mousedown",e.onTouchStart,!1),f.addEventListener("mousemove",e.onTouchMove,n),f.addEventListener("mouseup",e.onTouchEnd,!1))}else r.addEventListener(a.start,e.onTouchStart,!1),f.addEventListener(a.move,e.onTouchMove,n),f.addEventListener(a.end,e.onTouchEnd,!1);(t.preventClicks||t.preventClicksPropagation)&&r.addEventListener("click",e.onClick,!0),e.on(m.ios||m.android?"resize orientationchange observerUpdate":"resize observerUpdate",g,!0)},detachEvents:function(){var e=this,t=e.params,a=e.touchEvents,i=e.el,s=e.wrapperEl,r="container"===t.touchEventsTarget?i:s,n=!!t.nested;if(te.touch||!te.pointerEvents&&!te.prefixedPointerEvents){if(te.touch){var o=!("onTouchStart"!==a.start||!te.passiveListener||!t.passiveListeners)&&{passive:!0,capture:!1};r.removeEventListener(a.start,e.onTouchStart,o),r.removeEventListener(a.move,e.onTouchMove,n),r.removeEventListener(a.end,e.onTouchEnd,o)}(t.simulateTouch&&!m.ios&&!m.android||t.simulateTouch&&!te.touch&&m.ios)&&(r.removeEventListener("mousedown",e.onTouchStart,!1),f.removeEventListener("mousemove",e.onTouchMove,n),f.removeEventListener("mouseup",e.onTouchEnd,!1))}else r.removeEventListener(a.start,e.onTouchStart,!1),f.removeEventListener(a.move,e.onTouchMove,n),f.removeEventListener(a.end,e.onTouchEnd,!1);(t.preventClicks||t.preventClicksPropagation)&&r.removeEventListener("click",e.onClick,!0),e.off(m.ios||m.android?"resize orientationchange observerUpdate":"resize observerUpdate",g)}};var w,y={setBreakpoint:function(){var e=this,t=e.activeIndex,a=e.initialized,i=e.loopedSlides;void 0===i&&(i=0);var s=e.params,r=s.breakpoints;if(r&&(!r||0!==Object.keys(r).length)){var n=e.getBreakpoint(r);if(n&&e.currentBreakpoint!==n){var o=n in r?r[n]:void 0;o&&["slidesPerView","spaceBetween","slidesPerGroup"].forEach(function(e){var t=o[e];void 0!==t&&(o[e]="slidesPerView"!==e||"AUTO"!==t&&"auto"!==t?"slidesPerView"===e?parseFloat(t):parseInt(t,10):"auto")});var l=o||e.originalParams,d=s.loop&&l.slidesPerView!==s.slidesPerView;ee.extend(e.params,l),ee.extend(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),e.currentBreakpoint=n,d&&a&&(e.loopDestroy(),e.loopCreate(),e.updateSlides(),e.slideTo(t-i+e.loopedSlides,0,!1)),e.emit("breakpoint",l)}}},getBreakpoint:function(e){if(e){var t=!1,a=[];Object.keys(e).forEach(function(e){a.push(e)}),a.sort(function(e,t){return parseInt(e,10)-parseInt(t,10)});for(var i=0;i<a.length;i+=1){var s=a[i];this.params.breakpointsInverse?s<=J.innerWidth&&(t=s):s>=J.innerWidth&&!t&&(t=s)}return t||"max"}}},I={isIE:!!J.navigator.userAgent.match(/Trident/g)||!!J.navigator.userAgent.match(/MSIE/g),isEdge:!!J.navigator.userAgent.match(/Edge/g),isSafari:(w=J.navigator.userAgent.toLowerCase(),0<=w.indexOf("safari")&&w.indexOf("chrome")<0&&w.indexOf("android")<0),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(J.navigator.userAgent)};var x={init:!0,direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,preventInteractionOnTransition:!1,edgeSwipeDetection:!1,edgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsInverse:!1,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!1,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!0,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0},T={update:o,translate:d,transition:p,slide:c,loop:u,grabCursor:h,manipulation:v,events:b,breakpoints:y,checkOverflow:{checkOverflow:function(){var e=this,t=e.isLocked;e.isLocked=1===e.snapGrid.length,e.allowSlideNext=!e.isLocked,e.allowSlidePrev=!e.isLocked,t!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock"),t&&t!==e.isLocked&&(e.isEnd=!1,e.navigation.update())}},classes:{addClasses:function(){var t=this.classNames,a=this.params,e=this.rtl,i=this.$el,s=[];s.push(a.direction),a.freeMode&&s.push("free-mode"),te.flexbox||s.push("no-flexbox"),a.autoHeight&&s.push("autoheight"),e&&s.push("rtl"),1<a.slidesPerColumn&&s.push("multirow"),m.android&&s.push("android"),m.ios&&s.push("ios"),(I.isIE||I.isEdge)&&(te.pointerEvents||te.prefixedPointerEvents)&&s.push("wp8-"+a.direction),s.forEach(function(e){t.push(a.containerModifierClass+e)}),i.addClass(t.join(" "))},removeClasses:function(){var e=this.$el,t=this.classNames;e.removeClass(t.join(" "))}},images:{loadImage:function(e,t,a,i,s,r){var n;function o(){r&&r()}e.complete&&s?o():t?((n=new J.Image).onload=o,n.onerror=o,i&&(n.sizes=i),a&&(n.srcset=a),t&&(n.src=t)):o()},preloadImages:function(){var e=this;function t(){null!=e&&e&&!e.destroyed&&(void 0!==e.imagesLoaded&&(e.imagesLoaded+=1),e.imagesLoaded===e.imagesToLoad.length&&(e.params.updateOnImagesReady&&e.update(),e.emit("imagesReady")))}e.imagesToLoad=e.$el.find("img");for(var a=0;a<e.imagesToLoad.length;a+=1){var i=e.imagesToLoad[a];e.loadImage(i,i.currentSrc||i.getAttribute("src"),i.srcset||i.getAttribute("srcset"),i.sizes||i.getAttribute("sizes"),!0,t)}}}},E={},S=function(u){function h(){for(var e,t,s,a=[],i=arguments.length;i--;)a[i]=arguments[i];1===a.length&&a[0].constructor&&a[0].constructor===Object?s=a[0]:(t=(e=a)[0],s=e[1]),s||(s={}),s=ee.extend({},s),t&&!s.el&&(s.el=t),u.call(this,s),Object.keys(T).forEach(function(t){Object.keys(T[t]).forEach(function(e){h.prototype[e]||(h.prototype[e]=T[t][e])})});var r=this;void 0===r.modules&&(r.modules={}),Object.keys(r.modules).forEach(function(e){var t=r.modules[e];if(t.params){var a=Object.keys(t.params)[0],i=t.params[a];if("object"!=typeof i||null===i)return;if(!(a in s&&"enabled"in i))return;!0===s[a]&&(s[a]={enabled:!0}),"object"!=typeof s[a]||"enabled"in s[a]||(s[a].enabled=!0),s[a]||(s[a]={enabled:!1})}});var n=ee.extend({},x);r.useModulesParams(n),r.params=ee.extend({},n,E,s),r.originalParams=ee.extend({},r.params),r.passedParams=ee.extend({},s);var o=(r.$=L)(r.params.el);if(t=o[0]){if(1<o.length){var l=[];return o.each(function(e,t){var a=ee.extend({},s,{el:t});l.push(new h(a))}),l}t.swiper=r,o.data("swiper",r);var d,p,c=o.children("."+r.params.wrapperClass);return ee.extend(r,{$el:o,el:t,$wrapperEl:c,wrapperEl:c[0],classNames:[],slides:L(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:function(){return"horizontal"===r.params.direction},isVertical:function(){return"vertical"===r.params.direction},rtl:"rtl"===t.dir.toLowerCase()||"rtl"===o.css("direction"),rtlTranslate:"horizontal"===r.params.direction&&("rtl"===t.dir.toLowerCase()||"rtl"===o.css("direction")),wrongRTL:"-webkit-box"===c.css("display"),activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:r.params.allowSlideNext,allowSlidePrev:r.params.allowSlidePrev,touchEvents:(d=["touchstart","touchmove","touchend"],p=["mousedown","mousemove","mouseup"],te.pointerEvents?p=["pointerdown","pointermove","pointerup"]:te.prefixedPointerEvents&&(p=["MSPointerDown","MSPointerMove","MSPointerUp"]),r.touchEventsTouch={start:d[0],move:d[1],end:d[2]},r.touchEventsDesktop={start:p[0],move:p[1],end:p[2]},te.touch||!r.params.simulateTouch?r.touchEventsTouch:r.touchEventsDesktop),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,formElements:"input, select, option, textarea, button, video",lastClickTime:ee.now(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:r.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),r.useModules(),r.params.init&&r.init(),r}}u&&(h.__proto__=u);var e={extendedDefaults:{configurable:!0},defaults:{configurable:!0},Class:{configurable:!0},$:{configurable:!0}};return((h.prototype=Object.create(u&&u.prototype)).constructor=h).prototype.slidesPerViewDynamic=function(){var e=this,t=e.params,a=e.slides,i=e.slidesGrid,s=e.size,r=e.activeIndex,n=1;if(t.centeredSlides){for(var o,l=a[r].swiperSlideSize,d=r+1;d<a.length;d+=1)a[d]&&!o&&(n+=1,s<(l+=a[d].swiperSlideSize)&&(o=!0));for(var p=r-1;0<=p;p-=1)a[p]&&!o&&(n+=1,s<(l+=a[p].swiperSlideSize)&&(o=!0))}else for(var c=r+1;c<a.length;c+=1)i[c]-i[r]<s&&(n+=1);return n},h.prototype.update=function(){var a=this;if(a&&!a.destroyed){var e=a.snapGrid,t=a.params;t.breakpoints&&a.setBreakpoint(),a.updateSize(),a.updateSlides(),a.updateProgress(),a.updateSlidesClasses(),a.params.freeMode?(i(),a.params.autoHeight&&a.updateAutoHeight()):(("auto"===a.params.slidesPerView||1<a.params.slidesPerView)&&a.isEnd&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0))||i(),t.watchOverflow&&e!==a.snapGrid&&a.checkOverflow(),a.emit("update")}function i(){var e=a.rtlTranslate?-1*a.translate:a.translate,t=Math.min(Math.max(e,a.maxTranslate()),a.minTranslate());a.setTranslate(t),a.updateActiveIndex(),a.updateSlidesClasses()}},h.prototype.init=function(){var e=this;e.initialized||(e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.params.loop&&e.loopCreate(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.setGrabCursor(),e.params.preloadImages&&e.preloadImages(),e.params.loop?e.slideTo(e.params.initialSlide+e.loopedSlides,0,e.params.runCallbacksOnInit):e.slideTo(e.params.initialSlide,0,e.params.runCallbacksOnInit),e.attachEvents(),e.initialized=!0,e.emit("init"))},h.prototype.destroy=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var a=this,i=a.params,s=a.$el,r=a.$wrapperEl,n=a.slides;return void 0===a.params||a.destroyed||(a.emit("beforeDestroy"),a.initialized=!1,a.detachEvents(),i.loop&&a.loopDestroy(),t&&(a.removeClasses(),s.removeAttr("style"),r.removeAttr("style"),n&&n.length&&n.removeClass([i.slideVisibleClass,i.slideActiveClass,i.slideNextClass,i.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index").removeAttr("data-swiper-column").removeAttr("data-swiper-row")),a.emit("destroy"),Object.keys(a.eventsListeners).forEach(function(e){a.off(e)}),!1!==e&&(a.$el[0].swiper=null,a.$el.data("swiper",null),ee.deleteProps(a)),a.destroyed=!0),null},h.extendDefaults=function(e){ee.extend(E,e)},e.extendedDefaults.get=function(){return E},e.defaults.get=function(){return x},e.Class.get=function(){return u},e.$.get=function(){return L},Object.defineProperties(h,e),h}(s),C={name:"device",proto:{device:m},static:{device:m}},M={name:"support",proto:{support:te},static:{support:te}},k={name:"browser",proto:{browser:I},static:{browser:I}},P={name:"resize",create:function(){var e=this;ee.extend(e,{resize:{resizeHandler:function(){e&&!e.destroyed&&e.initialized&&(e.emit("beforeResize"),e.emit("resize"))},orientationChangeHandler:function(){e&&!e.destroyed&&e.initialized&&e.emit("orientationchange")}}})},on:{init:function(){J.addEventListener("resize",this.resize.resizeHandler),J.addEventListener("orientationchange",this.resize.orientationChangeHandler)},destroy:function(){J.removeEventListener("resize",this.resize.resizeHandler),J.removeEventListener("orientationchange",this.resize.orientationChangeHandler)}}},z={func:J.MutationObserver||J.WebkitMutationObserver,attach:function(e,t){void 0===t&&(t={});var a=this,i=new z.func(function(e){if(1!==e.length){var t=function(){a.emit("observerUpdate",e[0])};J.requestAnimationFrame?J.requestAnimationFrame(t):J.setTimeout(t,0)}else a.emit("observerUpdate",e[0])});i.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),a.observer.observers.push(i)},init:function(){var e=this;if(te.observer&&e.params.observer){if(e.params.observeParents)for(var t=e.$el.parents(),a=0;a<t.length;a+=1)e.observer.attach(t[a]);e.observer.attach(e.$el[0],{childList:e.params.observeSlideChildren}),e.observer.attach(e.$wrapperEl[0],{attributes:!1})}},destroy:function(){this.observer.observers.forEach(function(e){e.disconnect()}),this.observer.observers=[]}},$={name:"observer",params:{observer:!1,observeParents:!1,observeSlideChildren:!1},create:function(){ee.extend(this,{observer:{init:z.init.bind(this),attach:z.attach.bind(this),destroy:z.destroy.bind(this),observers:[]}})},on:{init:function(){this.observer.init()},destroy:function(){this.observer.destroy()}}},D={update:function(e){var t=this,a=t.params,i=a.slidesPerView,s=a.slidesPerGroup,r=a.centeredSlides,n=t.params.virtual,o=n.addSlidesBefore,l=n.addSlidesAfter,d=t.virtual,p=d.from,c=d.to,u=d.slides,h=d.slidesGrid,v=d.renderSlide,f=d.offset;t.updateActiveIndex();var m,g,b,w=t.activeIndex||0;m=t.rtlTranslate?"right":t.isHorizontal()?"left":"top",r?(g=Math.floor(i/2)+s+o,b=Math.floor(i/2)+s+l):(g=i+(s-1)+o,b=s+l);var y=Math.max((w||0)-b,0),x=Math.min((w||0)+g,u.length-1),T=(t.slidesGrid[y]||0)-(t.slidesGrid[0]||0);function E(){t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.lazy&&t.params.lazy.enabled&&t.lazy.load()}if(ee.extend(t.virtual,{from:y,to:x,offset:T,slidesGrid:t.slidesGrid}),p===y&&c===x&&!e)return t.slidesGrid!==h&&T!==f&&t.slides.css(m,T+"px"),void t.updateProgress();if(t.params.virtual.renderExternal)return t.params.virtual.renderExternal.call(t,{offset:T,from:y,to:x,slides:function(){for(var e=[],t=y;t<=x;t+=1)e.push(u[t]);return e}()}),void E();var S=[],C=[];if(e)t.$wrapperEl.find("."+t.params.slideClass).remove();else for(var M=p;M<=c;M+=1)(M<y||x<M)&&t.$wrapperEl.find("."+t.params.slideClass+'[data-swiper-slide-index="'+M+'"]').remove();for(var k=0;k<u.length;k+=1)y<=k&&k<=x&&(void 0===c||e?C.push(k):(c<k&&C.push(k),k<p&&S.push(k)));C.forEach(function(e){t.$wrapperEl.append(v(u[e],e))}),S.sort(function(e,t){return t-e}).forEach(function(e){t.$wrapperEl.prepend(v(u[e],e))}),t.$wrapperEl.children(".swiper-slide").css(m,T+"px"),E()},renderSlide:function(e,t){var a=this,i=a.params.virtual;if(i.cache&&a.virtual.cache[t])return a.virtual.cache[t];var s=i.renderSlide?L(i.renderSlide.call(a,e,t)):L('<div class="'+a.params.slideClass+'" data-swiper-slide-index="'+t+'">'+e+"</div>");return s.attr("data-swiper-slide-index")||s.attr("data-swiper-slide-index",t),i.cache&&(a.virtual.cache[t]=s),s},appendSlide:function(e){this.virtual.slides.push(e),this.virtual.update(!0)},prependSlide:function(e){var t=this;if(t.virtual.slides.unshift(e),t.params.virtual.cache){var a=t.virtual.cache,i={};Object.keys(a).forEach(function(e){i[e+1]=a[e]}),t.virtual.cache=i}t.virtual.update(!0),t.slideNext(0)}},O={name:"virtual",params:{virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,addSlidesBefore:0,addSlidesAfter:0}},create:function(){var e=this;ee.extend(e,{virtual:{update:D.update.bind(e),appendSlide:D.appendSlide.bind(e),prependSlide:D.prependSlide.bind(e),renderSlide:D.renderSlide.bind(e),slides:e.params.virtual.slides,cache:{}}})},on:{beforeInit:function(){var e=this;if(e.params.virtual.enabled){e.classNames.push(e.params.containerModifierClass+"virtual");var t={watchSlidesProgress:!0};ee.extend(e.params,t),ee.extend(e.originalParams,t),e.params.initialSlide||e.virtual.update()}},setTranslate:function(){this.params.virtual.enabled&&this.virtual.update()}}},A={handle:function(e){var t=this,a=t.rtlTranslate,i=e;i.originalEvent&&(i=i.originalEvent);var s=i.keyCode||i.charCode;if(!t.allowSlideNext&&(t.isHorizontal()&&39===s||t.isVertical()&&40===s))return!1;if(!t.allowSlidePrev&&(t.isHorizontal()&&37===s||t.isVertical()&&38===s))return!1;if(!(i.shiftKey||i.altKey||i.ctrlKey||i.metaKey||f.activeElement&&f.activeElement.nodeName&&("input"===f.activeElement.nodeName.toLowerCase()||"textarea"===f.activeElement.nodeName.toLowerCase()))){if(t.params.keyboard.onlyInViewport&&(37===s||39===s||38===s||40===s)){var r=!1;if(0<t.$el.parents("."+t.params.slideClass).length&&0===t.$el.parents("."+t.params.slideActiveClass).length)return;var n=J.innerWidth,o=J.innerHeight,l=t.$el.offset();a&&(l.left-=t.$el[0].scrollLeft);for(var d=[[l.left,l.top],[l.left+t.width,l.top],[l.left,l.top+t.height],[l.left+t.width,l.top+t.height]],p=0;p<d.length;p+=1){var c=d[p];0<=c[0]&&c[0]<=n&&0<=c[1]&&c[1]<=o&&(r=!0)}if(!r)return}t.isHorizontal()?(37!==s&&39!==s||(i.preventDefault?i.preventDefault():i.returnValue=!1),(39===s&&!a||37===s&&a)&&t.slideNext(),(37===s&&!a||39===s&&a)&&t.slidePrev()):(38!==s&&40!==s||(i.preventDefault?i.preventDefault():i.returnValue=!1),40===s&&t.slideNext(),38===s&&t.slidePrev()),t.emit("keyPress",s)}},enable:function(){this.keyboard.enabled||(L(f).on("keydown",this.keyboard.handle),this.keyboard.enabled=!0)},disable:function(){this.keyboard.enabled&&(L(f).off("keydown",this.keyboard.handle),this.keyboard.enabled=!1)}},N={name:"keyboard",params:{keyboard:{enabled:!1,onlyInViewport:!0}},create:function(){ee.extend(this,{keyboard:{enabled:!1,enable:A.enable.bind(this),disable:A.disable.bind(this),handle:A.handle.bind(this)}})},on:{init:function(){this.params.keyboard.enabled&&this.keyboard.enable()},destroy:function(){this.keyboard.enabled&&this.keyboard.disable()}}};var H={lastScrollTime:ee.now(),event:-1<J.navigator.userAgent.indexOf("firefox")?"DOMMouseScroll":function(){var e="onwheel",t=e in f;if(!t){var a=f.createElement("div");a.setAttribute(e,"return;"),t="function"==typeof a[e]}return!t&&f.implementation&&f.implementation.hasFeature&&!0!==f.implementation.hasFeature("","")&&(t=f.implementation.hasFeature("Events.wheel","3.0")),t}()?"wheel":"mousewheel",normalize:function(e){var t=0,a=0,i=0,s=0;return"detail"in e&&(a=e.detail),"wheelDelta"in e&&(a=-e.wheelDelta/120),"wheelDeltaY"in e&&(a=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=a,a=0),i=10*t,s=10*a,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(i=e.deltaX),(i||s)&&e.deltaMode&&(1===e.deltaMode?(i*=40,s*=40):(i*=800,s*=800)),i&&!t&&(t=i<1?-1:1),s&&!a&&(a=s<1?-1:1),{spinX:t,spinY:a,pixelX:i,pixelY:s}},handleMouseEnter:function(){this.mouseEntered=!0},handleMouseLeave:function(){this.mouseEntered=!1},handle:function(e){var t=e,a=this,i=a.params.mousewheel;if(!a.mouseEntered&&!i.releaseOnEdges)return!0;t.originalEvent&&(t=t.originalEvent);var s=0,r=a.rtlTranslate?-1:1,n=H.normalize(t);if(i.forceToAxis)if(a.isHorizontal()){if(!(Math.abs(n.pixelX)>Math.abs(n.pixelY)))return!0;s=n.pixelX*r}else{if(!(Math.abs(n.pixelY)>Math.abs(n.pixelX)))return!0;s=n.pixelY}else s=Math.abs(n.pixelX)>Math.abs(n.pixelY)?-n.pixelX*r:-n.pixelY;if(0===s)return!0;if(i.invert&&(s=-s),a.params.freeMode){a.params.loop&&a.loopFix();var o=a.getTranslate()+s*i.sensitivity,l=a.isBeginning,d=a.isEnd;if(o>=a.minTranslate()&&(o=a.minTranslate()),o<=a.maxTranslate()&&(o=a.maxTranslate()),a.setTransition(0),a.setTranslate(o),a.updateProgress(),a.updateActiveIndex(),a.updateSlidesClasses(),(!l&&a.isBeginning||!d&&a.isEnd)&&a.updateSlidesClasses(),a.params.freeModeSticky&&(clearTimeout(a.mousewheel.timeout),a.mousewheel.timeout=ee.nextTick(function(){a.slideToClosest()},300)),a.emit("scroll",t),a.params.autoplay&&a.params.autoplayDisableOnInteraction&&a.autoplay.stop(),o===a.minTranslate()||o===a.maxTranslate())return!0}else{if(60<ee.now()-a.mousewheel.lastScrollTime)if(s<0)if(a.isEnd&&!a.params.loop||a.animating){if(i.releaseOnEdges)return!0}else a.slideNext(),a.emit("scroll",t);else if(a.isBeginning&&!a.params.loop||a.animating){if(i.releaseOnEdges)return!0}else a.slidePrev(),a.emit("scroll",t);a.mousewheel.lastScrollTime=(new J.Date).getTime()}return t.preventDefault?t.preventDefault():t.returnValue=!1,!1},enable:function(){var e=this;if(!H.event)return!1;if(e.mousewheel.enabled)return!1;var t=e.$el;return"container"!==e.params.mousewheel.eventsTarged&&(t=L(e.params.mousewheel.eventsTarged)),t.on("mouseenter",e.mousewheel.handleMouseEnter),t.on("mouseleave",e.mousewheel.handleMouseLeave),t.on(H.event,e.mousewheel.handle),e.mousewheel.enabled=!0},disable:function(){var e=this;if(!H.event)return!1;if(!e.mousewheel.enabled)return!1;var t=e.$el;return"container"!==e.params.mousewheel.eventsTarged&&(t=L(e.params.mousewheel.eventsTarged)),t.off(H.event,e.mousewheel.handle),!(e.mousewheel.enabled=!1)}},G={update:function(){var e=this,t=e.params.navigation;if(!e.params.loop){var a=e.navigation,i=a.$nextEl,s=a.$prevEl;s&&0<s.length&&(e.isBeginning?s.addClass(t.disabledClass):s.removeClass(t.disabledClass),s[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](t.lockClass)),i&&0<i.length&&(e.isEnd?i.addClass(t.disabledClass):i.removeClass(t.disabledClass),i[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](t.lockClass))}},onPrevClick:function(e){e.preventDefault(),this.isBeginning&&!this.params.loop||this.slidePrev()},onNextClick:function(e){e.preventDefault(),this.isEnd&&!this.params.loop||this.slideNext()},init:function(){var e,t,a=this,i=a.params.navigation;(i.nextEl||i.prevEl)&&(i.nextEl&&(e=L(i.nextEl),a.params.uniqueNavElements&&"string"==typeof i.nextEl&&1<e.length&&1===a.$el.find(i.nextEl).length&&(e=a.$el.find(i.nextEl))),i.prevEl&&(t=L(i.prevEl),a.params.uniqueNavElements&&"string"==typeof i.prevEl&&1<t.length&&1===a.$el.find(i.prevEl).length&&(t=a.$el.find(i.prevEl))),e&&0<e.length&&e.on("click",a.navigation.onNextClick),t&&0<t.length&&t.on("click",a.navigation.onPrevClick),ee.extend(a.navigation,{$nextEl:e,nextEl:e&&e[0],$prevEl:t,prevEl:t&&t[0]}))},destroy:function(){var e=this,t=e.navigation,a=t.$nextEl,i=t.$prevEl;a&&a.length&&(a.off("click",e.navigation.onNextClick),a.removeClass(e.params.navigation.disabledClass)),i&&i.length&&(i.off("click",e.navigation.onPrevClick),i.removeClass(e.params.navigation.disabledClass))}},B={update:function(){var e=this,t=e.rtl,s=e.params.pagination;if(s.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var r,a=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,i=e.pagination.$el,n=e.params.loop?Math.ceil((a-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?((r=Math.ceil((e.activeIndex-e.loopedSlides)/e.params.slidesPerGroup))>a-1-2*e.loopedSlides&&(r-=a-2*e.loopedSlides),n-1<r&&(r-=n),r<0&&"bullets"!==e.params.paginationType&&(r=n+r)):r=void 0!==e.snapIndex?e.snapIndex:e.activeIndex||0,"bullets"===s.type&&e.pagination.bullets&&0<e.pagination.bullets.length){var o,l,d,p=e.pagination.bullets;if(s.dynamicBullets&&(e.pagination.bulletSize=p.eq(0)[e.isHorizontal()?"outerWidth":"outerHeight"](!0),i.css(e.isHorizontal()?"width":"height",e.pagination.bulletSize*(s.dynamicMainBullets+4)+"px"),1<s.dynamicMainBullets&&void 0!==e.previousIndex&&(e.pagination.dynamicBulletIndex+=r-e.previousIndex,e.pagination.dynamicBulletIndex>s.dynamicMainBullets-1?e.pagination.dynamicBulletIndex=s.dynamicMainBullets-1:e.pagination.dynamicBulletIndex<0&&(e.pagination.dynamicBulletIndex=0)),o=r-e.pagination.dynamicBulletIndex,d=((l=o+(Math.min(p.length,s.dynamicMainBullets)-1))+o)/2),p.removeClass(s.bulletActiveClass+" "+s.bulletActiveClass+"-next "+s.bulletActiveClass+"-next-next "+s.bulletActiveClass+"-prev "+s.bulletActiveClass+"-prev-prev "+s.bulletActiveClass+"-main"),1<i.length)p.each(function(e,t){var a=L(t),i=a.index();i===r&&a.addClass(s.bulletActiveClass),s.dynamicBullets&&(o<=i&&i<=l&&a.addClass(s.bulletActiveClass+"-main"),i===o&&a.prev().addClass(s.bulletActiveClass+"-prev").prev().addClass(s.bulletActiveClass+"-prev-prev"),i===l&&a.next().addClass(s.bulletActiveClass+"-next").next().addClass(s.bulletActiveClass+"-next-next"))});else if(p.eq(r).addClass(s.bulletActiveClass),s.dynamicBullets){for(var c=p.eq(o),u=p.eq(l),h=o;h<=l;h+=1)p.eq(h).addClass(s.bulletActiveClass+"-main");c.prev().addClass(s.bulletActiveClass+"-prev").prev().addClass(s.bulletActiveClass+"-prev-prev"),u.next().addClass(s.bulletActiveClass+"-next").next().addClass(s.bulletActiveClass+"-next-next")}if(s.dynamicBullets){var v=Math.min(p.length,s.dynamicMainBullets+4),f=(e.pagination.bulletSize*v-e.pagination.bulletSize)/2-d*e.pagination.bulletSize,m=t?"right":"left";p.css(e.isHorizontal()?m:"top",f+"px")}}if("fraction"===s.type&&(i.find("."+s.currentClass).text(s.formatFractionCurrent(r+1)),i.find("."+s.totalClass).text(s.formatFractionTotal(n))),"progressbar"===s.type){var g;g=s.progressbarOpposite?e.isHorizontal()?"vertical":"horizontal":e.isHorizontal()?"horizontal":"vertical";var b=(r+1)/n,w=1,y=1;"horizontal"===g?w=b:y=b,i.find("."+s.progressbarFillClass).transform("translate3d(0,0,0) scaleX("+w+") scaleY("+y+")").transition(e.params.speed)}"custom"===s.type&&s.renderCustom?(i.html(s.renderCustom(e,r+1,n)),e.emit("paginationRender",e,i[0])):e.emit("paginationUpdate",e,i[0]),i[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](s.lockClass)}},render:function(){var e=this,t=e.params.pagination;if(t.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var a=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,i=e.pagination.$el,s="";if("bullets"===t.type){for(var r=e.params.loop?Math.ceil((a-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length,n=0;n<r;n+=1)t.renderBullet?s+=t.renderBullet.call(e,n,t.bulletClass):s+="<"+t.bulletElement+' class="'+t.bulletClass+'"></'+t.bulletElement+">";i.html(s),e.pagination.bullets=i.find("."+t.bulletClass)}"fraction"===t.type&&(s=t.renderFraction?t.renderFraction.call(e,t.currentClass,t.totalClass):'<span class="'+t.currentClass+'"></span> / <span class="'+t.totalClass+'"></span>',i.html(s)),"progressbar"===t.type&&(s=t.renderProgressbar?t.renderProgressbar.call(e,t.progressbarFillClass):'<span class="'+t.progressbarFillClass+'"></span>',i.html(s)),"custom"!==t.type&&e.emit("paginationRender",e.pagination.$el[0])}},init:function(){var a=this,e=a.params.pagination;if(e.el){var t=L(e.el);0!==t.length&&(a.params.uniqueNavElements&&"string"==typeof e.el&&1<t.length&&1===a.$el.find(e.el).length&&(t=a.$el.find(e.el)),"bullets"===e.type&&e.clickable&&t.addClass(e.clickableClass),t.addClass(e.modifierClass+e.type),"bullets"===e.type&&e.dynamicBullets&&(t.addClass(""+e.modifierClass+e.type+"-dynamic"),a.pagination.dynamicBulletIndex=0,e.dynamicMainBullets<1&&(e.dynamicMainBullets=1)),"progressbar"===e.type&&e.progressbarOpposite&&t.addClass(e.progressbarOppositeClass),e.clickable&&t.on("click","."+e.bulletClass,function(e){e.preventDefault();var t=L(this).index()*a.params.slidesPerGroup;a.params.loop&&(t+=a.loopedSlides),a.slideTo(t)}),ee.extend(a.pagination,{$el:t,el:t[0]}))}},destroy:function(){var e=this,t=e.params.pagination;if(t.el&&e.pagination.el&&e.pagination.$el&&0!==e.pagination.$el.length){var a=e.pagination.$el;a.removeClass(t.hiddenClass),a.removeClass(t.modifierClass+t.type),e.pagination.bullets&&e.pagination.bullets.removeClass(t.bulletActiveClass),t.clickable&&a.off("click","."+t.bulletClass)}}},X={setTranslate:function(){var e=this;if(e.params.scrollbar.el&&e.scrollbar.el){var t=e.scrollbar,a=e.rtlTranslate,i=e.progress,s=t.dragSize,r=t.trackSize,n=t.$dragEl,o=t.$el,l=e.params.scrollbar,d=s,p=(r-s)*i;a?0<(p=-p)?(d=s-p,p=0):r<-p+s&&(d=r+p):p<0?(d=s+p,p=0):r<p+s&&(d=r-p),e.isHorizontal()?(te.transforms3d?n.transform("translate3d("+p+"px, 0, 0)"):n.transform("translateX("+p+"px)"),n[0].style.width=d+"px"):(te.transforms3d?n.transform("translate3d(0px, "+p+"px, 0)"):n.transform("translateY("+p+"px)"),n[0].style.height=d+"px"),l.hide&&(clearTimeout(e.scrollbar.timeout),o[0].style.opacity=1,e.scrollbar.timeout=setTimeout(function(){o[0].style.opacity=0,o.transition(400)},1e3))}},setTransition:function(e){this.params.scrollbar.el&&this.scrollbar.el&&this.scrollbar.$dragEl.transition(e)},updateSize:function(){var e=this;if(e.params.scrollbar.el&&e.scrollbar.el){var t=e.scrollbar,a=t.$dragEl,i=t.$el;a[0].style.width="",a[0].style.height="";var s,r=e.isHorizontal()?i[0].offsetWidth:i[0].offsetHeight,n=e.size/e.virtualSize,o=n*(r/e.size);s="auto"===e.params.scrollbar.dragSize?r*n:parseInt(e.params.scrollbar.dragSize,10),e.isHorizontal()?a[0].style.width=s+"px":a[0].style.height=s+"px",i[0].style.display=1<=n?"none":"",e.params.scrollbarHide&&(i[0].style.opacity=0),ee.extend(t,{trackSize:r,divider:n,moveDivider:o,dragSize:s}),t.$el[e.params.watchOverflow&&e.isLocked?"addClass":"removeClass"](e.params.scrollbar.lockClass)}},setDragPosition:function(e){var t,a=this,i=a.scrollbar,s=a.rtlTranslate,r=i.$el,n=i.dragSize,o=i.trackSize;t=((a.isHorizontal()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY)-r.offset()[a.isHorizontal()?"left":"top"]-n/2)/(o-n),t=Math.max(Math.min(t,1),0),s&&(t=1-t);var l=a.minTranslate()+(a.maxTranslate()-a.minTranslate())*t;a.updateProgress(l),a.setTranslate(l),a.updateActiveIndex(),a.updateSlidesClasses()},onDragStart:function(e){var t=this,a=t.params.scrollbar,i=t.scrollbar,s=t.$wrapperEl,r=i.$el,n=i.$dragEl;t.scrollbar.isTouched=!0,e.preventDefault(),e.stopPropagation(),s.transition(100),n.transition(100),i.setDragPosition(e),clearTimeout(t.scrollbar.dragTimeout),r.transition(0),a.hide&&r.css("opacity",1),t.emit("scrollbarDragStart",e)},onDragMove:function(e){var t=this.scrollbar,a=this.$wrapperEl,i=t.$el,s=t.$dragEl;this.scrollbar.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,t.setDragPosition(e),a.transition(0),i.transition(0),s.transition(0),this.emit("scrollbarDragMove",e))},onDragEnd:function(e){var t=this,a=t.params.scrollbar,i=t.scrollbar.$el;t.scrollbar.isTouched&&(t.scrollbar.isTouched=!1,a.hide&&(clearTimeout(t.scrollbar.dragTimeout),t.scrollbar.dragTimeout=ee.nextTick(function(){i.css("opacity",0),i.transition(400)},1e3)),t.emit("scrollbarDragEnd",e),a.snapOnRelease&&t.slideToClosest())},enableDraggable:function(){var e=this;if(e.params.scrollbar.el){var t=e.scrollbar,a=e.touchEventsTouch,i=e.touchEventsDesktop,s=e.params,r=t.$el[0],n=!(!te.passiveListener||!s.passiveListeners)&&{passive:!1,capture:!1},o=!(!te.passiveListener||!s.passiveListeners)&&{passive:!0,capture:!1};te.touch?(r.addEventListener(a.start,e.scrollbar.onDragStart,n),r.addEventListener(a.move,e.scrollbar.onDragMove,n),r.addEventListener(a.end,e.scrollbar.onDragEnd,o)):(r.addEventListener(i.start,e.scrollbar.onDragStart,n),f.addEventListener(i.move,e.scrollbar.onDragMove,n),f.addEventListener(i.end,e.scrollbar.onDragEnd,o))}},disableDraggable:function(){var e=this;if(e.params.scrollbar.el){var t=e.scrollbar,a=e.touchEventsTouch,i=e.touchEventsDesktop,s=e.params,r=t.$el[0],n=!(!te.passiveListener||!s.passiveListeners)&&{passive:!1,capture:!1},o=!(!te.passiveListener||!s.passiveListeners)&&{passive:!0,capture:!1};te.touch?(r.removeEventListener(a.start,e.scrollbar.onDragStart,n),r.removeEventListener(a.move,e.scrollbar.onDragMove,n),r.removeEventListener(a.end,e.scrollbar.onDragEnd,o)):(r.removeEventListener(i.start,e.scrollbar.onDragStart,n),f.removeEventListener(i.move,e.scrollbar.onDragMove,n),f.removeEventListener(i.end,e.scrollbar.onDragEnd,o))}},init:function(){var e=this;if(e.params.scrollbar.el){var t=e.scrollbar,a=e.$el,i=e.params.scrollbar,s=L(i.el);e.params.uniqueNavElements&&"string"==typeof i.el&&1<s.length&&1===a.find(i.el).length&&(s=a.find(i.el));var r=s.find("."+e.params.scrollbar.dragClass);0===r.length&&(r=L('<div class="'+e.params.scrollbar.dragClass+'"></div>'),s.append(r)),ee.extend(t,{$el:s,el:s[0],$dragEl:r,dragEl:r[0]}),i.draggable&&t.enableDraggable()}},destroy:function(){this.scrollbar.disableDraggable()}},Y={setTransform:function(e,t){var a=this.rtl,i=L(e),s=a?-1:1,r=i.attr("data-swiper-parallax")||"0",n=i.attr("data-swiper-parallax-x"),o=i.attr("data-swiper-parallax-y"),l=i.attr("data-swiper-parallax-scale"),d=i.attr("data-swiper-parallax-opacity");if(n||o?(n=n||"0",o=o||"0"):this.isHorizontal()?(n=r,o="0"):(o=r,n="0"),n=0<=n.indexOf("%")?parseInt(n,10)*t*s+"%":n*t*s+"px",o=0<=o.indexOf("%")?parseInt(o,10)*t+"%":o*t+"px",null!=d){var p=d-(d-1)*(1-Math.abs(t));i[0].style.opacity=p}if(null==l)i.transform("translate3d("+n+", "+o+", 0px)");else{var c=l-(l-1)*(1-Math.abs(t));i.transform("translate3d("+n+", "+o+", 0px) scale("+c+")")}},setTranslate:function(){var i=this,e=i.$el,t=i.slides,s=i.progress,r=i.snapGrid;e.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(e,t){i.parallax.setTransform(t,s)}),t.each(function(e,t){var a=t.progress;1<i.params.slidesPerGroup&&"auto"!==i.params.slidesPerView&&(a+=Math.ceil(e/2)-s*(r.length-1)),a=Math.min(Math.max(a,-1),1),L(t).find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(e,t){i.parallax.setTransform(t,a)})})},setTransition:function(s){void 0===s&&(s=this.params.speed);this.$el.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(e,t){var a=L(t),i=parseInt(a.attr("data-swiper-parallax-duration"),10)||s;0===s&&(i=0),a.transition(i)})}},V={getDistanceBetweenTouches:function(e){if(e.targetTouches.length<2)return 1;var t=e.targetTouches[0].pageX,a=e.targetTouches[0].pageY,i=e.targetTouches[1].pageX,s=e.targetTouches[1].pageY;return Math.sqrt(Math.pow(i-t,2)+Math.pow(s-a,2))},onGestureStart:function(e){var t=this,a=t.params.zoom,i=t.zoom,s=i.gesture;if(i.fakeGestureTouched=!1,i.fakeGestureMoved=!1,!te.gestures){if("touchstart"!==e.type||"touchstart"===e.type&&e.targetTouches.length<2)return;i.fakeGestureTouched=!0,s.scaleStart=V.getDistanceBetweenTouches(e)}s.$slideEl&&s.$slideEl.length||(s.$slideEl=L(e.target).closest(".swiper-slide"),0===s.$slideEl.length&&(s.$slideEl=t.slides.eq(t.activeIndex)),s.$imageEl=s.$slideEl.find("img, svg, canvas"),s.$imageWrapEl=s.$imageEl.parent("."+a.containerClass),s.maxRatio=s.$imageWrapEl.attr("data-swiper-zoom")||a.maxRatio,0!==s.$imageWrapEl.length)?(s.$imageEl.transition(0),t.zoom.isScaling=!0):s.$imageEl=void 0},onGestureChange:function(e){var t=this.params.zoom,a=this.zoom,i=a.gesture;if(!te.gestures){if("touchmove"!==e.type||"touchmove"===e.type&&e.targetTouches.length<2)return;a.fakeGestureMoved=!0,i.scaleMove=V.getDistanceBetweenTouches(e)}i.$imageEl&&0!==i.$imageEl.length&&(a.scale=te.gestures?e.scale*a.currentScale:i.scaleMove/i.scaleStart*a.currentScale,a.scale>i.maxRatio&&(a.scale=i.maxRatio-1+Math.pow(a.scale-i.maxRatio+1,.5)),a.scale<t.minRatio&&(a.scale=t.minRatio+1-Math.pow(t.minRatio-a.scale+1,.5)),i.$imageEl.transform("translate3d(0,0,0) scale("+a.scale+")"))},onGestureEnd:function(e){var t=this.params.zoom,a=this.zoom,i=a.gesture;if(!te.gestures){if(!a.fakeGestureTouched||!a.fakeGestureMoved)return;if("touchend"!==e.type||"touchend"===e.type&&e.changedTouches.length<2&&!m.android)return;a.fakeGestureTouched=!1,a.fakeGestureMoved=!1}i.$imageEl&&0!==i.$imageEl.length&&(a.scale=Math.max(Math.min(a.scale,i.maxRatio),t.minRatio),i.$imageEl.transition(this.params.speed).transform("translate3d(0,0,0) scale("+a.scale+")"),a.currentScale=a.scale,a.isScaling=!1,1===a.scale&&(i.$slideEl=void 0))},onTouchStart:function(e){var t=this.zoom,a=t.gesture,i=t.image;a.$imageEl&&0!==a.$imageEl.length&&(i.isTouched||(m.android&&e.preventDefault(),i.isTouched=!0,i.touchesStart.x="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,i.touchesStart.y="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY))},onTouchMove:function(e){var t=this,a=t.zoom,i=a.gesture,s=a.image,r=a.velocity;if(i.$imageEl&&0!==i.$imageEl.length&&(t.allowClick=!1,s.isTouched&&i.$slideEl)){s.isMoved||(s.width=i.$imageEl[0].offsetWidth,s.height=i.$imageEl[0].offsetHeight,s.startX=ee.getTranslate(i.$imageWrapEl[0],"x")||0,s.startY=ee.getTranslate(i.$imageWrapEl[0],"y")||0,i.slideWidth=i.$slideEl[0].offsetWidth,i.slideHeight=i.$slideEl[0].offsetHeight,i.$imageWrapEl.transition(0),t.rtl&&(s.startX=-s.startX,s.startY=-s.startY));var n=s.width*a.scale,o=s.height*a.scale;if(!(n<i.slideWidth&&o<i.slideHeight)){if(s.minX=Math.min(i.slideWidth/2-n/2,0),s.maxX=-s.minX,s.minY=Math.min(i.slideHeight/2-o/2,0),s.maxY=-s.minY,s.touchesCurrent.x="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,s.touchesCurrent.y="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,!s.isMoved&&!a.isScaling){if(t.isHorizontal()&&(Math.floor(s.minX)===Math.floor(s.startX)&&s.touchesCurrent.x<s.touchesStart.x||Math.floor(s.maxX)===Math.floor(s.startX)&&s.touchesCurrent.x>s.touchesStart.x))return void(s.isTouched=!1);if(!t.isHorizontal()&&(Math.floor(s.minY)===Math.floor(s.startY)&&s.touchesCurrent.y<s.touchesStart.y||Math.floor(s.maxY)===Math.floor(s.startY)&&s.touchesCurrent.y>s.touchesStart.y))return void(s.isTouched=!1)}e.preventDefault(),e.stopPropagation(),s.isMoved=!0,s.currentX=s.touchesCurrent.x-s.touchesStart.x+s.startX,s.currentY=s.touchesCurrent.y-s.touchesStart.y+s.startY,s.currentX<s.minX&&(s.currentX=s.minX+1-Math.pow(s.minX-s.currentX+1,.8)),s.currentX>s.maxX&&(s.currentX=s.maxX-1+Math.pow(s.currentX-s.maxX+1,.8)),s.currentY<s.minY&&(s.currentY=s.minY+1-Math.pow(s.minY-s.currentY+1,.8)),s.currentY>s.maxY&&(s.currentY=s.maxY-1+Math.pow(s.currentY-s.maxY+1,.8)),r.prevPositionX||(r.prevPositionX=s.touchesCurrent.x),r.prevPositionY||(r.prevPositionY=s.touchesCurrent.y),r.prevTime||(r.prevTime=Date.now()),r.x=(s.touchesCurrent.x-r.prevPositionX)/(Date.now()-r.prevTime)/2,r.y=(s.touchesCurrent.y-r.prevPositionY)/(Date.now()-r.prevTime)/2,Math.abs(s.touchesCurrent.x-r.prevPositionX)<2&&(r.x=0),Math.abs(s.touchesCurrent.y-r.prevPositionY)<2&&(r.y=0),r.prevPositionX=s.touchesCurrent.x,r.prevPositionY=s.touchesCurrent.y,r.prevTime=Date.now(),i.$imageWrapEl.transform("translate3d("+s.currentX+"px, "+s.currentY+"px,0)")}}},onTouchEnd:function(){var e=this.zoom,t=e.gesture,a=e.image,i=e.velocity;if(t.$imageEl&&0!==t.$imageEl.length){if(!a.isTouched||!a.isMoved)return a.isTouched=!1,void(a.isMoved=!1);a.isTouched=!1,a.isMoved=!1;var s=300,r=300,n=i.x*s,o=a.currentX+n,l=i.y*r,d=a.currentY+l;0!==i.x&&(s=Math.abs((o-a.currentX)/i.x)),0!==i.y&&(r=Math.abs((d-a.currentY)/i.y));var p=Math.max(s,r);a.currentX=o,a.currentY=d;var c=a.width*e.scale,u=a.height*e.scale;a.minX=Math.min(t.slideWidth/2-c/2,0),a.maxX=-a.minX,a.minY=Math.min(t.slideHeight/2-u/2,0),a.maxY=-a.minY,a.currentX=Math.max(Math.min(a.currentX,a.maxX),a.minX),a.currentY=Math.max(Math.min(a.currentY,a.maxY),a.minY),t.$imageWrapEl.transition(p).transform("translate3d("+a.currentX+"px, "+a.currentY+"px,0)")}},onTransitionEnd:function(){var e=this.zoom,t=e.gesture;t.$slideEl&&this.previousIndex!==this.activeIndex&&(t.$imageEl.transform("translate3d(0,0,0) scale(1)"),t.$imageWrapEl.transform("translate3d(0,0,0)"),e.scale=1,e.currentScale=1,t.$slideEl=void 0,t.$imageEl=void 0,t.$imageWrapEl=void 0)},toggle:function(e){var t=this.zoom;t.scale&&1!==t.scale?t.out():t.in(e)},in:function(e){var t,a,i,s,r,n,o,l,d,p,c,u,h,v,f,m,g=this,b=g.zoom,w=g.params.zoom,y=b.gesture,x=b.image;(y.$slideEl||(y.$slideEl=g.clickedSlide?L(g.clickedSlide):g.slides.eq(g.activeIndex),y.$imageEl=y.$slideEl.find("img, svg, canvas"),y.$imageWrapEl=y.$imageEl.parent("."+w.containerClass)),y.$imageEl&&0!==y.$imageEl.length)&&(y.$slideEl.addClass(""+w.zoomedSlideClass),void 0===x.touchesStart.x&&e?(t="touchend"===e.type?e.changedTouches[0].pageX:e.pageX,a="touchend"===e.type?e.changedTouches[0].pageY:e.pageY):(t=x.touchesStart.x,a=x.touchesStart.y),b.scale=y.$imageWrapEl.attr("data-swiper-zoom")||w.maxRatio,b.currentScale=y.$imageWrapEl.attr("data-swiper-zoom")||w.maxRatio,e?(f=y.$slideEl[0].offsetWidth,m=y.$slideEl[0].offsetHeight,i=y.$slideEl.offset().left+f/2-t,s=y.$slideEl.offset().top+m/2-a,o=y.$imageEl[0].offsetWidth,l=y.$imageEl[0].offsetHeight,d=o*b.scale,p=l*b.scale,h=-(c=Math.min(f/2-d/2,0)),v=-(u=Math.min(m/2-p/2,0)),(r=i*b.scale)<c&&(r=c),h<r&&(r=h),(n=s*b.scale)<u&&(n=u),v<n&&(n=v)):n=r=0,y.$imageWrapEl.transition(300).transform("translate3d("+r+"px, "+n+"px,0)"),y.$imageEl.transition(300).transform("translate3d(0,0,0) scale("+b.scale+")"))},out:function(){var e=this,t=e.zoom,a=e.params.zoom,i=t.gesture;i.$slideEl||(i.$slideEl=e.clickedSlide?L(e.clickedSlide):e.slides.eq(e.activeIndex),i.$imageEl=i.$slideEl.find("img, svg, canvas"),i.$imageWrapEl=i.$imageEl.parent("."+a.containerClass)),i.$imageEl&&0!==i.$imageEl.length&&(t.scale=1,t.currentScale=1,i.$imageWrapEl.transition(300).transform("translate3d(0,0,0)"),i.$imageEl.transition(300).transform("translate3d(0,0,0) scale(1)"),i.$slideEl.removeClass(""+a.zoomedSlideClass),i.$slideEl=void 0)},enable:function(){var e=this,t=e.zoom;if(!t.enabled){t.enabled=!0;var a=!("touchstart"!==e.touchEvents.start||!te.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1};te.gestures?(e.$wrapperEl.on("gesturestart",".swiper-slide",t.onGestureStart,a),e.$wrapperEl.on("gesturechange",".swiper-slide",t.onGestureChange,a),e.$wrapperEl.on("gestureend",".swiper-slide",t.onGestureEnd,a)):"touchstart"===e.touchEvents.start&&(e.$wrapperEl.on(e.touchEvents.start,".swiper-slide",t.onGestureStart,a),e.$wrapperEl.on(e.touchEvents.move,".swiper-slide",t.onGestureChange,a),e.$wrapperEl.on(e.touchEvents.end,".swiper-slide",t.onGestureEnd,a)),e.$wrapperEl.on(e.touchEvents.move,"."+e.params.zoom.containerClass,t.onTouchMove)}},disable:function(){var e=this,t=e.zoom;if(t.enabled){e.zoom.enabled=!1;var a=!("touchstart"!==e.touchEvents.start||!te.passiveListener||!e.params.passiveListeners)&&{passive:!0,capture:!1};te.gestures?(e.$wrapperEl.off("gesturestart",".swiper-slide",t.onGestureStart,a),e.$wrapperEl.off("gesturechange",".swiper-slide",t.onGestureChange,a),e.$wrapperEl.off("gestureend",".swiper-slide",t.onGestureEnd,a)):"touchstart"===e.touchEvents.start&&(e.$wrapperEl.off(e.touchEvents.start,".swiper-slide",t.onGestureStart,a),e.$wrapperEl.off(e.touchEvents.move,".swiper-slide",t.onGestureChange,a),e.$wrapperEl.off(e.touchEvents.end,".swiper-slide",t.onGestureEnd,a)),e.$wrapperEl.off(e.touchEvents.move,"."+e.params.zoom.containerClass,t.onTouchMove)}}},F={loadInSlide:function(e,l){void 0===l&&(l=!0);var d=this,p=d.params.lazy;if(void 0!==e&&0!==d.slides.length){var c=d.virtual&&d.params.virtual.enabled?d.$wrapperEl.children("."+d.params.slideClass+'[data-swiper-slide-index="'+e+'"]'):d.slides.eq(e),t=c.find("."+p.elementClass+":not(."+p.loadedClass+"):not(."+p.loadingClass+")");!c.hasClass(p.elementClass)||c.hasClass(p.loadedClass)||c.hasClass(p.loadingClass)||(t=t.add(c[0])),0!==t.length&&t.each(function(e,t){var i=L(t);i.addClass(p.loadingClass);var s=i.attr("data-background"),r=i.attr("data-src"),n=i.attr("data-srcset"),o=i.attr("data-sizes");d.loadImage(i[0],r||s,n,o,!1,function(){if(null!=d&&d&&(!d||d.params)&&!d.destroyed){if(s?(i.css("background-image",'url("'+s+'")'),i.removeAttr("data-background")):(n&&(i.attr("srcset",n),i.removeAttr("data-srcset")),o&&(i.attr("sizes",o),i.removeAttr("data-sizes")),r&&(i.attr("src",r),i.removeAttr("data-src"))),i.addClass(p.loadedClass).removeClass(p.loadingClass),c.find("."+p.preloaderClass).remove(),d.params.loop&&l){var e=c.attr("data-swiper-slide-index");if(c.hasClass(d.params.slideDuplicateClass)){var t=d.$wrapperEl.children('[data-swiper-slide-index="'+e+'"]:not(.'+d.params.slideDuplicateClass+")");d.lazy.loadInSlide(t.index(),!1)}else{var a=d.$wrapperEl.children("."+d.params.slideDuplicateClass+'[data-swiper-slide-index="'+e+'"]');d.lazy.loadInSlide(a.index(),!1)}}d.emit("lazyImageReady",c[0],i[0])}}),d.emit("lazyImageLoad",c[0],i[0])})}},load:function(){var i=this,t=i.$wrapperEl,a=i.params,s=i.slides,e=i.activeIndex,r=i.virtual&&a.virtual.enabled,n=a.lazy,o=a.slidesPerView;function l(e){if(r){if(t.children("."+a.slideClass+'[data-swiper-slide-index="'+e+'"]').length)return!0}else if(s[e])return!0;return!1}function d(e){return r?L(e).attr("data-swiper-slide-index"):L(e).index()}if("auto"===o&&(o=0),i.lazy.initialImageLoaded||(i.lazy.initialImageLoaded=!0),i.params.watchSlidesVisibility)t.children("."+a.slideVisibleClass).each(function(e,t){var a=r?L(t).attr("data-swiper-slide-index"):L(t).index();i.lazy.loadInSlide(a)});else if(1<o)for(var p=e;p<e+o;p+=1)l(p)&&i.lazy.loadInSlide(p);else i.lazy.loadInSlide(e);if(n.loadPrevNext)if(1<o||n.loadPrevNextAmount&&1<n.loadPrevNextAmount){for(var c=n.loadPrevNextAmount,u=o,h=Math.min(e+u+Math.max(c,u),s.length),v=Math.max(e-Math.max(u,c),0),f=e+o;f<h;f+=1)l(f)&&i.lazy.loadInSlide(f);for(var m=v;m<e;m+=1)l(m)&&i.lazy.loadInSlide(m)}else{var g=t.children("."+a.slideNextClass);0<g.length&&i.lazy.loadInSlide(d(g));var b=t.children("."+a.slidePrevClass);0<b.length&&i.lazy.loadInSlide(d(b))}}},R={LinearSpline:function(e,t){var a,i,s,r,n,o=function(e,t){for(i=-1,a=e.length;1<a-i;)e[s=a+i>>1]<=t?i=s:a=s;return a};return this.x=e,this.y=t,this.lastIndex=e.length-1,this.interpolate=function(e){return e?(n=o(this.x,e),r=n-1,(e-this.x[r])*(this.y[n]-this.y[r])/(this.x[n]-this.x[r])+this.y[r]):0},this},getInterpolateFunction:function(e){var t=this;t.controller.spline||(t.controller.spline=t.params.loop?new R.LinearSpline(t.slidesGrid,e.slidesGrid):new R.LinearSpline(t.snapGrid,e.snapGrid))},setTranslate:function(e,t){var a,i,s=this,r=s.controller.control;function n(e){var t=s.rtlTranslate?-s.translate:s.translate;"slide"===s.params.controller.by&&(s.controller.getInterpolateFunction(e),i=-s.controller.spline.interpolate(-t)),i&&"container"!==s.params.controller.by||(a=(e.maxTranslate()-e.minTranslate())/(s.maxTranslate()-s.minTranslate()),i=(t-s.minTranslate())*a+e.minTranslate()),s.params.controller.inverse&&(i=e.maxTranslate()-i),e.updateProgress(i),e.setTranslate(i,s),e.updateActiveIndex(),e.updateSlidesClasses()}if(Array.isArray(r))for(var o=0;o<r.length;o+=1)r[o]!==t&&r[o]instanceof S&&n(r[o]);else r instanceof S&&t!==r&&n(r)},setTransition:function(t,e){var a,i=this,s=i.controller.control;function r(e){e.setTransition(t,i),0!==t&&(e.transitionStart(),e.params.autoHeight&&ee.nextTick(function(){e.updateAutoHeight()}),e.$wrapperEl.transitionEnd(function(){s&&(e.params.loop&&"slide"===i.params.controller.by&&e.loopFix(),e.transitionEnd())}))}if(Array.isArray(s))for(a=0;a<s.length;a+=1)s[a]!==e&&s[a]instanceof S&&r(s[a]);else s instanceof S&&e!==s&&r(s)}},q={makeElFocusable:function(e){return e.attr("tabIndex","0"),e},addElRole:function(e,t){return e.attr("role",t),e},addElLabel:function(e,t){return e.attr("aria-label",t),e},disableEl:function(e){return e.attr("aria-disabled",!0),e},enableEl:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){var t=this,a=t.params.a11y;if(13===e.keyCode){var i=L(e.target);t.navigation&&t.navigation.$nextEl&&i.is(t.navigation.$nextEl)&&(t.isEnd&&!t.params.loop||t.slideNext(),t.isEnd?t.a11y.notify(a.lastSlideMessage):t.a11y.notify(a.nextSlideMessage)),t.navigation&&t.navigation.$prevEl&&i.is(t.navigation.$prevEl)&&(t.isBeginning&&!t.params.loop||t.slidePrev(),t.isBeginning?t.a11y.notify(a.firstSlideMessage):t.a11y.notify(a.prevSlideMessage)),t.pagination&&i.is("."+t.params.pagination.bulletClass)&&i[0].click()}},notify:function(e){var t=this.a11y.liveRegion;0!==t.length&&(t.html(""),t.html(e))},updateNavigation:function(){var e=this;if(!e.params.loop){var t=e.navigation,a=t.$nextEl,i=t.$prevEl;i&&0<i.length&&(e.isBeginning?e.a11y.disableEl(i):e.a11y.enableEl(i)),a&&0<a.length&&(e.isEnd?e.a11y.disableEl(a):e.a11y.enableEl(a))}},updatePagination:function(){var i=this,s=i.params.a11y;i.pagination&&i.params.pagination.clickable&&i.pagination.bullets&&i.pagination.bullets.length&&i.pagination.bullets.each(function(e,t){var a=L(t);i.a11y.makeElFocusable(a),i.a11y.addElRole(a,"button"),i.a11y.addElLabel(a,s.paginationBulletMessage.replace(/{{index}}/,a.index()+1))})},init:function(){var e=this;e.$el.append(e.a11y.liveRegion);var t,a,i=e.params.a11y;e.navigation&&e.navigation.$nextEl&&(t=e.navigation.$nextEl),e.navigation&&e.navigation.$prevEl&&(a=e.navigation.$prevEl),t&&(e.a11y.makeElFocusable(t),e.a11y.addElRole(t,"button"),e.a11y.addElLabel(t,i.nextSlideMessage),t.on("keydown",e.a11y.onEnterKey)),a&&(e.a11y.makeElFocusable(a),e.a11y.addElRole(a,"button"),e.a11y.addElLabel(a,i.prevSlideMessage),a.on("keydown",e.a11y.onEnterKey)),e.pagination&&e.params.pagination.clickable&&e.pagination.bullets&&e.pagination.bullets.length&&e.pagination.$el.on("keydown","."+e.params.pagination.bulletClass,e.a11y.onEnterKey)},destroy:function(){var e,t,a=this;a.a11y.liveRegion&&0<a.a11y.liveRegion.length&&a.a11y.liveRegion.remove(),a.navigation&&a.navigation.$nextEl&&(e=a.navigation.$nextEl),a.navigation&&a.navigation.$prevEl&&(t=a.navigation.$prevEl),e&&e.off("keydown",a.a11y.onEnterKey),t&&t.off("keydown",a.a11y.onEnterKey),a.pagination&&a.params.pagination.clickable&&a.pagination.bullets&&a.pagination.bullets.length&&a.pagination.$el.off("keydown","."+a.params.pagination.bulletClass,a.a11y.onEnterKey)}},W={init:function(){var e=this;if(e.params.history){if(!J.history||!J.history.pushState)return e.params.history.enabled=!1,void(e.params.hashNavigation.enabled=!0);var t=e.history;t.initialized=!0,t.paths=W.getPathValues(),(t.paths.key||t.paths.value)&&(t.scrollToSlide(0,t.paths.value,e.params.runCallbacksOnInit),e.params.history.replaceState||J.addEventListener("popstate",e.history.setHistoryPopState))}},destroy:function(){this.params.history.replaceState||J.removeEventListener("popstate",this.history.setHistoryPopState)},setHistoryPopState:function(){this.history.paths=W.getPathValues(),this.history.scrollToSlide(this.params.speed,this.history.paths.value,!1)},getPathValues:function(){var e=J.location.pathname.slice(1).split("/").filter(function(e){return""!==e}),t=e.length;return{key:e[t-2],value:e[t-1]}},setHistory:function(e,t){if(this.history.initialized&&this.params.history.enabled){var a=this.slides.eq(t),i=W.slugify(a.attr("data-history"));J.location.pathname.includes(e)||(i=e+"/"+i);var s=J.history.state;s&&s.value===i||(this.params.history.replaceState?J.history.replaceState({value:i},null,i):J.history.pushState({value:i},null,i))}},slugify:function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(e,t,a){var i=this;if(t)for(var s=0,r=i.slides.length;s<r;s+=1){var n=i.slides.eq(s);if(W.slugify(n.attr("data-history"))===t&&!n.hasClass(i.params.slideDuplicateClass)){var o=n.index();i.slideTo(o,e,a)}}else i.slideTo(0,e,a)}},j={onHashCange:function(){var e=this,t=f.location.hash.replace("#","");if(t!==e.slides.eq(e.activeIndex).attr("data-hash")){var a=e.$wrapperEl.children("."+e.params.slideClass+'[data-hash="'+t+'"]').index();if(void 0===a)return;e.slideTo(a)}},setHash:function(){var e=this;if(e.hashNavigation.initialized&&e.params.hashNavigation.enabled)if(e.params.hashNavigation.replaceState&&J.history&&J.history.replaceState)J.history.replaceState(null,null,"#"+e.slides.eq(e.activeIndex).attr("data-hash")||"");else{var t=e.slides.eq(e.activeIndex),a=t.attr("data-hash")||t.attr("data-history");f.location.hash=a||""}},init:function(){var e=this;if(!(!e.params.hashNavigation.enabled||e.params.history&&e.params.history.enabled)){e.hashNavigation.initialized=!0;var t=f.location.hash.replace("#","");if(t)for(var a=0,i=e.slides.length;a<i;a+=1){var s=e.slides.eq(a);if((s.attr("data-hash")||s.attr("data-history"))===t&&!s.hasClass(e.params.slideDuplicateClass)){var r=s.index();e.slideTo(r,0,e.params.runCallbacksOnInit,!0)}}e.params.hashNavigation.watchState&&L(J).on("hashchange",e.hashNavigation.onHashCange)}},destroy:function(){this.params.hashNavigation.watchState&&L(J).off("hashchange",this.hashNavigation.onHashCange)}},U={run:function(){var e=this,t=e.slides.eq(e.activeIndex),a=e.params.autoplay.delay;t.attr("data-swiper-autoplay")&&(a=t.attr("data-swiper-autoplay")||e.params.autoplay.delay),e.autoplay.timeout=ee.nextTick(function(){e.params.autoplay.reverseDirection?e.params.loop?(e.loopFix(),e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.isBeginning?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(e.slideTo(e.slides.length-1,e.params.speed,!0,!0),e.emit("autoplay")):(e.slidePrev(e.params.speed,!0,!0),e.emit("autoplay")):e.params.loop?(e.loopFix(),e.slideNext(e.params.speed,!0,!0),e.emit("autoplay")):e.isEnd?e.params.autoplay.stopOnLastSlide?e.autoplay.stop():(e.slideTo(0,e.params.speed,!0,!0),e.emit("autoplay")):(e.slideNext(e.params.speed,!0,!0),e.emit("autoplay"))},a)},start:function(){var e=this;return void 0===e.autoplay.timeout&&(!e.autoplay.running&&(e.autoplay.running=!0,e.emit("autoplayStart"),e.autoplay.run(),!0))},stop:function(){var e=this;return!!e.autoplay.running&&(void 0!==e.autoplay.timeout&&(e.autoplay.timeout&&(clearTimeout(e.autoplay.timeout),e.autoplay.timeout=void 0),e.autoplay.running=!1,e.emit("autoplayStop"),!0))},pause:function(e){var t=this;t.autoplay.running&&(t.autoplay.paused||(t.autoplay.timeout&&clearTimeout(t.autoplay.timeout),t.autoplay.paused=!0,0!==e&&t.params.autoplay.waitForTransition?(t.$wrapperEl[0].addEventListener("transitionend",t.autoplay.onTransitionEnd),t.$wrapperEl[0].addEventListener("webkitTransitionEnd",t.autoplay.onTransitionEnd)):(t.autoplay.paused=!1,t.autoplay.run())))}},K={setTranslate:function(){for(var e=this,t=e.slides,a=0;a<t.length;a+=1){var i=e.slides.eq(a),s=-i[0].swiperSlideOffset;e.params.virtualTranslate||(s-=e.translate);var r=0;e.isHorizontal()||(r=s,s=0);var n=e.params.fadeEffect.crossFade?Math.max(1-Math.abs(i[0].progress),0):1+Math.min(Math.max(i[0].progress,-1),0);i.css({opacity:n}).transform("translate3d("+s+"px, "+r+"px, 0px)")}},setTransition:function(e){var a=this,t=a.slides,i=a.$wrapperEl;if(t.transition(e),a.params.virtualTranslate&&0!==e){var s=!1;t.transitionEnd(function(){if(!s&&a&&!a.destroyed){s=!0,a.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],t=0;t<e.length;t+=1)i.trigger(e[t])}})}}},_={setTranslate:function(){var e,t=this,a=t.$el,i=t.$wrapperEl,s=t.slides,r=t.width,n=t.height,o=t.rtlTranslate,l=t.size,d=t.params.cubeEffect,p=t.isHorizontal(),c=t.virtual&&t.params.virtual.enabled,u=0;d.shadow&&(p?(0===(e=i.find(".swiper-cube-shadow")).length&&(e=L('<div class="swiper-cube-shadow"></div>'),i.append(e)),e.css({height:r+"px"})):0===(e=a.find(".swiper-cube-shadow")).length&&(e=L('<div class="swiper-cube-shadow"></div>'),a.append(e)));for(var h=0;h<s.length;h+=1){var v=s.eq(h),f=h;c&&(f=parseInt(v.attr("data-swiper-slide-index"),10));var m=90*f,g=Math.floor(m/360);o&&(m=-m,g=Math.floor(-m/360));var b=Math.max(Math.min(v[0].progress,1),-1),w=0,y=0,x=0;f%4==0?(w=4*-g*l,x=0):(f-1)%4==0?(w=0,x=4*-g*l):(f-2)%4==0?(w=l+4*g*l,x=l):(f-3)%4==0&&(w=-l,x=3*l+4*l*g),o&&(w=-w),p||(y=w,w=0);var T="rotateX("+(p?0:-m)+"deg) rotateY("+(p?m:0)+"deg) translate3d("+w+"px, "+y+"px, "+x+"px)";if(b<=1&&-1<b&&(u=90*f+90*b,o&&(u=90*-f-90*b)),v.transform(T),d.slideShadows){var E=p?v.find(".swiper-slide-shadow-left"):v.find(".swiper-slide-shadow-top"),S=p?v.find(".swiper-slide-shadow-right"):v.find(".swiper-slide-shadow-bottom");0===E.length&&(E=L('<div class="swiper-slide-shadow-'+(p?"left":"top")+'"></div>'),v.append(E)),0===S.length&&(S=L('<div class="swiper-slide-shadow-'+(p?"right":"bottom")+'"></div>'),v.append(S)),E.length&&(E[0].style.opacity=Math.max(-b,0)),S.length&&(S[0].style.opacity=Math.max(b,0))}}if(i.css({"-webkit-transform-origin":"50% 50% -"+l/2+"px","-moz-transform-origin":"50% 50% -"+l/2+"px","-ms-transform-origin":"50% 50% -"+l/2+"px","transform-origin":"50% 50% -"+l/2+"px"}),d.shadow)if(p)e.transform("translate3d(0px, "+(r/2+d.shadowOffset)+"px, "+-r/2+"px) rotateX(90deg) rotateZ(0deg) scale("+d.shadowScale+")");else{var C=Math.abs(u)-90*Math.floor(Math.abs(u)/90),M=1.5-(Math.sin(2*C*Math.PI/360)/2+Math.cos(2*C*Math.PI/360)/2),k=d.shadowScale,P=d.shadowScale/M,z=d.shadowOffset;e.transform("scale3d("+k+", 1, "+P+") translate3d(0px, "+(n/2+z)+"px, "+-n/2/P+"px) rotateX(-90deg)")}var $=I.isSafari||I.isUiWebView?-l/2:0;i.transform("translate3d(0px,0,"+$+"px) rotateX("+(t.isHorizontal()?0:u)+"deg) rotateY("+(t.isHorizontal()?-u:0)+"deg)")},setTransition:function(e){var t=this.$el;this.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),this.params.cubeEffect.shadow&&!this.isHorizontal()&&t.find(".swiper-cube-shadow").transition(e)}},Z={setTranslate:function(){for(var e=this,t=e.slides,a=e.rtlTranslate,i=0;i<t.length;i+=1){var s=t.eq(i),r=s[0].progress;e.params.flipEffect.limitRotation&&(r=Math.max(Math.min(s[0].progress,1),-1));var n=-180*r,o=0,l=-s[0].swiperSlideOffset,d=0;if(e.isHorizontal()?a&&(n=-n):(d=l,o=-n,n=l=0),s[0].style.zIndex=-Math.abs(Math.round(r))+t.length,e.params.flipEffect.slideShadows){var p=e.isHorizontal()?s.find(".swiper-slide-shadow-left"):s.find(".swiper-slide-shadow-top"),c=e.isHorizontal()?s.find(".swiper-slide-shadow-right"):s.find(".swiper-slide-shadow-bottom");0===p.length&&(p=L('<div class="swiper-slide-shadow-'+(e.isHorizontal()?"left":"top")+'"></div>'),s.append(p)),0===c.length&&(c=L('<div class="swiper-slide-shadow-'+(e.isHorizontal()?"right":"bottom")+'"></div>'),s.append(c)),p.length&&(p[0].style.opacity=Math.max(-r,0)),c.length&&(c[0].style.opacity=Math.max(r,0))}s.transform("translate3d("+l+"px, "+d+"px, 0px) rotateX("+o+"deg) rotateY("+n+"deg)")}},setTransition:function(e){var a=this,t=a.slides,i=a.activeIndex,s=a.$wrapperEl;if(t.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),a.params.virtualTranslate&&0!==e){var r=!1;t.eq(i).transitionEnd(function(){if(!r&&a&&!a.destroyed){r=!0,a.animating=!1;for(var e=["webkitTransitionEnd","transitionend"],t=0;t<e.length;t+=1)s.trigger(e[t])}})}}},Q={setTranslate:function(){for(var e=this,t=e.width,a=e.height,i=e.slides,s=e.$wrapperEl,r=e.slidesSizesGrid,n=e.params.coverflowEffect,o=e.isHorizontal(),l=e.translate,d=o?t/2-l:a/2-l,p=o?n.rotate:-n.rotate,c=n.depth,u=0,h=i.length;u<h;u+=1){var v=i.eq(u),f=r[u],m=(d-v[0].swiperSlideOffset-f/2)/f*n.modifier,g=o?p*m:0,b=o?0:p*m,w=-c*Math.abs(m),y=o?0:n.stretch*m,x=o?n.stretch*m:0;Math.abs(x)<.001&&(x=0),Math.abs(y)<.001&&(y=0),Math.abs(w)<.001&&(w=0),Math.abs(g)<.001&&(g=0),Math.abs(b)<.001&&(b=0);var T="translate3d("+x+"px,"+y+"px,"+w+"px)  rotateX("+b+"deg) rotateY("+g+"deg)";if(v.transform(T),v[0].style.zIndex=1-Math.abs(Math.round(m)),n.slideShadows){var E=o?v.find(".swiper-slide-shadow-left"):v.find(".swiper-slide-shadow-top"),S=o?v.find(".swiper-slide-shadow-right"):v.find(".swiper-slide-shadow-bottom");0===E.length&&(E=L('<div class="swiper-slide-shadow-'+(o?"left":"top")+'"></div>'),v.append(E)),0===S.length&&(S=L('<div class="swiper-slide-shadow-'+(o?"right":"bottom")+'"></div>'),v.append(S)),E.length&&(E[0].style.opacity=0<m?m:0),S.length&&(S[0].style.opacity=0<-m?-m:0)}}(te.pointerEvents||te.prefixedPointerEvents)&&(s[0].style.perspectiveOrigin=d+"px 50%")},setTransition:function(e){this.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}},ae={init:function(){var e=this,t=e.params.thumbs,a=e.constructor;t.swiper instanceof a?(e.thumbs.swiper=t.swiper,ee.extend(e.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),ee.extend(e.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1})):ee.isObject(t.swiper)&&(e.thumbs.swiper=new a(ee.extend({},t.swiper,{watchSlidesVisibility:!0,watchSlidesProgress:!0,slideToClickedSlide:!1})),e.thumbs.swiperCreated=!0),e.thumbs.swiper.$el.addClass(e.params.thumbs.thumbsContainerClass),e.thumbs.swiper.on("tap",e.thumbs.onThumbClick)},onThumbClick:function(){var e=this,t=e.thumbs.swiper;if(t){var a=t.clickedIndex,i=t.clickedSlide;if(!(i&&L(i).hasClass(e.params.thumbs.slideThumbActiveClass)||null==a)){var s;if(s=t.params.loop?parseInt(L(t.clickedSlide).attr("data-swiper-slide-index"),10):a,e.params.loop){var r=e.activeIndex;e.slides.eq(r).hasClass(e.params.slideDuplicateClass)&&(e.loopFix(),e._clientLeft=e.$wrapperEl[0].clientLeft,r=e.activeIndex);var n=e.slides.eq(r).prevAll('[data-swiper-slide-index="'+s+'"]').eq(0).index(),o=e.slides.eq(r).nextAll('[data-swiper-slide-index="'+s+'"]').eq(0).index();s=void 0===n?o:void 0===o?n:o-r<r-n?o:n}e.slideTo(s)}}},update:function(e){var t=this,a=t.thumbs.swiper;if(a){var i="auto"===a.params.slidesPerView?a.slidesPerViewDynamic():a.params.slidesPerView;if(t.realIndex!==a.realIndex){var s,r=a.activeIndex;if(a.params.loop){a.slides.eq(r).hasClass(a.params.slideDuplicateClass)&&(a.loopFix(),a._clientLeft=a.$wrapperEl[0].clientLeft,r=a.activeIndex);var n=a.slides.eq(r).prevAll('[data-swiper-slide-index="'+t.realIndex+'"]').eq(0).index(),o=a.slides.eq(r).nextAll('[data-swiper-slide-index="'+t.realIndex+'"]').eq(0).index();s=void 0===n?o:void 0===o?n:o-r==r-n?r:o-r<r-n?o:n}else s=t.realIndex;a.visibleSlidesIndexes.indexOf(s)<0&&(a.params.centeredSlides?s=r<s?s-Math.floor(i/2)+1:s+Math.floor(i/2)-1:r<s&&(s=s-i+1),a.slideTo(s,e?0:void 0))}var l=1,d=t.params.thumbs.slideThumbActiveClass;if(1<t.params.slidesPerView&&!t.params.centeredSlides&&(l=t.params.slidesPerView),a.slides.removeClass(d),a.params.loop)for(var p=0;p<l;p+=1)a.$wrapperEl.children('[data-swiper-slide-index="'+(t.realIndex+p)+'"]').addClass(d);else for(var c=0;c<l;c+=1)a.slides.eq(t.realIndex+c).addClass(d)}}},ie=[C,M,k,P,$,O,N,{name:"mousewheel",params:{mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarged:"container"}},create:function(){var e=this;ee.extend(e,{mousewheel:{enabled:!1,enable:H.enable.bind(e),disable:H.disable.bind(e),handle:H.handle.bind(e),handleMouseEnter:H.handleMouseEnter.bind(e),handleMouseLeave:H.handleMouseLeave.bind(e),lastScrollTime:ee.now()}})},on:{init:function(){this.params.mousewheel.enabled&&this.mousewheel.enable()},destroy:function(){this.mousewheel.enabled&&this.mousewheel.disable()}}},{name:"navigation",params:{navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock"}},create:function(){var e=this;ee.extend(e,{navigation:{init:G.init.bind(e),update:G.update.bind(e),destroy:G.destroy.bind(e),onNextClick:G.onNextClick.bind(e),onPrevClick:G.onPrevClick.bind(e)}})},on:{init:function(){this.navigation.init(),this.navigation.update()},toEdge:function(){this.navigation.update()},fromEdge:function(){this.navigation.update()},destroy:function(){this.navigation.destroy()},click:function(e){var t=this.navigation,a=t.$nextEl,i=t.$prevEl;!this.params.navigation.hideOnClick||L(e.target).is(i)||L(e.target).is(a)||(a&&a.toggleClass(this.params.navigation.hiddenClass),i&&i.toggleClass(this.params.navigation.hiddenClass))}}},{name:"pagination",params:{pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:function(e){return e},formatFractionTotal:function(e){return e},bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",modifierClass:"swiper-pagination-",currentClass:"swiper-pagination-current",totalClass:"swiper-pagination-total",hiddenClass:"swiper-pagination-hidden",progressbarFillClass:"swiper-pagination-progressbar-fill",progressbarOppositeClass:"swiper-pagination-progressbar-opposite",clickableClass:"swiper-pagination-clickable",lockClass:"swiper-pagination-lock"}},create:function(){var e=this;ee.extend(e,{pagination:{init:B.init.bind(e),render:B.render.bind(e),update:B.update.bind(e),destroy:B.destroy.bind(e),dynamicBulletIndex:0}})},on:{init:function(){this.pagination.init(),this.pagination.render(),this.pagination.update()},activeIndexChange:function(){this.params.loop?this.pagination.update():void 0===this.snapIndex&&this.pagination.update()},snapIndexChange:function(){this.params.loop||this.pagination.update()},slidesLengthChange:function(){this.params.loop&&(this.pagination.render(),this.pagination.update())},snapGridLengthChange:function(){this.params.loop||(this.pagination.render(),this.pagination.update())},destroy:function(){this.pagination.destroy()},click:function(e){var t=this;t.params.pagination.el&&t.params.pagination.hideOnClick&&0<t.pagination.$el.length&&!L(e.target).hasClass(t.params.pagination.bulletClass)&&t.pagination.$el.toggleClass(t.params.pagination.hiddenClass)}}},{name:"scrollbar",params:{scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag"}},create:function(){var e=this;ee.extend(e,{scrollbar:{init:X.init.bind(e),destroy:X.destroy.bind(e),updateSize:X.updateSize.bind(e),setTranslate:X.setTranslate.bind(e),setTransition:X.setTransition.bind(e),enableDraggable:X.enableDraggable.bind(e),disableDraggable:X.disableDraggable.bind(e),setDragPosition:X.setDragPosition.bind(e),onDragStart:X.onDragStart.bind(e),onDragMove:X.onDragMove.bind(e),onDragEnd:X.onDragEnd.bind(e),isTouched:!1,timeout:null,dragTimeout:null}})},on:{init:function(){this.scrollbar.init(),this.scrollbar.updateSize(),this.scrollbar.setTranslate()},update:function(){this.scrollbar.updateSize()},resize:function(){this.scrollbar.updateSize()},observerUpdate:function(){this.scrollbar.updateSize()},setTranslate:function(){this.scrollbar.setTranslate()},setTransition:function(e){this.scrollbar.setTransition(e)},destroy:function(){this.scrollbar.destroy()}}},{name:"parallax",params:{parallax:{enabled:!1}},create:function(){ee.extend(this,{parallax:{setTransform:Y.setTransform.bind(this),setTranslate:Y.setTranslate.bind(this),setTransition:Y.setTransition.bind(this)}})},on:{beforeInit:function(){this.params.parallax.enabled&&(this.params.watchSlidesProgress=!0,this.originalParams.watchSlidesProgress=!0)},init:function(){this.params.parallax&&this.parallax.setTranslate()},setTranslate:function(){this.params.parallax&&this.parallax.setTranslate()},setTransition:function(e){this.params.parallax&&this.parallax.setTransition(e)}}},{name:"zoom",params:{zoom:{enabled:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}},create:function(){var i=this,t={enabled:!1,scale:1,currentScale:1,isScaling:!1,gesture:{$slideEl:void 0,slideWidth:void 0,slideHeight:void 0,$imageEl:void 0,$imageWrapEl:void 0,maxRatio:3},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0}};"onGestureStart onGestureChange onGestureEnd onTouchStart onTouchMove onTouchEnd onTransitionEnd toggle enable disable in out".split(" ").forEach(function(e){t[e]=V[e].bind(i)}),ee.extend(i,{zoom:t});var s=1;Object.defineProperty(i.zoom,"scale",{get:function(){return s},set:function(e){if(s!==e){var t=i.zoom.gesture.$imageEl?i.zoom.gesture.$imageEl[0]:void 0,a=i.zoom.gesture.$slideEl?i.zoom.gesture.$slideEl[0]:void 0;i.emit("zoomChange",e,t,a)}s=e}})},on:{init:function(){this.params.zoom.enabled&&this.zoom.enable()},destroy:function(){this.zoom.disable()},touchStart:function(e){this.zoom.enabled&&this.zoom.onTouchStart(e)},touchEnd:function(e){this.zoom.enabled&&this.zoom.onTouchEnd(e)},doubleTap:function(e){this.params.zoom.enabled&&this.zoom.enabled&&this.params.zoom.toggle&&this.zoom.toggle(e)},transitionEnd:function(){this.zoom.enabled&&this.params.zoom.enabled&&this.zoom.onTransitionEnd()}}},{name:"lazy",params:{lazy:{enabled:!1,loadPrevNext:!1,loadPrevNextAmount:1,loadOnTransitionStart:!1,elementClass:"swiper-lazy",loadingClass:"swiper-lazy-loading",loadedClass:"swiper-lazy-loaded",preloaderClass:"swiper-lazy-preloader"}},create:function(){ee.extend(this,{lazy:{initialImageLoaded:!1,load:F.load.bind(this),loadInSlide:F.loadInSlide.bind(this)}})},on:{beforeInit:function(){this.params.lazy.enabled&&this.params.preloadImages&&(this.params.preloadImages=!1)},init:function(){this.params.lazy.enabled&&!this.params.loop&&0===this.params.initialSlide&&this.lazy.load()},scroll:function(){this.params.freeMode&&!this.params.freeModeSticky&&this.lazy.load()},resize:function(){this.params.lazy.enabled&&this.lazy.load()},scrollbarDragMove:function(){this.params.lazy.enabled&&this.lazy.load()},transitionStart:function(){var e=this;e.params.lazy.enabled&&(e.params.lazy.loadOnTransitionStart||!e.params.lazy.loadOnTransitionStart&&!e.lazy.initialImageLoaded)&&e.lazy.load()},transitionEnd:function(){this.params.lazy.enabled&&!this.params.lazy.loadOnTransitionStart&&this.lazy.load()}}},{name:"controller",params:{controller:{control:void 0,inverse:!1,by:"slide"}},create:function(){var e=this;ee.extend(e,{controller:{control:e.params.controller.control,getInterpolateFunction:R.getInterpolateFunction.bind(e),setTranslate:R.setTranslate.bind(e),setTransition:R.setTransition.bind(e)}})},on:{update:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},resize:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},observerUpdate:function(){this.controller.control&&this.controller.spline&&(this.controller.spline=void 0,delete this.controller.spline)},setTranslate:function(e,t){this.controller.control&&this.controller.setTranslate(e,t)},setTransition:function(e,t){this.controller.control&&this.controller.setTransition(e,t)}}},{name:"a11y",params:{a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}"}},create:function(){var t=this;ee.extend(t,{a11y:{liveRegion:L('<span class="'+t.params.a11y.notificationClass+'" aria-live="assertive" aria-atomic="true"></span>')}}),Object.keys(q).forEach(function(e){t.a11y[e]=q[e].bind(t)})},on:{init:function(){this.params.a11y.enabled&&(this.a11y.init(),this.a11y.updateNavigation())},toEdge:function(){this.params.a11y.enabled&&this.a11y.updateNavigation()},fromEdge:function(){this.params.a11y.enabled&&this.a11y.updateNavigation()},paginationUpdate:function(){this.params.a11y.enabled&&this.a11y.updatePagination()},destroy:function(){this.params.a11y.enabled&&this.a11y.destroy()}}},{name:"history",params:{history:{enabled:!1,replaceState:!1,key:"slides"}},create:function(){var e=this;ee.extend(e,{history:{init:W.init.bind(e),setHistory:W.setHistory.bind(e),setHistoryPopState:W.setHistoryPopState.bind(e),scrollToSlide:W.scrollToSlide.bind(e),destroy:W.destroy.bind(e)}})},on:{init:function(){this.params.history.enabled&&this.history.init()},destroy:function(){this.params.history.enabled&&this.history.destroy()},transitionEnd:function(){this.history.initialized&&this.history.setHistory(this.params.history.key,this.activeIndex)}}},{name:"hash-navigation",params:{hashNavigation:{enabled:!1,replaceState:!1,watchState:!1}},create:function(){var e=this;ee.extend(e,{hashNavigation:{initialized:!1,init:j.init.bind(e),destroy:j.destroy.bind(e),setHash:j.setHash.bind(e),onHashCange:j.onHashCange.bind(e)}})},on:{init:function(){this.params.hashNavigation.enabled&&this.hashNavigation.init()},destroy:function(){this.params.hashNavigation.enabled&&this.hashNavigation.destroy()},transitionEnd:function(){this.hashNavigation.initialized&&this.hashNavigation.setHash()}}},{name:"autoplay",params:{autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1}},create:function(){var t=this;ee.extend(t,{autoplay:{running:!1,paused:!1,run:U.run.bind(t),start:U.start.bind(t),stop:U.stop.bind(t),pause:U.pause.bind(t),onTransitionEnd:function(e){t&&!t.destroyed&&t.$wrapperEl&&e.target===this&&(t.$wrapperEl[0].removeEventListener("transitionend",t.autoplay.onTransitionEnd),t.$wrapperEl[0].removeEventListener("webkitTransitionEnd",t.autoplay.onTransitionEnd),t.autoplay.paused=!1,t.autoplay.running?t.autoplay.run():t.autoplay.stop())}}})},on:{init:function(){this.params.autoplay.enabled&&this.autoplay.start()},beforeTransitionStart:function(e,t){this.autoplay.running&&(t||!this.params.autoplay.disableOnInteraction?this.autoplay.pause(e):this.autoplay.stop())},sliderFirstMove:function(){this.autoplay.running&&(this.params.autoplay.disableOnInteraction?this.autoplay.stop():this.autoplay.pause())},destroy:function(){this.autoplay.running&&this.autoplay.stop()}}},{name:"effect-fade",params:{fadeEffect:{crossFade:!1}},create:function(){ee.extend(this,{fadeEffect:{setTranslate:K.setTranslate.bind(this),setTransition:K.setTransition.bind(this)}})},on:{beforeInit:function(){var e=this;if("fade"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"fade");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};ee.extend(e.params,t),ee.extend(e.originalParams,t)}},setTranslate:function(){"fade"===this.params.effect&&this.fadeEffect.setTranslate()},setTransition:function(e){"fade"===this.params.effect&&this.fadeEffect.setTransition(e)}}},{name:"effect-cube",params:{cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}},create:function(){ee.extend(this,{cubeEffect:{setTranslate:_.setTranslate.bind(this),setTransition:_.setTransition.bind(this)}})},on:{beforeInit:function(){var e=this;if("cube"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"cube"),e.classNames.push(e.params.containerModifierClass+"3d");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0};ee.extend(e.params,t),ee.extend(e.originalParams,t)}},setTranslate:function(){"cube"===this.params.effect&&this.cubeEffect.setTranslate()},setTransition:function(e){"cube"===this.params.effect&&this.cubeEffect.setTransition(e)}}},{name:"effect-flip",params:{flipEffect:{slideShadows:!0,limitRotation:!0}},create:function(){ee.extend(this,{flipEffect:{setTranslate:Z.setTranslate.bind(this),setTransition:Z.setTransition.bind(this)}})},on:{beforeInit:function(){var e=this;if("flip"===e.params.effect){e.classNames.push(e.params.containerModifierClass+"flip"),e.classNames.push(e.params.containerModifierClass+"3d");var t={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};ee.extend(e.params,t),ee.extend(e.originalParams,t)}},setTranslate:function(){"flip"===this.params.effect&&this.flipEffect.setTranslate()},setTransition:function(e){"flip"===this.params.effect&&this.flipEffect.setTransition(e)}}},{name:"effect-coverflow",params:{coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0}},create:function(){ee.extend(this,{coverflowEffect:{setTranslate:Q.setTranslate.bind(this),setTransition:Q.setTransition.bind(this)}})},on:{beforeInit:function(){var e=this;"coverflow"===e.params.effect&&(e.classNames.push(e.params.containerModifierClass+"coverflow"),e.classNames.push(e.params.containerModifierClass+"3d"),e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0)},setTranslate:function(){"coverflow"===this.params.effect&&this.coverflowEffect.setTranslate()},setTransition:function(e){"coverflow"===this.params.effect&&this.coverflowEffect.setTransition(e)}}},{name:"thumbs",params:{thumbs:{swiper:null,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-container-thumbs"}},create:function(){ee.extend(this,{thumbs:{swiper:null,init:ae.init.bind(this),update:ae.update.bind(this),onThumbClick:ae.onThumbClick.bind(this)}})},on:{beforeInit:function(){var e=this.params.thumbs;e&&e.swiper&&(this.thumbs.init(),this.thumbs.update(!0))},slideChange:function(){this.thumbs.swiper&&this.thumbs.update()},update:function(){this.thumbs.swiper&&this.thumbs.update()},resize:function(){this.thumbs.swiper&&this.thumbs.update()},observerUpdate:function(){this.thumbs.swiper&&this.thumbs.update()},setTransition:function(e){var t=this.thumbs.swiper;t&&t.setTransition(e)},beforeDestroy:function(){var e=this.thumbs.swiper;e&&this.thumbs.swiperCreated&&e&&e.destroy()}}}];return void 0===S.use&&(S.use=S.Class.use,S.installModule=S.Class.installModule),S.use(ie),S});
//# sourceMappingURL=swiper.min.js.map
    
!(function() {
	function searchFilterForCategory(filters, categoryId) {
		var found = null;
		for(var i=0, len=filters.length; i<len && !found; i++) {
			var current=filters[i];
			if($.isArray(current)) {
				found=searchFilterForCategory(current, categoryId);
			} else if(current.id == categoryId) {
				found=current;
			}
		}
		return found;
	}

	var swiperCounter = 0;
	angular.module("itxApp").directive("swiper", ["$timeout", "$http", "bskCategoryFactory", "gridFilterService", function($timeout, $http, categoryFactory, gridFilterService) {
		return {
			scope: false,
			replace: false,
			restrict: "A",
			link: function(scope, $element, attrs) {
				var method = "xSwiperSelectFilter"+(++swiperCounter);
				$http.get(inditex.getStaticResourceUrl("/config/grid_carousel.json")).then(function(response) {
					var items = [];
					var category = attrs.categoryId;
					var categoryId=0;
					
					$.each(response.data, function(key, val) {
						if( val.categoriesId[0] == category ) {
							$.each(val.carouselItems,function(k, v){
								var found = categoryFactory.findCategoryId(v.tipology).pop();
								if(found) {
									var img = v.image.indexOf("/") == 0 ? v.image: "/" + v.image;
									var path = inditex.iStoreJSON.details.imageBaseUrl+img.replace(".jpg", "_web.jpg")+"?t="+inditex.iRegistryTs;
									$(".swiper-container .swiper-wrapper").append('<div class="swiper-slide" id="swiper-slide-'+v.tipology+'" onclick="inditex.'+method+'('+found.id+')"><img class="img-responsive" src="'+ path +'"><p>'+found.name+'&nbsp;<span class="swiper-number-products"></span></p><div class="close"><img src="'+inditex.getStaticResourceUrl("/images/home/carrusel/pants/close.png")+'"></div></div>');
								}
							});
							return false;
						}
					});

					inditex[method]=function(categoryId) {
						var filters=gridFilterService.getFilters("tipology");
						var found=searchFilterForCategory(filters, categoryId);
						var active=gridFilterService.getActiveFilters("tipology").slice(0);
						
						gridFilterService.clearActive("tipology");
						if(found && (active.length!=1 || found!=active[0])) {
							gridFilterService.toggle("tipology", found);
						}
					}

					function refreshFilters() {
						var active=gridFilterService.getActiveFilters("tipology");

						if(active.length) {
							$(".swiper-container .swiper-slide").addClass("opacity").removeClass("active");
							for(var i=0, len=active.length; i<len; i++) {
								$("#swiper-slide-"+active[i].id).removeClass("opacity").addClass("active");
							}
						} else {
							$(".swiper-container .swiper-slide").removeClass("opacity").removeClass("active");
						}
					}
					
					function setProducts() {
						var filters = gridFilterService.getFilters("tipology");
						if(filters && filters.length) {
							for(var i=0, len=filters[0].length; i<len; i++) {
								var filter = filters[0][i];
								$("#swiper-slide-"+filter.id+" .swiper-number-products").html("("+filter.products.length+")");
							}
						}
					}
					
					var remover1 = gridFilterService.$applied.push(refreshFilters);
					var remover2 = gridFilterService.$removed.push(refreshFilters);
					var remover3 = gridFilterService.$loaded.push(setProducts);
					
					var swiper = new Swiper($element.get(0), {
						slidesPerView: 6,
						spaceBetween: 10,
						centeredSlides: false,
						// init: false,
						pagination: {
							el: '.swiper-pagination',
							clickable: true,
						},
						navigation: {
							nextEl: '.swiper-button-next',
							prevEl: '.swiper-button-prev',
						},
						breakpoints: {
							1300: {
								slidesPerView: 6,
								spaceBetween: 10,
								centeredSlides: false,
							},
							1024: {
								slidesPerView: 5.5,
								spaceBetween: 10,
								centeredSlides: false,
							},
							640: {
								slidesPerView: 2.2,
								spaceBetween: 7,
							},
							320: {
								slidesPerView: 2.2,
								spaceBetween: 7,
							}
						}
					});

					scope.$on("$destroy", function() {
						remover1();
						remover2();
						remover3();
					});

				});
			}
		}
	}]);
	
})();	
/*EN SWIPER*/

/* POP UPS */

inditex.xOpenPromoPage = function(spotID, width, height, translationsID) {
	translationsID  = translationsID || "home_march_lookbook";
	inditex.loadSpot(spotID,function(mSpotHtml) {
		inditex.popupHtml(mSpotHtml, width, height, function() {
			inditex.initModalController("ItxNewsletterPage", {
				'showUnsubscribe' : false,
				'showBirthday': false
			});
			$(".modal.ui-dialog-content.ui-widget-content").attr("data-translations",translationsID);
		}, null,"modal");
	});
} 

/* END POP UPS */

/* VUE ANALYTICS */
if(inditex.hasSessionStorage()) {
	inditex.setSessionStorage("isFromAngular", true);
}
/* END VUE ANALYTICS */

/* TEST A/B CRONOS */
(function() {
	if(inditex.iCountryCode == "FR") {
		shippingMethodsCtrl.prototype.$onChanges=function(changes) {
			if(changes.methods && changes.methods.currentValue && changes.methods.currentValue.length) {
				$(document).trigger("ShippingMethods", { methods: changes.methods.currentValue });
			}
		};

		var oldSelectedMethod=shippingMethodsCtrl.prototype.selectMethod;
		shippingMethodsCtrl.prototype.selectMethod=function(method) {
			oldSelectedMethod.apply(this, arguments);
			if(method.app.enabled) {
				$(document).trigger("ShippingMethodSelected", { method: method });
			}
		};
	}
})();

/* END TEST A/B CRONOS */
